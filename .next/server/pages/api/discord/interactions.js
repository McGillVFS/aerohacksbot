"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "pages/api/discord/interactions";
exports.ids = ["pages/api/discord/interactions"];
exports.modules = {

/***/ "(api-node)/./lib/discord/assignRolesFromRegistration.ts":
/*!****************************************************!*\
  !*** ./lib/discord/assignRolesFromRegistration.ts ***!
  \****************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   assignRolesFromRegistration: () => (/* binding */ assignRolesFromRegistration),\n/* harmony export */   editOriginalInteractionResponse: () => (/* binding */ editOriginalInteractionResponse)\n/* harmony export */ });\n/* harmony import */ var _roleMap__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./roleMap */ \"(api-node)/./lib/discord/roleMap.ts\");\n\nconst DISCORD_API_BASE = \"https://discord.com/api/v10\";\nconst DISCORD_API_TIMEOUT_MS = Number(process.env.DISCORD_API_TIMEOUT_MS ?? \"7000\");\nconst MAX_ROLE_OPERATIONS = Number(process.env.MAX_ROLE_OPERATIONS ?? \"24\");\nconst ENABLE_VERIFY_TIMING_LOGS = process.env.VERIFY_TIMING_LOGS !== \"0\";\nconst DISCORD_BOT_USER_ID = process.env.DISCORD_BOT_USER_ID;\nconst DISCORD_TOKEN = process.env.DISCORD_TOKEN ?? process.env.DISCORD_BOT_TOKEN;\nconst discordBotToken = DISCORD_TOKEN;\nlet cachedBotUserId = null;\nfunction logVerifyTiming(step, durationMs, details) {\n    if (!ENABLE_VERIFY_TIMING_LOGS) {\n        return;\n    }\n    const suffix = details ? ` ${details}` : \"\";\n    console.info(`[verify-timing] ${step}: ${durationMs.toFixed(1)}ms${suffix}`);\n}\nasync function fetchWithTimeout(url, init) {\n    const controller = new AbortController();\n    const timeout = setTimeout(()=>controller.abort(), DISCORD_API_TIMEOUT_MS);\n    try {\n        return await fetch(url, {\n            ...init,\n            signal: controller.signal\n        });\n    } finally{\n        clearTimeout(timeout);\n    }\n}\nasync function discordApi(path, init) {\n    if (!discordBotToken) {\n        throw new Error(\"Missing required env var: DISCORD_TOKEN (or DISCORD_BOT_TOKEN)\");\n    }\n    const response = await fetchWithTimeout(`${DISCORD_API_BASE}${path}`, {\n        ...init,\n        headers: {\n            Authorization: `Bot ${discordBotToken}`,\n            \"Content-Type\": \"application/json\",\n            ...init?.headers ?? {}\n        }\n    });\n    if (!response.ok) {\n        const body = await response.text();\n        throw new Error(`Discord API ${init?.method ?? \"GET\"} ${path} failed (${response.status}): ${body}`);\n    }\n    if (response.status === 204) {\n        return undefined;\n    }\n    return await response.json();\n}\nasync function getBotUserId() {\n    if (DISCORD_BOT_USER_ID) {\n        return DISCORD_BOT_USER_ID;\n    }\n    if (cachedBotUserId) {\n        return cachedBotUserId;\n    }\n    const data = await discordApi(\"/users/@me\");\n    cachedBotUserId = data.id;\n    return data.id;\n}\nasync function listGuildRoles(guildId) {\n    return discordApi(`/guilds/${guildId}/roles`);\n}\nasync function getGuildMember(guildId, userId) {\n    return discordApi(`/guilds/${guildId}/members/${userId}`);\n}\nasync function createGuildRole(guildId, roleName) {\n    return discordApi(`/guilds/${guildId}/roles`, {\n        method: \"POST\",\n        body: JSON.stringify({\n            name: roleName,\n            permissions: \"0\",\n            hoist: false,\n            mentionable: false\n        })\n    });\n}\nasync function assignRoleToMember(guildId, userId, roleId) {\n    await discordApi(`/guilds/${guildId}/members/${userId}/roles/${roleId}`, {\n        method: \"PUT\"\n    });\n}\nfunction normalizeRoleName(value) {\n    return value.replace(/\\s+/g, \" \").trim().slice(0, 100);\n}\nfunction mappedOrDefault(category, value, fallbackPrefix) {\n    const mapped = _roleMap__WEBPACK_IMPORTED_MODULE_0__.ROLE_MAP[category][value];\n    return mapped ?? `${fallbackPrefix}: ${value}`;\n}\nfunction buildDesiredRoleNames(registration) {\n    const roleNames = new Set();\n    for (const field of registration.fields_of_study ?? []){\n        const normalized = normalizeRoleName(field);\n        if (!normalized) continue;\n        roleNames.add(normalizeRoleName(mappedOrDefault(\"fields_of_study\", normalized, \"Field\")));\n    }\n    for (const interest of registration.interests ?? []){\n        const normalized = normalizeRoleName(interest);\n        if (!normalized) continue;\n        roleNames.add(normalizeRoleName(mappedOrDefault(\"interests\", normalized, \"Interest\")));\n    }\n    if (registration.level_of_study) {\n        const normalized = normalizeRoleName(registration.level_of_study);\n        if (normalized) {\n            roleNames.add(normalizeRoleName(mappedOrDefault(\"level_of_study\", normalized, \"Level\")));\n        }\n    }\n    const schoolValue = registration.school === \"Other\" ? normalizeRoleName(registration.school_other ?? \"\") : normalizeRoleName(registration.school ?? \"\");\n    if (schoolValue) {\n        roleNames.add(normalizeRoleName(mappedOrDefault(\"school\", schoolValue, \"School\")));\n    }\n    if (registration.team_mode === \"free_agent\") {\n        roleNames.add(_roleMap__WEBPACK_IMPORTED_MODULE_0__.ROLE_MAP.team_mode.free_agent);\n    }\n    if (registration.team_mode === \"team\") {\n        const teamName = normalizeRoleName(registration.team_name ?? \"\");\n        if (teamName) {\n            roleNames.add(normalizeRoleName(`Team: ${teamName}`));\n        }\n    }\n    return Array.from(roleNames);\n}\nfunction getMemberTopRolePosition(memberRoleIds, guildRolesById) {\n    let topPosition = 0;\n    for (const roleId of memberRoleIds){\n        const role = guildRolesById.get(roleId);\n        if (!role) continue;\n        if (role.position > topPosition) {\n            topPosition = role.position;\n        }\n    }\n    return topPosition;\n}\nasync function assignRolesFromRegistration(input) {\n    const totalStart = performance.now();\n    const desiredRoleNames = buildDesiredRoleNames(input.registration);\n    if (desiredRoleNames.length === 0) {\n        logVerifyTiming(\"roles.total\", performance.now() - totalStart, \"desired_roles=0\");\n        return {\n            assignedRoleNames: [],\n            skippedExistingRoleNames: [],\n            skippedHierarchyRoleNames: [],\n            failedRoleNames: []\n        };\n    }\n    const listRolesStart = performance.now();\n    const guildRoles = await listGuildRoles(input.guildId);\n    logVerifyTiming(\"roles.listGuildRoles\", performance.now() - listRolesStart, `guild_roles=${guildRoles.length}`);\n    const guildRolesById = new Map(guildRoles.map((role)=>[\n            role.id,\n            role\n        ]));\n    const roleByLowerName = new Map(guildRoles.map((role)=>[\n            role.name.toLowerCase(),\n            role\n        ]));\n    const botUserStart = performance.now();\n    const botUserId = await getBotUserId();\n    logVerifyTiming(\"roles.getBotUserId\", performance.now() - botUserStart);\n    const membersStart = performance.now();\n    const [member, botMember] = await Promise.all([\n        getGuildMember(input.guildId, input.discordUserId),\n        getGuildMember(input.guildId, botUserId)\n    ]);\n    logVerifyTiming(\"roles.getGuildMembers\", performance.now() - membersStart);\n    const memberRoleIds = new Set(member.roles);\n    const botTopRolePosition = getMemberTopRolePosition(botMember.roles, guildRolesById);\n    const skippedExistingRoleNames = [];\n    const skippedHierarchyRoleNames = [];\n    const failedRoleNames = [];\n    const assignmentQueue = [];\n    const missingRoleNames = [];\n    for (const desiredRoleName of desiredRoleNames){\n        const roleKey = desiredRoleName.toLowerCase();\n        const role = roleByLowerName.get(roleKey);\n        if (!role) {\n            missingRoleNames.push(desiredRoleName);\n        }\n    }\n    const createRolesStart = performance.now();\n    const roleCreationResults = await Promise.allSettled(missingRoleNames.map(async (roleName)=>{\n        const created = await createGuildRole(input.guildId, roleName);\n        return created;\n    }));\n    logVerifyTiming(\"roles.createMissingRoles\", performance.now() - createRolesStart, `attempted=${missingRoleNames.length}`);\n    roleCreationResults.forEach((result, index)=>{\n        const roleName = missingRoleNames[index];\n        if (!roleName) return;\n        if (result.status === \"rejected\") {\n            failedRoleNames.push(roleName);\n            console.error(\"Failed to create role:\", roleName, result.reason);\n            return;\n        }\n        const createdRole = result.value;\n        roleByLowerName.set(createdRole.name.toLowerCase(), createdRole);\n        guildRolesById.set(createdRole.id, createdRole);\n    });\n    for (const desiredRoleName of desiredRoleNames){\n        const role = roleByLowerName.get(desiredRoleName.toLowerCase());\n        if (!role) {\n            continue;\n        }\n        if (memberRoleIds.has(role.id)) {\n            skippedExistingRoleNames.push(role.name);\n            continue;\n        }\n        if (role.position >= botTopRolePosition) {\n            skippedHierarchyRoleNames.push(role.name);\n            continue;\n        }\n        assignmentQueue.push({\n            roleName: role.name,\n            roleId: role.id\n        });\n    }\n    const boundedAssignmentQueue = assignmentQueue.slice(0, Math.max(0, MAX_ROLE_OPERATIONS));\n    for (const skipped of assignmentQueue.slice(boundedAssignmentQueue.length)){\n        failedRoleNames.push(skipped.roleName);\n        console.error(\"Skipping role assignment due to MAX_ROLE_OPERATIONS cap:\", skipped.roleName);\n    }\n    const assignStart = performance.now();\n    const assignments = await Promise.allSettled(boundedAssignmentQueue.map(async ({ roleName, roleId })=>{\n        await assignRoleToMember(input.guildId, input.discordUserId, roleId);\n        return roleName;\n    }));\n    logVerifyTiming(\"roles.assignRoleCalls\", performance.now() - assignStart, `attempted=${boundedAssignmentQueue.length} capped_by_max=${Math.max(0, assignmentQueue.length - boundedAssignmentQueue.length)}`);\n    const assignedRoleNames = [];\n    assignments.forEach((result, index)=>{\n        const roleName = boundedAssignmentQueue[index]?.roleName;\n        if (!roleName) return;\n        if (result.status === \"fulfilled\") {\n            assignedRoleNames.push(result.value);\n            return;\n        }\n        failedRoleNames.push(roleName);\n        console.error(\"Failed to assign role:\", roleName, result.reason);\n    });\n    const result = {\n        assignedRoleNames,\n        skippedExistingRoleNames,\n        skippedHierarchyRoleNames,\n        failedRoleNames\n    };\n    logVerifyTiming(\"roles.total\", performance.now() - totalStart, `desired=${desiredRoleNames.length} assigned=${assignedRoleNames.length} failed=${failedRoleNames.length}`);\n    return result;\n}\nasync function editOriginalInteractionResponse(input) {\n    const response = await fetchWithTimeout(`${DISCORD_API_BASE}/webhooks/${input.applicationId}/${input.interactionToken}/messages/@original`, {\n        method: \"PATCH\",\n        headers: {\n            \"Content-Type\": \"application/json\"\n        },\n        body: JSON.stringify({\n            content: input.content\n        })\n    });\n    if (!response.ok) {\n        const body = await response.text();\n        throw new Error(`Failed to edit original interaction response (${response.status}): ${body}`);\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaS1ub2RlKS8uL2xpYi9kaXNjb3JkL2Fzc2lnblJvbGVzRnJvbVJlZ2lzdHJhdGlvbi50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7QUFBcUM7QUEwQ3JDLE1BQU1DLG1CQUFtQjtBQUN6QixNQUFNQyx5QkFBeUJDLE9BQU9DLFFBQVFDLEdBQUcsQ0FBQ0gsc0JBQXNCLElBQUk7QUFDNUUsTUFBTUksc0JBQXNCSCxPQUFPQyxRQUFRQyxHQUFHLENBQUNDLG1CQUFtQixJQUFJO0FBQ3RFLE1BQU1DLDRCQUE0QkgsUUFBUUMsR0FBRyxDQUFDRyxrQkFBa0IsS0FBSztBQUNyRSxNQUFNQyxzQkFBc0JMLFFBQVFDLEdBQUcsQ0FBQ0ksbUJBQW1CO0FBRTNELE1BQU1DLGdCQUFnQk4sUUFBUUMsR0FBRyxDQUFDSyxhQUFhLElBQUlOLFFBQVFDLEdBQUcsQ0FBQ00saUJBQWlCO0FBRWhGLE1BQU1DLGtCQUFrQkY7QUFDeEIsSUFBSUcsa0JBQWlDO0FBRXJDLFNBQVNDLGdCQUFnQkMsSUFBWSxFQUFFQyxVQUFrQixFQUFFQyxPQUFnQjtJQUN6RSxJQUFJLENBQUNWLDJCQUEyQjtRQUM5QjtJQUNGO0lBQ0EsTUFBTVcsU0FBU0QsVUFBVSxDQUFDLENBQUMsRUFBRUEsU0FBUyxHQUFHO0lBQ3pDRSxRQUFRQyxJQUFJLENBQUMsQ0FBQyxnQkFBZ0IsRUFBRUwsS0FBSyxFQUFFLEVBQUVDLFdBQVdLLE9BQU8sQ0FBQyxHQUFHLEVBQUUsRUFBRUgsUUFBUTtBQUM3RTtBQUVBLGVBQWVJLGlCQUFpQkMsR0FBVyxFQUFFQyxJQUFpQjtJQUM1RCxNQUFNQyxhQUFhLElBQUlDO0lBQ3ZCLE1BQU1DLFVBQVVDLFdBQVcsSUFBTUgsV0FBV0ksS0FBSyxJQUFJM0I7SUFFckQsSUFBSTtRQUNGLE9BQU8sTUFBTTRCLE1BQU1QLEtBQUs7WUFDdEIsR0FBR0MsSUFBSTtZQUNQTyxRQUFRTixXQUFXTSxNQUFNO1FBQzNCO0lBQ0YsU0FBVTtRQUNSQyxhQUFhTDtJQUNmO0FBQ0Y7QUFFQSxlQUFl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U0csRUFBRSxFQUFFO1FBQ2hCLE1BQU1DLE9BQU8sTUFBTUosU0FBU0ssSUFBSTtRQUNoQyxNQUFNLElBQUlOLE1BQU0sQ0FBQyw4Q0FBOEMsRUFBRUMsU0FBU08sTUFBTSxDQUFDLEdBQUcsRUFBRUgsTUFBTTtJQUM5RjtBQUNGIiwic291cmNlcyI6WyIvVXNlcnMvc2NhcmJvY2hhbi9Eb2N1bWVudHMvR2l0SHViL2Flcm9oYWNrc2JvdC9saWIvZGlzY29yZC9hc3NpZ25Sb2xlc0Zyb21SZWdpc3RyYXRpb24udHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUk9MRV9NQVAgfSBmcm9tIFwiLi9yb2xlTWFwXCI7XG5cbnR5cGUgUm9sZSA9IHtcbiAgaWQ6IHN0cmluZztcbiAgbmFtZTogc3RyaW5nO1xuICBwb3NpdGlvbjogbnVtYmVyO1xufTtcblxudHlwZSBHdWlsZE1lbWJlciA9IHtcbiAgdXNlcjogeyBpZDogc3RyaW5nIH07XG4gIHJvbGVzOiBzdHJpbmdbXTtcbn07XG5cbnR5cGUgUmVnaXN0cmF0aW9uUm9sZUZpZWxkcyA9IHtcbiAgZmllbGRzX29mX3N0dWR5OiBzdHJpbmdbXSB8IG51bGw7XG4gIGludGVyZXN0czogc3RyaW5nW10gfCBudWxsO1xuICBsZXZlbF9vZl9zdHVkeTogc3RyaW5nIHwgbnVsbDtcbiAgc2Nob29sOiBzdHJpbmcgfCBudWxsO1xuICBzY2hvb2xfb3RoZXI6IHN0cmluZyB8IG51bGw7XG4gIHRlYW1fbW9kZTogc3RyaW5nIHwgbnVsbDtcbiAgdGVhbV9uYW1lOiBzdHJpbmcgfCBudWxsO1xufTtcblxudHlwZSBBc3NpZ25Sb2xlc0lucHV0ID0ge1xuICBndWlsZElkOiBzdHJpbmc7XG4gIGRpc2NvcmRVc2VySWQ6IHN0cmluZztcbiAgcmVnaXN0cmF0aW9uOiBSZWdpc3RyYXRpb25Sb2xlRmllbGRzO1xufTtcblxudHlwZSBBc3NpZ25Sb2xlc1Jlc3VsdCA9IHtcbiAgYXNzaWduZWRSb2xlTmFtZXM6IHN0cmluZ1tdO1xuICBza2lwcGVkRXhpc3RpbmdSb2xlTmFtZXM6IHN0cmluZ1tdO1xuICBza2lwcGVkSGllcmFyY2h5Um9sZU5hbWVzOiBzdHJpbmdbXTtcbiAgZmFpbGVkUm9sZU5hbWVzOiBzdHJpbmdbXTtcbn07XG5cbnR5cGUgRWRpdE9yaWdpbmFsSW50ZXJhY3Rpb25SZXNwb25zZUlucHV0ID0ge1xuICBhcHBsaWNhdGlvbklkOiBzdHJpbmc7XG4gIGludGVyYWN0aW9uVG9rZW46IHN0cmluZztcbiAgY29udGVudDogc3RyaW5nO1xufTtcblxuY29uc3QgRElTQ09SRF9BUElfQkFTRSA9IFwiaHR0cHM6Ly9kaXNjb3JkLmNvbS9hcGkvdjEwXCI7XG5jb25zdCBESVNDT1JEX0FQSV9USU1FT1VUX01TID0gTnVtYmVyKHByb2Nlc3MuZW52LkRJU0NPUkRfQVBJX1RJTUVPVVRfTVMgPz8gXCI3MDAwXCIpO1xuY29uc3QgTUFYX1JPTEVfT1BFUkFUSU9OUyA9IE51bWJlcihwcm9jZXNzLmVudi5NQVhfUk9MRV9PUEVSQVRJT05TID8/IFwiMjRcIik7XG5jb25zdCBFTkFCTEVfVkVSSUZZX1RJTUlOR19MT0dTID0gcHJvY2Vzcy5lbnYuVkVSSUZZX1RJTUlOR19MT0dTICE9PSBcIjBcIjtcbmNvbnN0IERJU0NPUkRfQk9UX1VTRVJfSUQgPSBwcm9jZXNzLmVudi5ESVNDT1JEX0JPVF9VU0VSX0lEO1xuXG5jb25zdCBESVNDT1JEX1RPS0VOID0gcHJvY2Vzcy5lbnYuRElTQ09SRF9UT0tFTiA/PyBwcm9jZXNzLmVudi5ESVNDT1JEX0JPVF9UT0tFTjtcblxuY29uc3QgZGlzY29yZEJvdFRva2VuID0gRElTQ09SRF9UT0tFTjtcbmxldCBjYWNoZWRCb3RVc2VySWQ6IHN0cmluZyB8IG51bGwgPSBudWxsO1xuXG5mdW5jdGlvbiBsb2dWZXJpZnlUaW1pbmcoc3RlcDogc3RyaW5nLCBkdXJhdGlvbk1zOiBudW1iZXIsIGRldGFpbHM/OiBzdHJpbmcpOiB2b2lkIHtcbiAgaWYgKCFFTkFCTEVfVkVSSUZZX1RJTUlOR19MT0dTKSB7XG4gICAgcmV0dXJuO1xuICB9XG4gIGNvbnN0IHN1ZmZpeCA9IGRldGFpbHMgPyBgICR7ZGV0YWlsc31gIDogXCJcIjtcbiAgY29uc29sZS5pbmZvKGBbdmVyaWZ5LXRpbWluZ10gJHtzdGVwfTogJHtkdXJhdGlvbk1zLnRvRml4ZWQoMSl9bXMke3N1ZmZpeH1gKTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gZmV0Y2hXaXRoVGltZW91dCh1cmw6IHN0cmluZywgaW5pdDogUmVxdWVzdEluaXQpOiBQcm9taXNlPFJlc3BvbnNlPiB7XG4gIGNvbnN0IGNvbnRyb2xsZXIgPSBuZXcgQWJvcnRDb250cm9sbGVyKCk7XG4gIGNvbnN0IHRpbWVvdXQgPSBzZXRUaW1lb3V0KCgpID0+IGNvbnRyb2xsZXIuYWJvcnQoKSwgRElTQ09SRF9BUElfVElNRU9VVF9NUyk7XG5cbiAgdHJ5IHtcbiAgICByZXR1cm4gYXdhaXQgZmV0Y2godXJsLCB7XG4gICAgICAuLi5pbml0LFxuICAgICAgc2lnbmFsOiBjb250cm9sbGVyLnNpZ25hbCxcbiAgICB9KTtcbiAgfSBmaW5hbGx5IHtcbiAgICBjbGVhclRpbWVvdXQodGltZW91dCk7XG4gIH1cbn1cblxuYXN5bmMgZnVuY3Rpb24gZGlzY29yZEFwaTxUPihwYXRoOiBzdHJpbmcsIGluaXQ/OiBSZXF1ZXN0SW5pdCk6IFByb21pc2U8VD4ge1xuICBpZiAoIWRpc2NvcmRCb3RUb2tlbikge1xuICAgIHRocm93IG5ldyBFcnJvcihcIk1pc3NpbmcgcmVxdWlyZWQgZW52IHZhcjogRElTQ09SRF9UT0tFTiAob3IgRElTQ09SRF9CT1RfVE9LRU4pXCIpO1xuICB9XG5cbiAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaFdpdGhUaW1lb3V0KGAke0RJU0NPUkRfQVBJX0JBU0V9JHtwYXRofWAsIHtcbiAgICAuLi5pbml0LFxuICAgIGhlYWRlcnM6IHtcbiAgICAgIEF1dGhvcml6YXRpb246IGBCb3QgJHtkaXNjb3JkQm90VG9rZW59YCxcbiAgICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiLFxuICAgICAgLi4uKGluaXQ/LmhlYWRlcnMgPz8ge30pLFxuICAgIH0sXG4gIH0pO1xuXG4gIGlmICghcmVzcG9uc2Uub2spIHtcbiAgICBjb25zdCBib2R5ID0gYXdhaXQgcmVzcG9uc2UudGV4dCgpO1xuICAgIHRocm93IG5ldyBFcnJvcihgRGlzY29yZCBBUEkgJHtpbml0Py5tZXRob2QgPz8gXCJHRVRcIn0gJHtwYXRofSBmYWlsZWQgKCR7cmVzcG9uc2Uuc3RhdHVzfSk6ICR7Ym9keX1gKTtcbiAgfVxuXG4gIGlmIChyZXNwb25zZS5zdGF0dXMgPT09IDIwNCkge1xuICAgIHJldHVybiB1bmRlZmluZWQgYXMgVDtcbiAgfVxuXG4gIHJldHVybiAoYXdhaXQgcmVzcG9uc2UuanNvbigpKSBhcyBUO1xufVxuXG5hc3luYyBmdW5jdGlvbiBnZXRCb3RVc2VySWQoKTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgaWYgKERJU0NPUkRfQk9UX1VTRVJfSUQpIHtcbiAgICByZXR1cm4gRElTQ09SRF9CT1RfVVNFUl9JRDtcbiAgfVxuXG4gIGlmIChjYWNoZWRCb3RVc2VySWQpIHtcbiAgICByZXR1cm4gY2FjaGVkQm90VXNlcklkO1xuICB9XG5cbiAgY29uc3QgZGF0YSA9IGF3YWl0IGRpc2NvcmRBcGk8eyBpZDogc3RyaW5nIH0+KFwiL3VzZXJzL0BtZVwiKTtcbiAgY2FjaGVkQm90VXNlcklkID0gZGF0YS5pZDtcbiAgcmV0dXJuIGRhdGEuaWQ7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGxpc3RHdWlsZFJvbGVzKGd1aWxkSWQ6IHN0cmluZyk6IFByb21pc2U8Um9sZVtdPiB7XG4gIHJldHVybiBkaXNjb3JkQXBpPFJvbGVbXT4oYC9ndWlsZHMvJHtndWlsZElkfS9yb2xlc2ApO1xufVxuXG5hc3luYyBmdW5jdGlvbiBnZXRHdWlsZE1lbWJlcihndWlsZElkOiBzdHJpbmcsIHVzZXJJZDogc3RyaW5nKTogUHJvbWlzZTxHdWlsZE1lbWJlcj4ge1xuICByZXR1cm4gZGlzY29yZEFwaTxHdWlsZE1lbWJlcj4oYC9ndWlsZHMvJHtndWlsZElkfS9tZW1iZXJzLyR7dXNlcklkfWApO1xufVxuXG5hc3luYyBmdW5jdGlvbiBjcmVhdGVHdWlsZFJvbGUoZ3VpbGRJZDogc3RyaW5nLCByb2xlTmFtZTogc3RyaW5nKTogUHJvbWlzZTxSb2xlPiB7XG4gIHJldHVybiBkaXNjb3JkQXBpPFJvbGU+KGAvZ3VpbGRzLyR7Z3VpbGRJZH0vcm9sZXNgLCB7XG4gICAgbWV0aG9kOiBcIlBPU1RcIixcbiAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICBuYW1lOiByb2xlTmFtZSxcbiAgICAgIHBlcm1pc3Npb25zOiBcIjBcIixcbiAgICAgIGhvaXN0OiBmYWxzZSxcbiAgICAgIG1lbnRpb25hYmxlOiBmYWxzZSxcbiAgICB9KSxcbiAgfSk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGFzc2lnblJvbGVUb01lbWJlcihndWlsZElkOiBzdHJpbmcsIHVzZXJJZDogc3RyaW5nLCByb2xlSWQ6IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xuICBhd2FpdCBkaXNjb3JkQXBpPHZvaWQ+KGAvZ3VpbGRzLyR7Z3VpbGRJZH0vbWVtYmVycy8ke3VzZXJJZH0vcm9sZXMvJHtyb2xlSWR9YCwge1xuICAgIG1ldGhvZDogXCJQVVRcIixcbiAgfSk7XG59XG5cbmZ1bmN0aW9uIG5vcm1hbGl6ZVJvbGVOYW1lKHZhbHVlOiBzdHJpbmcpOiBzdHJpbmcge1xuICByZXR1cm4gdmFsdWUucmVwbGFjZSgvXFxzKy9nLCBcIiBcIikudHJpbSgpLnNsaWNlKDAsIDEwMCk7XG59XG5cbmZ1bmN0aW9uIG1hcHBlZE9yRGVmYXVsdChcbiAgY2F0ZWdvcnk6IFwiaW50ZXJlc3RzXCIgfCBcImZpZWxkc19vZl9zdHVkeVwiIHwgXCJsZXZlbF9vZl9zdHVkeVwiIHwgXCJzY2hvb2xcIixcbiAgdmFsdWU6IHN0cmluZyxcbiAgZmFsbGJhY2tQcmVmaXg6IHN0cmluZ1xuKTogc3RyaW5nIHtcbiAgY29uc3QgbWFwcGVkID0gUk9MRV9NQVBbY2F0ZWdvcnldW3ZhbHVlIGFzIGtleW9mICh0eXBlb2YgUk9MRV9NQVApW3R5cGVvZiBjYXRlZ29yeV1dO1xuICByZXR1cm4gbWFwcGVkID8/IGAke2ZhbGxiYWNrUHJlZml4fTogJHt2YWx1ZX1gO1xufVxuXG5mdW5jdGlvbiBidWlsZERlc2lyZWRSb2xlTmFtZXMocmVnaXN0cmF0aW9uOiBSZWdpc3RyYXRpb25Sb2xlRmllbGRzKTogc3RyaW5nW10ge1xuICBjb25zdCByb2xlTmFtZXMgPSBuZXcgU2V0PHN0cmluZz4oKTtcblxuICBmb3IgKGNvbnN0IGZpZWxkIG9mIHJlZ2lzdHJhdGlvbi5maWVsZHNfb2Zfc3R1ZHkgPz8gW10pIHtcbiAgICBjb25zdCBub3JtYWxpemVkID0gbm9ybWFsaXplUm9sZU5hbWUoZmllbGQpO1xuICAgIGlmICghbm9ybWFsaXplZCkgY29udGludWU7XG4gICAgcm9sZU5hbWVzLmFkZChub3JtYWxpemVSb2xlTmFtZShtYXBwZWRPckRlZmF1bHQoXCJmaWVsZHNfb2Zfc3R1ZHlcIiwgbm9ybWFsaXplZCwgXCJGaWVsZFwiKSkpO1xuICB9XG5cbiAgZm9yIChjb25zdCBpbnRlcmVzdCBvZiByZWdpc3RyYXRpb24uaW50ZXJlc3RzID8/IFtdKSB7XG4gICAgY29uc3Qgbm9ybWFsaXplZCA9IG5vcm1hbGl6ZVJvbGVOYW1lKGludGVyZXN0KTtcbiAgICBpZiAoIW5vcm1hbGl6ZWQpIGNvbnRpbnVlO1xuICAgIHJvbGVOYW1lcy5hZGQobm9ybWFsaXplUm9sZU5hbWUobWFwcGVkT3JEZWZhdWx0KFwiaW50ZXJlc3RzXCIsIG5vcm1hbGl6ZWQsIFwiSW50ZXJlc3RcIikpKTtcbiAgfVxuXG4gIGlmIChyZWdpc3RyYXRpb24ubGV2ZWxfb2Zfc3R1ZHkpIHtcbiAgICBjb25zdCBub3JtYWxpemVkID0gbm9ybWFsaXplUm9sZU5hbWUocmVnaXN0cmF0aW9uLmxldmVsX29mX3N0dWR5KTtcbiAgICBpZiAobm9ybWFsaXplZCkge1xuICAgICAgcm9sZU5hbWVzLmFkZChub3JtYWxpemVSb2xlTmFtZShtYXBwZWRPckRlZmF1bHQoXCJsZXZlbF9vZl9zdHVkeVwiLCBub3JtYWxpemVkLCBcIkxldmVsXCIpKSk7XG4gICAgfVxuICB9XG5cbiAgY29uc3Qgc2Nob29sVmFsdWUgPVxuICAgIHJlZ2lzdHJhdGlvbi5zY2hvb2wgPT09IFwiT3RoZXJcIiA/IG5vcm1hbGl6ZVJvbGVOYW1lKHJlZ2lzdHJhdGlvbi5zY2hvb2xfb3RoZXIgPz8gXCJcIikgOiBub3JtYWxpemVSb2xlTmFtZShyZWdpc3RyYXRpb24uc2Nob29sID8/IFwiXCIpO1xuICBpZiAoc2Nob29sVmFsdWUpIHtcbiAgICByb2xlTmFtZXMuYWRkKG5vcm1hbGl6ZVJvbGVOYW1lKG1hcHBlZE9yRGVmYXVsdChcInNjaG9vbFwiLCBzY2hvb2xWYWx1ZSwgXCJTY2hvb2xcIikpKTtcbiAgfVxuXG4gIGlmIChyZWdpc3RyYXRpb24udGVhbV9tb2RlID09PSBcImZyZWVfYWdlbnRcIikge1xuICAgIHJvbGVOYW1lcy5hZGQoUk9MRV9NQVAudGVhbV9tb2RlLmZyZWVfYWdlbnQpO1xuICB9XG5cbiAgaWYgKHJlZ2lzdHJhdGlvbi50ZWFtX21vZGUgPT09IFwidGVhbVwiKSB7XG4gICAgY29uc3QgdGVhbU5hbWUgPSBub3JtYWxpemVSb2xlTmFtZShyZWdpc3RyYXRpb24udGVhbV9uYW1lID8/IFwiXCIpO1xuICAgIGlmICh0ZWFtTmFtZSkge1xuICAgICAgcm9sZU5hbWVzLmFkZChub3JtYWxpemVSb2xlTmFtZShgVGVhbTogJHt0ZWFtTmFtZX1gKSk7XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIEFycmF5LmZyb20ocm9sZU5hbWVzKTtcbn1cblxuZnVuY3Rpb24gZ2V0TWVtYmVyVG9wUm9sZVBvc2l0aW9uKG1lbWJlclJvbGVJZHM6IHN0cmluZ1tdLCBndWlsZFJvbGVzQnlJZDogTWFwPHN0cmluZywgUm9sZT4pOiBudW1iZXIge1xuICBsZXQgdG9wUG9zaXRpb24gPSAwO1xuICBmb3IgKGNvbnN0IHJvbGVJZCBvZiBtZW1iZXJSb2xlSWRzKSB7XG4gICAgY29uc3Qgcm9sZSA9IGd1aWxkUm9sZXNCeUlkLmdldChyb2xlSWQpO1xuICAgIGlmICghcm9sZSkgY29udGludWU7XG4gICAgaWYgKHJvbGUucG9zaXRpb24gPiB0b3BQb3NpdGlvbikge1xuICAgICAgdG9wUG9zaXRpb24gPSByb2xlLnBvc2l0aW9uO1xuICAgIH1cbiAgfVxuICByZXR1cm4gdG9wUG9zaXRpb247XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBhc3NpZ25Sb2xlc0Zyb21SZWdpc3RyYXRpb24oaW5wdXQ6IEFzc2lnblJvbGVzSW5wdXQpOiBQcm9taXNlPEFzc2lnblJvbGVzUmVzdWx0PiB7XG4gIGNvbnN0IHRvdGFsU3RhcnQgPSBwZXJmb3JtYW5jZS5ub3coKTtcbiAgY29uc3QgZGVzaXJlZFJvbGVOYW1lcyA9IGJ1aWxkRGVzaXJlZFJvbGVOYW1lcyhpbnB1dC5yZWdpc3RyYXRpb24pO1xuICBpZiAoZGVzaXJlZFJvbGVOYW1lcy5sZW5ndGggPT09IDApIHtcbiAgICBsb2dWZXJpZnlUaW1pbmcoXCJyb2xlcy50b3RhbFwiLCBwZXJmb3JtYW5jZS5ub3coKSAtIHRvdGFsU3RhcnQsIFwiZGVzaXJlZF9yb2xlcz0wXCIpO1xuICAgIHJldHVybiB7XG4gICAgICBhc3NpZ25lZFJvbGVOYW1lczogW10sXG4gICAgICBza2lwcGVkRXhpc3RpbmdSb2xlTmFtZXM6IFtdLFxuICAgICAgc2tpcHBlZEhpZXJhcmNoeVJvbGVOYW1lczogW10sXG4gICAgICBmYWlsZWRSb2xlTmFtZXM6IFtdLFxuICAgIH07XG4gIH1cblxuICBjb25zdCBsaXN0Um9sZXNTdGFydCA9IHBlcmZvcm1hbmNlLm5vdygpO1xuICBjb25zdCBndWlsZFJvbGVzID0gYXdhaXQgbGlzdEd1aWxkUm9sZXMoaW5wdXQuZ3VpbGRJZCk7XG4gIGxvZ1ZlcmlmeVRpbWluZyhcInJvbGVzLmxpc3RHdWlsZFJvbGVzXCIsIHBlcmZvcm1hbmNlLm5vdygpIC0gbGlzdFJvbGVzU3RhcnQsIGBndWlsZF9yb2xlcz0ke2d1aWxkUm9sZXMubGVuZ3RofWApO1xuICBjb25zdCBndWlsZFJvbGVzQnlJZCA9IG5ldyBNYXAoZ3VpbGRSb2xlcy5tYXAoKHJvbGUpID0+IFtyb2xlLmlkLCByb2xlXSkpO1xuICBjb25zdCByb2xlQnlMb3dlck5hbWUgPSBuZXcgTWFwKGd1aWxkUm9sZXMubWFwKChyb2xlKSA9PiBbcm9sZS5uYW1lLnRvTG93ZXJDYXNlKCksIHJvbGVdKSk7XG5cbiAgY29uc3QgYm90VXNlclN0YXJ0ID0gcGVyZm9ybWFuY2Uubm93KCk7XG4gIGNvbnN0IGJvdFVzZXJJZCA9IGF3YWl0IGdldEJvdFVzZXJJZCgpO1xuICBsb2dWZXJpZnlUaW1pbmcoXCJyb2xlcy5nZXRCb3RVc2VySWRcIiwgcGVyZm9ybWFuY2Uubm93KCkgLSBib3RVc2VyU3RhcnQpO1xuICBjb25zdCBtZW1iZXJzU3RhcnQgPSBwZXJmb3JtYW5jZS5ub3coKTtcbiAgY29uc3QgW21lbWJlciwgYm90TWVtYmVyXSA9IGF3YWl0IFByb21pc2UuYWxsKFtcbiAgICBnZXRHdWlsZE1lbWJlcihpbnB1dC5ndWlsZElkLCBpbnB1dC5kaXNjb3JkVXNlcklkKSxcbiAgICBnZXRHdWlsZE1lbWJlcihpbnB1dC5ndWlsZElkLCBib3RVc2VySWQpLFxuICBdKTtcbiAgbG9nVmVyaWZ5VGltaW5nKFwicm9sZXMuZ2V0R3VpbGRNZW1iZXJzXCIsIHBlcmZvcm1hbmNlLm5vdygpIC0gbWVtYmVyc1N0YXJ0KTtcblxuICBjb25zdCBtZW1iZXJSb2xlSWRzID0gbmV3IFNldChtZW1iZXIucm9sZXMpO1xuICBjb25zdCBib3RUb3BSb2xlUG9zaXRpb24gPSBnZXRNZW1iZXJUb3BSb2xlUG9zaXRpb24oYm90TWVtYmVyLnJvbGVzLCBndWlsZFJvbGVzQnlJZCk7XG5cbiAgY29uc3Qgc2tpcHBlZEV4aXN0aW5nUm9sZU5hbWVzOiBzdHJpbmdbXSA9IFtdO1xuICBjb25zdCBza2lwcGVkSGllcmFyY2h5Um9sZU5hbWVzOiBzdHJpbmdbXSA9IFtdO1xuICBjb25zdCBmYWlsZWRSb2xlTmFtZXM6IHN0cmluZ1tdID0gW107XG4gIGNvbnN0IGFzc2lnbm1lbnRRdWV1ZTogQXJyYXk8eyByb2xlTmFtZTogc3RyaW5nOyByb2xlSWQ6IHN0cmluZyB9PiA9IFtdO1xuXG4gIGNvbnN0IG1pc3NpbmdSb2xlTmFtZXM6IHN0cmluZ1tdID0gW107XG4gIGZvciAoY29uc3QgZGVzaXJlZFJvbGVOYW1lIG9mIGRlc2lyZWRSb2xlTmFtZXMpIHtcbiAgICBjb25zdCByb2xlS2V5ID0gZGVzaXJlZFJvbGVOYW1lLnRvTG93ZXJDYXNlKCk7XG4gICAgY29uc3Qgcm9sZSA9IHJvbGVCeUxvd2VyTmFtZS5nZXQocm9sZUtleSk7XG4gICAgaWYgKCFyb2xlKSB7XG4gICAgICBtaXNzaW5nUm9sZU5hbWVzLnB1c2goZGVzaXJlZFJvbGVOYW1lKTtcbiAgICB9XG4gIH1cblxuICBjb25zdCBjcmVhdGVSb2xlc1N0YXJ0ID0gcGVyZm9ybWFuY2Uubm93KCk7XG4gIGNvbnN0IHJvbGVDcmVhdGlvblJlc3VsdHMgPSBhd2FpdCBQcm9taXNlLmFsbFNldHRsZWQoXG4gICAgbWlzc2luZ1JvbGVOYW1lcy5tYXAoYXN5bmMgKHJvbGVOYW1lKSA9PiB7XG4gICAgICBjb25zdCBjcmVhdGVkID0gYXdhaXQgY3JlYXRlR3VpbGRSb2xlKGlucHV0Lmd1aWxkSWQsIHJvbGVOYW1lKTtcbiAgICAgIHJldHVybiBjcmVhdGVkO1xuICAgIH0pXG4gICk7XG4gIGxvZ1ZlcmlmeVRpbWluZyhcInJvbGVzLmNyZWF0ZU1pc3NpbmdSb2xlc1wiLCBwZXJmb3JtYW5jZS5ub3coKSAtIGNyZWF0ZVJvbGVzU3RhcnQsIGBhdHRlbXB0ZWQ9JHttaXNzaW5nUm9sZU5hbWVzLmxlbmd0aH1gKTtcblxuICByb2xlQ3JlYXRpb25SZXN1bHRzLmZvckVhY2goKHJlc3VsdCwgaW5kZXgpID0+IHtcbiAgICBjb25zdCByb2xlTmFtZSA9IG1pc3NpbmdSb2xlTmFtZXNbaW5kZXhdO1xuICAgIGlmICghcm9sZU5hbWUpIHJldHVybjtcblxuICAgIGlmIChyZXN1bHQuc3RhdHVzID09PSBcInJlamVjdGVkXCIpIHtcbiAgICAgIGZhaWxlZFJvbGVOYW1lcy5wdXNoKHJvbGVOYW1lKTtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gY3JlYXRlIHJvbGU6XCIsIHJvbGVOYW1lLCByZXN1bHQucmVhc29uKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCBjcmVhdGVkUm9sZSA9IHJlc3VsdC52YWx1ZTtcbiAgICByb2xlQnlMb3dlck5hbWUuc2V0KGNyZWF0ZWRSb2xlLm5hbWUudG9Mb3dlckNhc2UoKSwgY3JlYXRlZFJvbGUpO1xuICAgIGd1aWxkUm9sZXNCeUlkLnNldChjcmVhdGVkUm9sZS5pZCwgY3JlYXRlZFJvbGUpO1xuICB9KTtcblxuICBmb3IgKGNvbnN0IGRlc2lyZWRSb2xlTmFtZSBvZiBkZXNpcmVkUm9sZU5hbWVzKSB7XG4gICAgY29uc3Qgcm9sZSA9IHJvbGVCeUxvd2VyTmFtZS5nZXQoZGVzaXJlZFJvbGVOYW1lLnRvTG93ZXJDYXNlKCkpO1xuICAgIGlmICghcm9sZSkge1xuICAgICAgY29udGludWU7XG4gICAgfVxuXG4gICAgaWYgKG1lbWJlclJvbGVJZHMuaGFzKHJvbGUuaWQpKSB7XG4gICAgICBza2lwcGVkRXhpc3RpbmdSb2xlTmFtZXMucHVzaChyb2xlLm5hbWUpO1xuICAgICAgY29udGludWU7XG4gICAgfVxuXG4gICAgaWYgKHJvbGUucG9zaXRpb24gPj0gYm90VG9wUm9sZVBvc2l0aW9uKSB7XG4gICAgICBza2lwcGVkSGllcmFyY2h5Um9sZU5hbWVzLnB1c2gocm9sZS5uYW1lKTtcbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cblxuICAgIGFzc2lnbm1lbnRRdWV1ZS5wdXNoKHsgcm9sZU5hbWU6IHJvbGUubmFtZSwgcm9sZUlkOiByb2xlLmlkIH0pO1xuICB9XG5cbiAgY29uc3QgYm91bmRlZEFzc2lnbm1lbnRRdWV1ZSA9IGFzc2lnbm1lbnRRdWV1ZS5zbGljZSgwLCBNYXRoLm1heCgwLCBNQVhfUk9MRV9PUEVSQVRJT05TKSk7XG4gIGZvciAoY29uc3Qgc2tpcHBlZCBvZiBhc3NpZ25tZW50UXVldWUuc2xpY2UoYm91bmRlZEFzc2lnbm1lbnRRdWV1ZS5sZW5ndGgpKSB7XG4gICAgZmFpbGVkUm9sZU5hbWVzLnB1c2goc2tpcHBlZC5yb2xlTmFtZSk7XG4gICAgY29uc29sZS5lcnJvcihcIlNraXBwaW5nIHJvbGUgYXNzaWdubWVudCBkdWUgdG8gTUFYX1JPTEVfT1BFUkFUSU9OUyBjYXA6XCIsIHNraXBwZWQucm9sZU5hbWUpO1xuICB9XG5cbiAgY29uc3QgYXNzaWduU3RhcnQgPSBwZXJmb3JtYW5jZS5ub3coKTtcbiAgY29uc3QgYXNzaWdubWVudHMgPSBhd2FpdCBQcm9taXNlLmFsbFNldHRsZWQoXG4gICAgYm91bmRlZEFzc2lnbm1lbnRRdWV1ZS5tYXAoYXN5bmMgKHsgcm9sZU5hbWUsIHJvbGVJZCB9KSA9PiB7XG4gICAgICBhd2FpdCBhc3NpZ25Sb2xlVG9NZW1iZXIoaW5wdXQuZ3VpbGRJZCwgaW5wdXQuZGlzY29yZFVzZXJJZCwgcm9sZUlkKTtcbiAgICAgIHJldHVybiByb2xlTmFtZTtcbiAgICB9KVxuICApO1xuICBsb2dWZXJpZnlUaW1pbmcoXG4gICAgXCJyb2xlcy5hc3NpZ25Sb2xlQ2FsbHNcIixcbiAgICBwZXJmb3JtYW5jZS5ub3coKSAtIGFzc2lnblN0YXJ0LFxuICAgIGBhdHRlbXB0ZWQ9JHtib3VuZGVkQXNzaWdubWVudFF1ZXVlLmxlbmd0aH0gY2FwcGVkX2J5X21heD0ke01hdGgubWF4KDAsIGFzc2lnbm1lbnRRdWV1ZS5sZW5ndGggLSBib3VuZGVkQXNzaWdubWVudFF1ZXVlLmxlbmd0aCl9YFxuICApO1xuXG4gIGNvbnN0IGFzc2lnbmVkUm9sZU5hbWVzOiBzdHJpbmdbXSA9IFtdO1xuXG4gIGFzc2lnbm1lbnRzLmZvckVhY2goKHJlc3VsdCwgaW5kZXgpID0+IHtcbiAgICBjb25zdCByb2xlTmFtZSA9IGJvdW5kZWRBc3NpZ25tZW50UXVldWVbaW5kZXhdPy5yb2xlTmFtZTtcbiAgICBpZiAoIXJvbGVOYW1lKSByZXR1cm47XG5cbiAgICBpZiAocmVzdWx0LnN0YXR1cyA9PT0gXCJmdWxmaWxsZWRcIikge1xuICAgICAgYXNzaWduZWRSb2xlTmFtZXMucHVzaChyZXN1bHQudmFsdWUpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGZhaWxlZFJvbGVOYW1lcy5wdXNoKHJvbGVOYW1lKTtcbiAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIGFzc2lnbiByb2xlOlwiLCByb2xlTmFtZSwgcmVzdWx0LnJlYXNvbik7XG4gIH0pO1xuXG4gIGNvbnN0IHJlc3VsdCA9IHtcbiAgICBhc3NpZ25lZFJvbGVOYW1lcyxcbiAgICBza2lwcGVkRXhpc3RpbmdSb2xlTmFtZXMsXG4gICAgc2tpcHBlZEhpZXJhcmNoeVJvbGVOYW1lcyxcbiAgICBmYWlsZWRSb2xlTmFtZXMsXG4gIH07XG4gIGxvZ1ZlcmlmeVRpbWluZyhcbiAgICBcInJvbGVzLnRvdGFsXCIsXG4gICAgcGVyZm9ybWFuY2Uubm93KCkgLSB0b3RhbFN0YXJ0LFxuICAgIGBkZXNpcmVkPSR7ZGVzaXJlZFJvbGVOYW1lcy5sZW5ndGh9IGFzc2lnbmVkPSR7YXNzaWduZWRSb2xlTmFtZXMubGVuZ3RofSBmYWlsZWQ9JHtmYWlsZWRSb2xlTmFtZXMubGVuZ3RofWBcbiAgKTtcbiAgcmV0dXJuIHJlc3VsdDtcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGVkaXRPcmlnaW5hbEludGVyYWN0aW9uUmVzcG9uc2UoaW5wdXQ6IEVkaXRPcmlnaW5hbEludGVyYWN0aW9uUmVzcG9uc2VJbnB1dCk6IFByb21pc2U8dm9pZD4ge1xuICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoV2l0aFRpbWVvdXQoXG4gICAgYCR7RElTQ09SRF9BUElfQkFTRX0vd2ViaG9va3MvJHtpbnB1dC5hcHBsaWNhdGlvbklkfS8ke2lucHV0LmludGVyYWN0aW9uVG9rZW59L21lc3NhZ2VzL0BvcmlnaW5hbGAsXG4gICAge1xuICAgICAgbWV0aG9kOiBcIlBBVENIXCIsXG4gICAgICBoZWFkZXJzOiB7XG4gICAgICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiLFxuICAgICAgfSxcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgY29udGVudDogaW5wdXQuY29udGVudCxcbiAgICAgIH0pLFxuICAgIH1cbiAgKTtcblxuICBpZiAoIXJlc3BvbnNlLm9rKSB7XG4gICAgY29uc3QgYm9keSA9IGF3YWl0IHJlc3BvbnNlLnRleHQoKTtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYEZhaWxlZCB0byBlZGl0IG9yaWdpbmFsIGludGVyYWN0aW9uIHJlc3BvbnNlICgke3Jlc3BvbnNlLnN0YXR1c30pOiAke2JvZHl9YCk7XG4gIH1cbn1cbiJdLCJuYW1lcyI6WyJST0xFX01BUCIsIkRJU0NPUkRfQVBJX0JBU0UiLCJESVNDT1JEX0FQSV9USU1FT1VUX01TIiwiTnVtYmVyIiwicHJvY2VzcyIsImVudiIsIk1BWF9ST0xFX09QRVJBVElPTlMiLCJFTkFCTEVfVkVSSUZZX1RJTUlOR19MT0dTIiwiVkVSSUZZX1RJTUlOR19MT0dTIiwiRElTQ09SRF9CT1RfVVNFUl9JRCIsIkRJU0NPUkRfVE9LRU4iLCJESVNDT1JEX0JPVF9UT0tFTiIsImRpc2NvcmRCb3RUb2tlbiIsImNhY2hlZEJvdFVzZXJJZCIsImxvZ1ZlcmlmeVRpbWluZyIsInN0ZXAiLCJkdXJhdGlvbk1zIiwiZGV0YWlscyIsInN1ZmZpeCIsImNvbnNvbGUiLCJpbmZvIiwidG9GaXhlZCIsImZldGNoV2l0aFRpbWVvdXQiLCJ1cmwiLCJpbml0IiwiY29udHJvbGxlciIsIkFib3J0Q29udHJvbGxlciIsInRpbWVvdXQiLCJzZXRUaW1lb3V0IiwiYWJvcnQiLCJmZXRjaCIsInNpZ25hbCIsImNsZWFyVGltZW91dCIsImRpc2NvcmRBcGkiLCJwYXRoIiwiRXJyb3IiLCJyZXNwb25zZSIsImhlYWRlcnMiLCJBdXRob3JpemF0aW9uIiwib2siLCJib2R5IiwidGV4dCIsIm1ldGhvZCIsInN0YXR1cyIsInVuZGVmaW5lZCIsImpzb24iLCJnZXRCb3RVc2VySWQiLCJkYXRhIiwiaWQiLCJsaXN0R3VpbGRSb2xlcyIsImd1aWxkSWQiLCJnZXRHdWlsZE1lbWJlciIsInVzZXJJZCIsImNyZWF0ZUd1aWxkUm9sZSIsInJvbGVOYW1lIiwiSlNPTiIsInN0cmluZ2lmeSIsIm5hbWUiLCJwZXJtaXNzaW9ucyIsImhvaXN0IiwibWVudGlvbmFibGUiLCJhc3NpZ25Sb2xlVG9NZW1iZXIiLCJyb2xlSWQiLCJub3JtYWxpemVSb2xlTmFtZSIsInZhbHVlIiwicmVwbGFjZSIsInRyaW0iLCJzbGljZSIsIm1hcHBlZE9yRGVmYXVsdCIsImNhdGVnb3J5IiwiZmFsbGJhY2tQcmVmaXgiLCJtYXBwZWQiLCJidWlsZERlc2lyZWRSb2xlTmFtZXMiLCJyZWdpc3RyYXRpb24iLCJyb2xlTmFtZXMiLCJTZXQiLCJmaWVsZCIsImZpZWxkc19vZl9zdHVkeSIsIm5vcm1hbGl6ZWQiLCJhZGQiLCJpbnRlcmVzdCIsImludGVyZXN0cyIsImxldmVsX29mX3N0dWR5Iiwic2Nob29sVmFsdWUiLCJzY2hvb2wiLCJzY2hvb2xfb3RoZXIiLCJ0ZWFtX21vZGUiLCJmcmVlX2FnZW50IiwidGVhbU5hbWUiLCJ0ZWFtX25hbWUiLCJBcnJheSIsImZyb20iLCJnZXRNZW1iZXJUb3BSb2xlUG9zaXRpb24iLCJtZW1iZXJSb2xlSWRzIiwiZ3VpbGRSb2xlc0J5SWQiLCJ0b3BQb3NpdGlvbiIsInJvbGUiLCJnZXQiLCJwb3NpdGlvbiIsImFzc2lnblJvbGVzRnJvbVJlZ2lzdHJhdGlvbiIsImlucHV0IiwidG90YWxTdGFydCIsInBlcmZvcm1hbmNlIiwibm93IiwiZGVzaXJlZFJvbGVOYW1lcyIsImxlbmd0aCIsImFzc2lnbmVkUm9sZU5hbWVzIiwic2tpcHBlZEV4aXN0aW5nUm9sZU5hbWVzIiwic2tpcHBlZEhpZXJhcmNoeVJvbGVOYW1lcyIsImZhaWxlZFJvbGVOYW1lcyIsImxpc3RSb2xlc1N0YXJ0IiwiZ3VpbGRSb2xlcyIsIk1hcCIsIm1hcCIsInJvbGVCeUxvd2VyTmFtZSIsInRvTG93ZXJDYXNlIiwiYm90VXNlclN0YXJ0IiwiYm90VXNlcklkIiwibWVtYmVyc1N0YXJ0IiwibWVtYmVyIiwiYm90TWVtYmVyIiwiUHJvbWlzZSIsImFsbCIsImRpc2NvcmRVc2VySWQiLCJyb2xlcyIsImJvdFRvcFJvbGVQb3NpdGlvbiIsImFzc2lnbm1lbnRRdWV1ZSIsIm1pc3NpbmdSb2xlTmFtZXMiLCJkZXNpcmVkUm9sZU5hbWUiLCJyb2xlS2V5IiwicHVzaCIsImNyZWF0ZVJvbGVzU3RhcnQiLCJyb2xlQ3JlYXRpb25SZXN1bHRzIiwiYWxsU2V0dGxlZCIsImNyZWF0ZWQiLCJmb3JFYWNoIiwicmVzdWx0IiwiaW5kZXgiLCJlcnJvciIsInJlYXNvbiIsImNyZWF0ZWRSb2xlIiwic2V0IiwiaGFzIiwiYm91bmRlZEFzc2lnbm1lbnRRdWV1ZSIsIk1hdGgiLCJtYXgiLCJza2lwcGVkIiwiYXNzaWduU3RhcnQiLCJhc3NpZ25tZW50cyIsImVkaXRPcmlnaW5hbEludGVyYWN0aW9uUmVzcG9uc2UiLCJhcHBsaWNhdGlvbklkIiwiaW50ZXJhY3Rpb25Ub2tlbiIsImNvbnRlbnQiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api-node)/./lib/discord/assignRolesFromRegistration.ts\n");

/***/ }),

/***/ "(api-node)/./lib/discord/roleMap.ts":
/*!********************************!*\
  !*** ./lib/discord/roleMap.ts ***!
  \********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   ROLE_MAP: () => (/* binding */ ROLE_MAP)\n/* harmony export */ });\nconst ROLE_MAP = {\n    interests: {\n        \"Drones / UAVs\": \"Interest: Drones / UAVs\",\n        \"Aerospace Systems\": \"Interest: Aerospace Systems\",\n        Robotics: \"Interest: Robotics\",\n        \"Embedded Systems\": \"Interest: Embedded Systems\",\n        \"Hardware Hacking\": \"Interest: Hardware Hacking\",\n        \"AI / Machine Learning\": \"Interest: AI / Machine Learning\",\n        \"Computer Vision\": \"Interest: Computer Vision\",\n        \"Data Science\": \"Interest: Data Science\",\n        Sustainability: \"Interest: Sustainability\",\n        \"Healthcare / MedTech\": \"Interest: Healthcare / MedTech\",\n        \"Defense / Security\": \"Interest: Defense / Security\",\n        \"Entrepreneurship / Startups\": \"Interest: Entrepreneurship / Startups\",\n        Other: \"Interest: Other\"\n    },\n    fields_of_study: {\n        \"Aerospace Engineering\": \"Field: Aerospace Engineering\",\n        \"Mechanical Engineering\": \"Field: Mechanical Engineering\",\n        \"Electrical Engineering\": \"Field: Electrical Engineering\",\n        \"Computer Engineering\": \"Field: Computer Engineering\",\n        \"Software Engineering\": \"Field: Software Engineering\",\n        \"Computer Science\": \"Field: Computer Science\",\n        Physics: \"Field: Physics\",\n        Mathematics: \"Field: Mathematics\",\n        \"Biology / Life Sciences\": \"Field: Biology / Life Sciences\",\n        \"Business / Management\": \"Field: Business / Management\",\n        Economics: \"Field: Economics\",\n        Other: \"Field: Other\"\n    },\n    level_of_study: {\n        \"Less than Secondary / High School\": \"Level: Pre-Secondary\",\n        \"Secondary / High School\": \"Level: Secondary / High School\",\n        \"Undergraduate University (2 year - community college or similar)\": \"Level: Undergraduate (2 year)\",\n        \"Undergraduate University (3+ year)\": \"Level: Undergraduate (3+ year)\",\n        \"Graduate University (Masters, Professional, Doctoral, etc)\": \"Level: Graduate\",\n        \"Code School / Bootcamp\": \"Level: Code School / Bootcamp\",\n        \"Other Vocational / Trade Program or Apprenticeship\": \"Level: Vocational / Trade\",\n        \"Post Doctorate\": \"Level: Post Doctorate\",\n        \"I’m not currently a student\": \"Level: Not Currently a Student\",\n        \"Prefer not to answer\": \"Level: Prefer Not to Answer\",\n        Other: \"Level: Other\"\n    },\n    school: {\n        \"McGill University\": \"School: McGill University\",\n        \"Concordia University\": \"School: Concordia University\",\n        \"Université de Montréal\": \"School: Université de Montréal\",\n        \"Polytechnique Montréal\": \"School: Polytechnique Montréal\",\n        \"HEC Montréal\": \"School: HEC Montréal\",\n        UQAM: \"School: UQAM\",\n        \"ÉTS\": \"School: ÉTS\",\n        \"Dawson College\": \"School: Dawson College\",\n        \"John Abbott College\": \"School: John Abbott College\",\n        \"Marianopolis College\": \"School: Marianopolis College\",\n        \"Vanier College\": \"School: Vanier College\",\n        \"Champlain College (St-Lambert)\": \"School: Champlain College (St-Lambert)\",\n        \"Cégep du Vieux Montréal\": \"School: Cégep du Vieux Montréal\",\n        \"Cégep de Maisonneuve\": \"School: Cégep de Maisonneuve\",\n        \"Cégep André-Laurendeau\": \"School: Cégep André-Laurendeau\",\n        \"Cégep Ahuntsic\": \"School: Cégep Ahuntsic\",\n        \"Cégep Rosemont\": \"School: Cégep Rosemont\",\n        \"Collège de Bois-de-Boulogne\": \"School: Collège de Bois-de-Boulogne\",\n        \"Université Laval\": \"School: Université Laval\",\n        \"Université de Sherbrooke\": \"School: Université de Sherbrooke\",\n        \"Bishop’s University\": \"School: Bishop’s University\",\n        UQTR: \"School: UQTR\",\n        UQO: \"School: UQO\"\n    },\n    team_mode: {\n        free_agent: \"Free Agent\"\n    }\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaS1ub2RlKS8uL2xpYi9kaXNjb3JkL3JvbGVNYXAudHMiLCJtYXBwaW5ncyI6Ijs7OztBQUFPLE1BQU1BLFdBQVc7SUFDdEJDLFdBQVc7UUFDVCxpQkFBaUI7UUFDakIscUJBQXFCO1FBQ3JCQyxVQUFVO1FBQ1Ysb0JBQW9CO1FBQ3BCLG9CQUFvQjtRQUNwQix5QkFBeUI7UUFDekIsbUJBQW1CO1FBQ25CLGdCQUFnQjtRQUNoQkMsZ0JBQWdCO1FBQ2hCLHdCQUF3QjtRQUN4QixzQkFBc0I7UUFDdEIsK0JBQStCO1FBQy9CQyxPQUFPO0lBQ1Q7SUFDQUMsaUJBQWlCO1FBQ2YseUJBQXlCO1FBQ3pCLDBCQUEwQjtRQUMxQiwwQkFBMEI7UUFDMUIsd0JBQXdCO1FBQ3hCLHdCQUF3QjtRQUN4QixvQkFBb0I7UUFDcEJDLFNBQVM7UUFDVEMsYUFBYTtRQUNiLDJCQUEyQjtRQUMzQix5QkFBeUI7UUFDekJDLFdBQVc7UUFDWEosT0FBTztJQUNUO0lBQ0FLLGdCQUFnQjtRQUNkLHFDQUFxQztRQUNyQywyQkFBMkI7UUFDM0Isb0VBQW9FO1FBQ3BFLHNDQUFzQztRQUN0Qyw4REFBOEQ7UUFDOUQsMEJBQTBCO1FBQzFCLHNEQUFzRDtRQUN0RCxrQkFBa0I7UUFDbEIsK0JBQStCO1FBQy9CLHdCQUF3QjtRQUN4QkwsT0FBTztJQUNUO0lBQ0FNLFFBQVE7UUFDTixxQkFBcUI7UUFDckIsd0JBQXdCO1FBQ3hCLDBCQUEwQjtRQUMxQiwwQkFBMEI7UUFDMUIsZ0JBQWdCO1FBQ2hCQyxNQUFNO1FBQ04sT0FBTztRQUNQLGtCQUFrQjtRQUNsQix1QkFBdUI7UUFDdkIsd0JBQXdCO1FBQ3hCLGtCQUFrQjtRQUNsQixrQ0FBa0M7UUFDbEMsMkJBQTJCO1FBQzNCLHdCQUF3QjtRQUN4QiwwQkFBMEI7UUFDMUIsa0JBQWtCO1FBQ2xCLGtCQUFrQjtRQUNsQiwrQkFBK0I7UUFDL0Isb0JBQW9CO1FBQ3BCLDRCQUE0QjtRQUM1Qix1QkFBdUI7UUFDdkJDLE1BQU07UUFDTkMsS0FBSztJQUNQO0lBQ0FDLFdBQVc7UUFDVEMsWUFBWTtJQUNkO0FBQ0YsRUFBVyIsInNvdXJjZXMiOlsiL1VzZXJzL3NjYXJib2NoYW4vRG9jdW1lbnRzL0dpdEh1Yi9hZXJvaGFja3Nib3QvbGliL2Rpc2NvcmQvcm9sZU1hcC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgY29uc3QgUk9MRV9NQVAgPSB7XG4gIGludGVyZXN0czoge1xuICAgIFwiRHJvbmVzIC8gVUFWc1wiOiBcIkludGVyZXN0OiBEcm9uZXMgLyBVQVZzXCIsXG4gICAgXCJBZXJvc3BhY2UgU3lzdGVtc1wiOiBcIkludGVyZXN0OiBBZXJvc3BhY2UgU3lzdGVtc1wiLFxuICAgIFJvYm90aWNzOiBcIkludGVyZXN0OiBSb2JvdGljc1wiLFxuICAgIFwiRW1iZWRkZWQgU3lzdGVtc1wiOiBcIkludGVyZXN0OiBFbWJlZGRlZCBTeXN0ZW1zXCIsXG4gICAgXCJIYXJkd2FyZSBIYWNraW5nXCI6IFwiSW50ZXJlc3Q6IEhhcmR3YXJlIEhhY2tpbmdcIixcbiAgICBcIkFJIC8gTWFjaGluZSBMZWFybmluZ1wiOiBcIkludGVyZXN0OiBBSSAvIE1hY2hpbmUgTGVhcm5pbmdcIixcbiAgICBcIkNvbXB1dGVyIFZpc2lvblwiOiBcIkludGVyZXN0OiBDb21wdXRlciBWaXNpb25cIixcbiAgICBcIkRhdGEgU2NpZW5jZVwiOiBcIkludGVyZXN0OiBEYXRhIFNjaWVuY2VcIixcbiAgICBTdXN0YWluYWJpbGl0eTogXCJJbnRlcmVzdDogU3VzdGFpbmFiaWxpdHlcIixcbiAgICBcIkhlYWx0aGNhcmUgLyBNZWRUZWNoXCI6IFwiSW50ZXJlc3Q6IEhlYWx0aGNhcmUgLyBNZWRUZWNoXCIsXG4gICAgXCJEZWZlbnNlIC8gU2VjdXJpdHlcIjogXCJJbnRlcmVzdDogRGVmZW5zZSAvIFNlY3VyaXR5XCIsXG4gICAgXCJFbnRyZXByZW5ldXJzaGlwIC8gU3RhcnR1cHNcIjogXCJJbnRlcmVzdDogRW50cmVwcmVuZXVyc2hpcCAvIFN0YXJ0dXBzXCIsXG4gICAgT3RoZXI6IFwiSW50ZXJlc3Q6IE90aGVyXCIsXG4gIH0sXG4gIGZpZWxkc19vZl9zdHVkeToge1xuICAgIFwiQWVyb3NwYWNlIEVuZ2luZWVyaW5nXCI6IFwiRmllbGQ6IEFlcm9zcGFjZSBFbmdpbmVlcmluZ1wiLFxuICAgIFwiTWVjaGFuaWNhbCBFbmdpbmVlcmluZ1wiOiBcIkZpZWxkOiBNZWNoYW5pY2FsIEVuZ2luZWVyaW5nXCIsXG4gICAgXCJFbGVjdHJpY2FsIEVuZ2luZWVyaW5nXCI6IFwiRmllbGQ6IEVsZWN0cmljYWwgRW5naW5lZXJpbmdcIixcbiAgICBcIkNvbXB1dGVyIEVuZ2luZWVyaW5nXCI6IFwiRmllbGQ6IENvbXB1dGVyIEVuZ2luZWVyaW5nXCIsXG4gICAgXCJTb2Z0d2FyZSBFbmdpbmVlcmluZ1wiOiBcIkZpZWxkOiBTb2Z0d2FyZSBFbmdpbmVlcmluZ1wiLFxuICAgIFwiQ29tcHV0ZXIgU2NpZW5jZVwiOiBcIkZpZWxkOiBDb21wdXRlciBTY2llbmNlXCIsXG4gICAgUGh5c2ljczogXCJGaWVsZDogUGh5c2ljc1wiLFxuICAgIE1hdGhlbWF0aWNzOiBcIkZpZWxkOiBNYXRoZW1hdGljc1wiLFxuICAgIFwiQmlvbG9neSAvIExpZmUgU2NpZW5jZXNcIjogXCJGaWVsZDogQmlvbG9neSAvIExpZmUgU2NpZW5jZXNcIixcbiAgICBcIkJ1c2luZXNzIC8gTWFuYWdlbWVudFwiOiBcIkZpZWxkOiBCdXNpbmVzcyAvIE1hbmFnZW1lbnRcIixcbiAgICBFY29ub21pY3M6IFwiRmllbGQ6IEVjb25vbWljc1wiLFxuICAgIE90aGVyOiBcIkZpZWxkOiBPdGhlclwiLFxuICB9LFxuICBsZXZlbF9vZl9zdHVkeToge1xuICAgIFwiTGVzcyB0aGFuIFNlY29uZGFyeSAvIEhpZ2ggU2Nob29sXCI6IFwiTGV2ZWw6IFByZS1TZWNvbmRhcnlcIixcbiAgICBcIlNlY29uZGFyeSAvIEhpZ2ggU2Nob29sXCI6IFwiTGV2ZWw6IFNlY29uZGFyeSAvIEhpZ2ggU2Nob29sXCIsXG4gICAgXCJVbmRlcmdyYWR1YXRlIFVuaXZlcnNpdHkgKDIgeWVhciAtIGNvbW11bml0eSBjb2xsZWdlIG9yIHNpbWlsYXIpXCI6IFwiTGV2ZWw6IFVuZGVyZ3JhZHVhdGUgKDIgeWVhcilcIixcbiAgICBcIlVuZGVyZ3JhZHVhdGUgVW5pdmVyc2l0eSAoMysgeWVhcilcIjogXCJMZXZlbDogVW5kZXJncmFkdWF0ZSAoMysgeWVhcilcIixcbiAgICBcIkdyYWR1YXRlIFVuaXZlcnNpdHkgKE1hc3RlcnMsIFByb2Zlc3Npb25hbCwgRG9jdG9yYWwsIGV0YylcIjogXCJMZXZlbDogR3JhZHVhdGVcIixcbiAgICBcIkNvZGUgU2Nob29sIC8gQm9vdGNhbXBcIjogXCJMZXZlbDogQ29kZSBTY2hvb2wgLyBCb290Y2FtcFwiLFxuICAgIFwiT3RoZXIgVm9jYXRpb25hbCAvIFRyYWRlIFByb2dyYW0gb3IgQXBwcmVudGljZXNoaXBcIjogXCJMZXZlbDogVm9jYXRpb25hbCAvIFRyYWRlXCIsXG4gICAgXCJQb3N0IERvY3RvcmF0ZVwiOiBcIkxldmVsOiBQb3N0IERvY3RvcmF0ZVwiLFxuICAgIFwiSeKAmW0gbm90IGN1cnJlbnRseSBhIHN0dWRlbnRcIjogXCJMZXZlbDogTm90IEN1cnJlbnRseSBhIFN0dWRlbnRcIixcbiAgICBcIlByZWZlciBub3QgdG8gYW5zd2VyXCI6IFwiTGV2ZWw6IFByZWZlciBOb3QgdG8gQW5zd2VyXCIsXG4gICAgT3RoZXI6IFwiTGV2ZWw6IE90aGVyXCIsXG4gIH0sXG4gIHNjaG9vbDoge1xuICAgIFwiTWNHaWxsIFVuaXZlcnNpdHlcIjogXCJTY2hvb2w6IE1jR2lsbCBVbml2ZXJzaXR5XCIsXG4gICAgXCJDb25jb3JkaWEgVW5pdmVyc2l0eVwiOiBcIlNjaG9vbDogQ29uY29yZGlhIFVuaXZlcnNpdHlcIixcbiAgICBcIlVuaXZlcnNpdMOpIGRlIE1vbnRyw6lhbFwiOiBcIlNjaG9vbDogVW5pdmVyc2l0w6kgZGUgTW9udHLDqWFsXCIsXG4gICAgXCJQb2x5dGVjaG5pcXVlIE1vbnRyw6lhbFwiOiBcIlNjaG9vbDogUG9seXRlY2huaXF1ZSBNb250csOpYWxcIixcbiAgICBcIkhFQyBNb250csOpYWxcIjogXCJTY2hvb2w6IEhFQyBNb250csOpYWxcIixcbiAgICBVUUFNOiBcIlNjaG9vbDogVVFBTVwiLFxuICAgIFwiw4lUU1wiOiBcIlNjaG9vbDogw4lUU1wiLFxuICAgIFwiRGF3c29uIENvbGxlZ2VcIjogXCJTY2hvb2w6IERhd3NvbiBDb2xsZWdlXCIsXG4gICAgXCJKb2huIEFiYm90dCBDb2xsZWdlXCI6IFwiU2Nob29sOiBKb2huIEFiYm90dCBDb2xsZWdlXCIsXG4gICAgXCJNYXJpYW5vcG9saXMgQ29sbGVnZVwiOiBcIlNjaG9vbDogTWFyaWFub3BvbGlzIENvbGxlZ2VcIixcbiAgICBcIlZhbmllciBDb2xsZWdlXCI6IFwiU2Nob29sOiBWYW5pZXIgQ29sbGVnZVwiLFxuICAgIFwiQ2hhbXBsYWluIENvbGxlZ2UgKFN0LUxhbWJlcnQpXCI6IFwiU2Nob29sOiBDaGFtcGxhaW4gQ29sbGVnZSAoU3QtTGFtYmVydClcIixcbiAgICBcIkPDqWdlcCBkdSBWaWV1eCBNb250csOpYWxcIjogXCJTY2hvb2w6IEPDqWdlcCBkdSBWaWV1eCBNb250csOpYWxcIixcbiAgICBcIkPDqWdlcCBkZSBNYWlzb25uZXV2ZVwiOiBcIlNjaG9vbDogQ8OpZ2VwIGRlIE1haXNvbm5ldXZlXCIsXG4gICAgXCJDw6lnZXAgQW5kcsOpLUxhdXJlbmRlYXVcIjogXCJTY2hvb2w6IEPDqWdlcCBBbmRyw6ktTGF1cmVuZGVhdVwiLFxuICAgIFwiQ8OpZ2VwIEFodW50c2ljXCI6IFwiU2Nob29sOiBDw6lnZXAgQWh1bnRzaWNcIixcbiAgICBcIkPDqWdlcCBSb3NlbW9udFwiOiBcIlNjaG9vbDogQ8OpZ2VwIFJvc2Vtb250XCIsXG4gICAgXCJDb2xsw6hnZSBkZSBCb2lzLWRlLUJvdWxvZ25lXCI6IFwiU2Nob29sOiBDb2xsw6hnZSBkZSBCb2lzLWRlLUJvdWxvZ25lXCIsXG4gICAgXCJVbml2ZXJzaXTDqSBMYXZhbFwiOiBcIlNjaG9vbDogVW5pdmVyc2l0w6kgTGF2YWxcIixcbiAgICBcIlVuaXZlcnNpdMOpIGRlIFNoZXJicm9va2VcIjogXCJTY2hvb2w6IFVuaXZlcnNpdMOpIGRlIFNoZXJicm9va2VcIixcbiAgICBcIkJpc2hvcOKAmXMgVW5pdmVyc2l0eVwiOiBcIlNjaG9vbDogQmlzaG9w4oCZcyBVbml2ZXJzaXR5XCIsXG4gICAgVVFUUjogXCJTY2hvb2w6IFVRVFJcIixcbiAgICBVUU86IFwiU2Nob29sOiBVUU9cIixcbiAgfSxcbiAgdGVhbV9tb2RlOiB7XG4gICAgZnJlZV9hZ2VudDogXCJGcmVlIEFnZW50XCIsXG4gIH0sXG59IGFzIGNvbnN0O1xuXG5leHBvcnQgdHlwZSBSb2xlTWFwQ2F0ZWdvcnkgPSBrZXlvZiB0eXBlb2YgUk9MRV9NQVA7XG4iXSwibmFtZXMiOlsiUk9MRV9NQVAiLCJpbnRlcmVzdHMiLCJSb2JvdGljcyIsIlN1c3RhaW5hYmlsaXR5IiwiT3RoZXIiLCJmaWVsZHNfb2Zfc3R1ZHkiLCJQaHlzaWNzIiwiTWF0aGVtYXRpY3MiLCJFY29ub21pY3MiLCJsZXZlbF9vZl9zdHVkeSIsInNjaG9vbCIsIlVRQU0iLCJVUVRSIiwiVVFPIiwidGVhbV9tb2RlIiwiZnJlZV9hZ2VudCJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api-node)/./lib/discord/roleMap.ts\n");

/***/ }),

/***/ "(api-node)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fdiscord%2Finteractions&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Fdiscord%2Finteractions.ts&middlewareConfigBase64=e30%3D!":
/*!**************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fdiscord%2Finteractions&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Fdiscord%2Finteractions.ts&middlewareConfigBase64=e30%3D! ***!
  \**************************************************************************************************************************************************************************************************************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   handler: () => (/* binding */ handler)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_api_utils__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/api-utils */ \"(api-node)/./node_modules/next/dist/server/api-utils/index.js\");\n/* harmony import */ var next_dist_server_api_utils__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_api_utils__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/route-kind */ \"(api-node)/./node_modules/next/dist/server/route-kind.js\");\n/* harmony import */ var next_dist_server_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/route-modules/pages-api/module.compiled */ \"(api-node)/./node_modules/next/dist/server/route-modules/pages-api/module.compiled.js\");\n/* harmony import */ var next_dist_server_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! next/dist/build/templates/helpers */ \"(api-node)/./node_modules/next/dist/build/templates/helpers.js\");\n/* harmony import */ var _pages_api_discord_interactions_ts__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./pages/api/discord/interactions.ts */ \"(api-node)/./pages/api/discord/interactions.ts\");\n/* harmony import */ var next_dist_server_lib_trace_tracer__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! next/dist/server/lib/trace/tracer */ \"(api-node)/./node_modules/next/dist/server/lib/trace/tracer.js\");\n/* harmony import */ var next_dist_server_lib_trace_tracer__WEBPACK_IMPORTED_MODULE_5___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_trace_tracer__WEBPACK_IMPORTED_MODULE_5__);\n/* harmony import */ var next_dist_server_lib_trace_constants__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! next/dist/server/lib/trace/constants */ \"(api-node)/./node_modules/next/dist/server/lib/trace/constants.js\");\n/* harmony import */ var next_dist_server_lib_trace_constants__WEBPACK_IMPORTED_MODULE_6___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_trace_constants__WEBPACK_IMPORTED_MODULE_6__);\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_pages_api_discord_interactions_ts__WEBPACK_IMPORTED_MODULE_4__]);\n_pages_api_discord_interactions_ts__WEBPACK_IMPORTED_MODULE_4__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n\n// Import the userland code.\n\n\n\n// Re-export the handler (should be the default export).\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_3__.hoist)(_pages_api_discord_interactions_ts__WEBPACK_IMPORTED_MODULE_4__, 'default'));\n// Re-export config.\nconst config = (0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_3__.hoist)(_pages_api_discord_interactions_ts__WEBPACK_IMPORTED_MODULE_4__, 'config');\n// Create and export the route module that will be consumed.\nconst routeModule = new next_dist_server_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_2__.PagesAPIRouteModule({\n    definition: {\n        kind: next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.PAGES_API,\n        page: \"/api/discord/interactions\",\n        pathname: \"/api/discord/interactions\",\n        // The following aren't used in production.\n        bundlePath: '',\n        filename: ''\n    },\n    userland: _pages_api_discord_interactions_ts__WEBPACK_IMPORTED_MODULE_4__,\n    distDir: \".next\" || 0,\n    relativeProjectDir:  false || ''\n});\nasync function handler(req, res, ctx) {\n    let srcPage = \"/api/discord/interactions\";\n    // turbopack doesn't normalize `/index` in the page name\n    // so we need to to process dynamic routes properly\n    // TODO: fix turbopack providing differing value from webpack\n    if (false) {}\n    const prepareResult = await routeModule.prepare(req, res, {\n        srcPage\n    });\n    if (!prepareResult) {\n        res.statusCode = 400;\n        res.end('Bad Request');\n        ctx.waitUntil == null ? void 0 : ctx.waitUntil.call(ctx, Promise.resolve());\n        return;\n    }\n    const { query, params, prerenderManifest, routerServerContext } = prepareResult;\n    try {\n        const method = req.method || 'GET';\n        const tracer = (0,next_dist_server_lib_trace_tracer__WEBPACK_IMPORTED_MODULE_5__.getTracer)();\n        const activeSpan = tracer.getActiveScopeSpan();\n        const onRequestError = routeModule.instrumentationOnRequestError.bind(routeModule);\n        const invokeRouteModule = async (span)=>routeModule.render(req, res, {\n                query: {\n                    ...query,\n                    ...params\n                },\n                params,\n                allowedRevalidateHeaderKeys: [],\n                multiZoneDraftMode: Boolean(false),\n                trustHostHeader: false,\n                // TODO: get this from from runtime env so manifest\n                // doesn't need to load\n                previewProps: prerenderManifest.preview,\n                propagateError: false,\n                dev: routeModule.isDev,\n                page: \"/api/discord/interactions\",\n                internalRevalidate: routerServerContext == null ? void 0 : routerServerContext.revalidate,\n                onError: (...args)=>onRequestError(req, ...args)\n            }).finally(()=>{\n                if (!span) return;\n                span.setAttributes({\n                    'http.status_code': res.statusCode,\n                    'next.rsc': false\n                });\n                const rootSpanAttributes = tracer.getRootSpanAttributes();\n                // We were unable to get attributes, probably OTEL is not enabled\n                if (!rootSpanAttributes) {\n                    return;\n                }\n                if (rootSpanAttributes.get('next.span_type') !== next_dist_server_lib_trace_constants__WEBPACK_IMPORTED_MODULE_6__.BaseServerSpan.handleRequest) {\n                    console.warn(`Unexpected root span type '${rootSpanAttributes.get('next.span_type')}'. Please report this Next.js issue https://github.com/vercel/next.js`);\n                    return;\n                }\n                const route = rootSpanAttributes.get('next.route');\n                if (route) {\n                    const name = `${method} ${route}`;\n                    span.setAttributes({\n                        'next.route': route,\n                        'http.route': route,\n                        'next.span_name': name\n                    });\n                    span.updateName(name);\n                } else {\n                    span.updateName(`${method} ${req.url}`);\n                }\n            });\n        // TODO: activeSpan code path is for when wrapped by\n        // next-server can be removed when this is no longer used\n        if (activeSpan) {\n            await invokeRouteModule(activeSpan);\n        } else {\n            await tracer.withPropagatedContext(req.headers, ()=>tracer.trace(next_dist_server_lib_trace_constants__WEBPACK_IMPORTED_MODULE_6__.BaseServerSpan.handleRequest, {\n                    spanName: `${method} ${req.url}`,\n                    kind: next_dist_server_lib_trace_tracer__WEBPACK_IMPORTED_MODULE_5__.SpanKind.SERVER,\n                    attributes: {\n                        'http.method': method,\n                        'http.target': req.url\n                    }\n                }, invokeRouteModule));\n        }\n    } catch (err) {\n        // we re-throw in dev to show the error overlay\n        if (routeModule.isDev) {\n            throw err;\n        }\n        // this is technically an invariant as error handling\n        // should be done inside of api-resolver onError\n        (0,next_dist_server_api_utils__WEBPACK_IMPORTED_MODULE_0__.sendError)(res, 500, 'Internal Server Error');\n    } finally{\n        // We don't allow any waitUntil work in pages API routes currently\n        // so if callback is present return with resolved promise since no\n        // pending work\n        ctx.waitUntil == null ? void 0 : ctx.waitUntil.call(ctx, Promise.resolve());\n    }\n}\n\n//# sourceMappingURL=pages-api.js.map\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaS1ub2RlKS8uL25vZGVfbW9kdWxlcy9uZXh0L2Rpc3QvYnVpbGQvd2VicGFjay9sb2FkZXJzL25leHQtcm91dGUtbG9hZGVyL2luZGV4LmpzP2tpbmQ9UEFHRVNfQVBJJnBhZ2U9JTJGYXBpJTJGZGlzY29yZCUyRmludGVyYWN0aW9ucyZwcmVmZXJyZWRSZWdpb249JmFic29sdXRlUGFnZVBhdGg9LiUyRnBhZ2VzJTJGYXBpJTJGZGlzY29yZCUyRmludGVyYWN0aW9ucy50cyZtaWRkbGV3YXJlQ29uZmlnQmFzZTY0PWUzMCUzRCEiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBdUQ7QUFDQztBQUN1QztBQUNyQztBQUMxRDtBQUNnRTtBQUNRO0FBQ0Y7QUFDdEU7QUFDQSxpRUFBZSx3RUFBSyxDQUFDLCtEQUFRLFlBQVksRUFBQztBQUMxQztBQUNPLGVBQWUsd0VBQUssQ0FBQywrREFBUTtBQUNwQztBQUNBLHdCQUF3Qix5R0FBbUI7QUFDM0M7QUFDQSxjQUFjLGtFQUFTO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsWUFBWTtBQUNaLGFBQWEsT0FBb0MsSUFBSSxDQUFFO0FBQ3ZELHdCQUF3QixNQUF1QztBQUMvRCxDQUFDO0FBQ007QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQVEsS0FBcUIsRUFBRSxFQUUxQjtBQUNMO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWSx3REFBd0Q7QUFDcEU7QUFDQTtBQUNBLHVCQUF1Qiw0RUFBUztBQUNoQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQSw2Q0FBNkMsRUFBNkM7QUFDMUYsNENBQTRDLEtBQXdDO0FBQ3BGLGlDQUFpQyxLQUFvQztBQUNyRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpRUFBaUUsZ0ZBQWM7QUFDL0UsK0RBQStELHlDQUF5QztBQUN4RztBQUNBO0FBQ0E7QUFDQTtBQUNBLG9DQUFvQyxRQUFRLEVBQUUsTUFBTTtBQUNwRDtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBLGtCQUFrQjtBQUNsQix1Q0FBdUMsUUFBUSxFQUFFLFFBQVE7QUFDekQ7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFVO0FBQ1YsNkVBQTZFLGdGQUFjO0FBQzNGLGlDQUFpQyxRQUFRLEVBQUUsUUFBUTtBQUNuRCwwQkFBMEIsdUVBQVE7QUFDbEM7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsUUFBUSxxRUFBUztBQUNqQixNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBIiwic291cmNlcyI6WyIiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgc2VuZEVycm9yIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvYXBpLXV0aWxzXCI7XG5pbXBvcnQgeyBSb3V0ZUtpbmQgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9yb3V0ZS1raW5kXCI7XG5pbXBvcnQgeyBQYWdlc0FQSVJvdXRlTW9kdWxlIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvcm91dGUtbW9kdWxlcy9wYWdlcy1hcGkvbW9kdWxlLmNvbXBpbGVkXCI7XG5pbXBvcnQgeyBob2lzdCB9IGZyb20gXCJuZXh0L2Rpc3QvYnVpbGQvdGVtcGxhdGVzL2hlbHBlcnNcIjtcbi8vIEltcG9ydCB0aGUgdXNlcmxhbmQgY29kZS5cbmltcG9ydCAqIGFzIHVzZXJsYW5kIGZyb20gXCIuL3BhZ2VzL2FwaS9kaXNjb3JkL2ludGVyYWN0aW9ucy50c1wiO1xuaW1wb3J0IHsgZ2V0VHJhY2VyLCBTcGFuS2luZCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2xpYi90cmFjZS90cmFjZXJcIjtcbmltcG9ydCB7IEJhc2VTZXJ2ZXJTcGFuIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvbGliL3RyYWNlL2NvbnN0YW50c1wiO1xuLy8gUmUtZXhwb3J0IHRoZSBoYW5kbGVyIChzaG91bGQgYmUgdGhlIGRlZmF1bHQgZXhwb3J0KS5cbmV4cG9ydCBkZWZhdWx0IGhvaXN0KHVzZXJsYW5kLCAnZGVmYXVsdCcpO1xuLy8gUmUtZXhwb3J0IGNvbmZpZy5cbmV4cG9ydCBjb25zdCBjb25maWcgPSBob2lzdCh1c2VybGFuZCwgJ2NvbmZpZycpO1xuLy8gQ3JlYXRlIGFuZCBleHBvcnQgdGhlIHJvdXRlIG1vZHVsZSB0aGF0IHdpbGwgYmUgY29uc3VtZWQuXG5jb25zdCByb3V0ZU1vZHVsZSA9IG5ldyBQYWdlc0FQSVJvdXRlTW9kdWxlKHtcbiAgICBkZWZpbml0aW9uOiB7XG4gICAgICAgIGtpbmQ6IFJvdXRlS2luZC5QQUdFU19BUEksXG4gICAgICAgIHBhZ2U6IFwiL2FwaS9kaXNjb3JkL2ludGVyYWN0aW9uc1wiLFxuICAgICAgICBwYXRobmFtZTogXCIvYXBpL2Rpc2NvcmQvaW50ZXJhY3Rpb25zXCIsXG4gICAgICAgIC8vIFRoZSBmb2xsb3dpbmcgYXJlbid0IHVzZWQgaW4gcHJvZHVjdGlvbi5cbiAgICAgICAgYnVuZGxlUGF0aDogJycsXG4gICAgICAgIGZpbGVuYW1lOiAnJ1xuICAgIH0sXG4gICAgdXNlcmxhbmQsXG4gICAgZGlzdERpcjogcHJvY2Vzcy5lbnYuX19ORVhUX1JFTEFUSVZFX0RJU1RfRElSIHx8ICcnLFxuICAgIHJlbGF0aXZlUHJvamVjdERpcjogcHJvY2Vzcy5lbnYuX19ORVhUX1JFTEFUSVZFX1BST0pFQ1RfRElSIHx8ICcnXG59KTtcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBoYW5kbGVyKHJlcSwgcmVzLCBjdHgpIHtcbiAgICBsZXQgc3JjUGFnZSA9IFwiL2FwaS9kaXNjb3JkL2ludGVyYWN0aW9uc1wiO1xuICAgIC8vIHR1cmJvcGFjayBkb2Vzbid0IG5vcm1hbGl6ZSBgL2luZGV4YCBpbiB0aGUgcGFnZSBuYW1lXG4gICAgLy8gc28gd2UgbmVlZCB0byB0byBwcm9jZXNzIGR5bmFtaWMgcm91dGVzIHByb3Blcmx5XG4gICAgLy8gVE9ETzogZml4IHR1cmJvcGFjayBwcm92aWRpbmcgZGlmZmVyaW5nIHZhbHVlIGZyb20gd2VicGFja1xuICAgIGlmIChwcm9jZXNzLmVudi5UVVJCT1BBQ0spIHtcbiAgICAgICAgc3JjUGFnZSA9IHNyY1BhZ2UucmVwbGFjZSgvXFwvaW5kZXgkLywgJycpIHx8ICcvJztcbiAgICB9XG4gICAgY29uc3QgcHJlcGFyZVJlc3VsdCA9IGF3YWl0IHJvdXRlTW9kdWxlLnByZXBhcmUocmVxLCByZXMsIHtcbiAgICAgICAgc3JjUGFnZVxuICAgIH0pO1xuICAgIGlmICghcHJlcGFyZVJlc3VsdCkge1xuICAgICAgICByZXMuc3RhdHVzQ29kZSA9IDQwMDtcbiAgICAgICAgcmVzLmVuZCgnQmFkIFJlcXVlc3QnKTtcbiAgICAgICAgY3R4LndhaXRVbnRpbCA9PSBudWxsID8gdm9pZCAwIDogY3R4LndhaXRVbnRpbC5jYWxsKGN0eCwgUHJvbWlzZS5yZXNvbHZlKCkpO1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnN0IHsgcXVlcnksIHBhcmFtcywgcHJlcmVuZGVyTWFuaWZlc3QsIHJvdXRlclNlcnZlckNvbnRleHQgfSA9IHByZXBhcmVSZXN1bHQ7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgbWV0aG9kID0gcmVxLm1ldGhvZCB8fCAnR0VUJztcbiAgICAgICAgY29uc3QgdHJhY2VyID0gZ2V0VHJhY2VyKCk7XG4gICAgICAgIGNvbnN0IGFjdGl2ZVNwYW4gPSB0cmFjZXIuZ2V0QWN0aXZlU2NvcGVTcGFuKCk7XG4gICAgICAgIGNvbnN0IG9uUmVxdWVzdEVycm9yID0gcm91dGVNb2R1bGUuaW5zdHJ1bWVudGF0aW9uT25SZXF1ZXN0RXJyb3IuYmluZChyb3V0ZU1vZHVsZSk7XG4gICAgICAgIGNvbnN0IGludm9rZVJvdXRlTW9kdWxlID0gYXN5bmMgKHNwYW4pPT5yb3V0ZU1vZHVsZS5yZW5kZXIocmVxLCByZXMsIHtcbiAgICAgICAgICAgICAgICBxdWVyeToge1xuICAgICAgICAgICAgICAgICAgICAuLi5xdWVyeSxcbiAgICAgICAgICAgICAgICAgICAgLi4ucGFyYW1zXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBwYXJhbXMsXG4gICAgICAgICAgICAgICAgYWxsb3dlZFJldmFsaWRhdGVIZWFkZXJLZXlzOiBwcm9jZXNzLmVudi5fX05FWFRfQUxMT1dFRF9SRVZBTElEQVRFX0hFQURFUlMsXG4gICAgICAgICAgICAgICAgbXVsdGlab25lRHJhZnRNb2RlOiBCb29sZWFuKHByb2Nlc3MuZW52Ll9fTkVYVF9NVUxUSV9aT05FX0RSQUZUX01PREUpLFxuICAgICAgICAgICAgICAgIHRydXN0SG9zdEhlYWRlcjogcHJvY2Vzcy5lbnYuX19ORVhUX1RSVVNUX0hPU1RfSEVBREVSLFxuICAgICAgICAgICAgICAgIC8vIFRPRE86IGdldCB0aGlzIGZyb20gZnJvbSBydW50aW1lIGVudiBzbyBtYW5pZmVzdFxuICAgICAgICAgICAgICAgIC8vIGRvZXNuJ3QgbmVlZCB0byBsb2FkXG4gICAgICAgICAgICAgICAgcHJldmlld1Byb3BzOiBwcmVyZW5kZXJNYW5pZmVzdC5wcmV2aWV3LFxuICAgICAgICAgICAgICAgIHByb3BhZ2F0ZUVycm9yOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBkZXY6IHJvdXRlTW9kdWxlLmlzRGV2LFxuICAgICAgICAgICAgICAgIHBhZ2U6IFwiL2FwaS9kaXNjb3JkL2ludGVyYWN0aW9uc1wiLFxuICAgICAgICAgICAgICAgIGludGVybmFsUmV2YWxpZGF0ZTogcm91dGVyU2VydmVyQ29udGV4dCA9PSBudWxsID8gdm9pZCAwIDogcm91dGVyU2VydmVyQ29udGV4dC5yZXZhbGlkYXRlLFxuICAgICAgICAgICAgICAgIG9uRXJyb3I6ICguLi5hcmdzKT0+b25SZXF1ZXN0RXJyb3IocmVxLCAuLi5hcmdzKVxuICAgICAgICAgICAgfSkuZmluYWxseSgoKT0+e1xuICAgICAgICAgICAgICAgIGlmICghc3BhbikgcmV0dXJuO1xuICAgICAgICAgICAgICAgIHNwYW4uc2V0QXR0cmlidXRlcyh7XG4gICAgICAgICAgICAgICAgICAgICdodHRwLnN0YXR1c19jb2RlJzogcmVzLnN0YXR1c0NvZGUsXG4gICAgICAgICAgICAgICAgICAgICduZXh0LnJzYyc6IGZhbHNlXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgY29uc3Qgcm9vdFNwYW5BdHRyaWJ1dGVzID0gdHJhY2VyLmdldFJvb3RTcGFuQXR0cmlidXRlcygpO1xuICAgICAgICAgICAgICAgIC8vIFdlIHdlcmUgdW5hYmxlIHRvIGdldCBhdHRyaWJ1dGVzLCBwcm9iYWJseSBPVEVMIGlzIG5vdCBlbmFibGVkXG4gICAgICAgICAgICAgICAgaWYgKCFyb290U3BhbkF0dHJpYnV0ZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAocm9vdFNwYW5BdHRyaWJ1dGVzLmdldCgnbmV4dC5zcGFuX3R5cGUnKSAhPT0gQmFzZVNlcnZlclNwYW4uaGFuZGxlUmVxdWVzdCkge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oYFVuZXhwZWN0ZWQgcm9vdCBzcGFuIHR5cGUgJyR7cm9vdFNwYW5BdHRyaWJ1dGVzLmdldCgnbmV4dC5zcGFuX3R5cGUnKX0nLiBQbGVhc2UgcmVwb3J0IHRoaXMgTmV4dC5qcyBpc3N1ZSBodHRwczovL2dpdGh1Yi5jb20vdmVyY2VsL25leHQuanNgKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjb25zdCByb3V0ZSA9IHJvb3RTcGFuQXR0cmlidXRlcy5nZXQoJ25leHQucm91dGUnKTtcbiAgICAgICAgICAgICAgICBpZiAocm91dGUpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgbmFtZSA9IGAke21ldGhvZH0gJHtyb3V0ZX1gO1xuICAgICAgICAgICAgICAgICAgICBzcGFuLnNldEF0dHJpYnV0ZXMoe1xuICAgICAgICAgICAgICAgICAgICAgICAgJ25leHQucm91dGUnOiByb3V0ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICdodHRwLnJvdXRlJzogcm91dGUsXG4gICAgICAgICAgICAgICAgICAgICAgICAnbmV4dC5zcGFuX25hbWUnOiBuYW1lXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICBzcGFuLnVwZGF0ZU5hbWUobmFtZSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgc3Bhbi51cGRhdGVOYW1lKGAke21ldGhvZH0gJHtyZXEudXJsfWApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAvLyBUT0RPOiBhY3RpdmVTcGFuIGNvZGUgcGF0aCBpcyBmb3Igd2hlbiB3cmFwcGVkIGJ5XG4gICAgICAgIC8vIG5leHQtc2VydmVyIGNhbiBiZSByZW1vdmVkIHdoZW4gdGhpcyBpcyBubyBsb25nZXIgdXNlZFxuICAgICAgICBpZiAoYWN0aXZlU3Bhbikge1xuICAgICAgICAgICAgYXdhaXQgaW52b2tlUm91dGVNb2R1bGUoYWN0aXZlU3Bhbik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBhd2FpdCB0cmFjZXIud2l0aFByb3BhZ2F0ZWRDb250ZXh0KHJlcS5oZWFkZXJzLCAoKT0+dHJhY2VyLnRyYWNlKEJhc2VTZXJ2ZXJTcGFuLmhhbmRsZVJlcXVlc3QsIHtcbiAgICAgICAgICAgICAgICAgICAgc3Bhbk5hbWU6IGAke21ldGhvZH0gJHtyZXEudXJsfWAsXG4gICAgICAgICAgICAgICAgICAgIGtpbmQ6IFNwYW5LaW5kLlNFUlZFUixcbiAgICAgICAgICAgICAgICAgICAgYXR0cmlidXRlczoge1xuICAgICAgICAgICAgICAgICAgICAgICAgJ2h0dHAubWV0aG9kJzogbWV0aG9kLFxuICAgICAgICAgICAgICAgICAgICAgICAgJ2h0dHAudGFyZ2V0JzogcmVxLnVybFxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSwgaW52b2tlUm91dGVNb2R1bGUpKTtcbiAgICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAvLyB3ZSByZS10aHJvdyBpbiBkZXYgdG8gc2hvdyB0aGUgZXJyb3Igb3ZlcmxheVxuICAgICAgICBpZiAocm91dGVNb2R1bGUuaXNEZXYpIHtcbiAgICAgICAgICAgIHRocm93IGVycjtcbiAgICAgICAgfVxuICAgICAgICAvLyB0aGlzIGlzIHRlY2huaWNhbGx5IGFuIGludmFyaWFudCBhcyBlcnJvciBoYW5kbGluZ1xuICAgICAgICAvLyBzaG91bGQgYmUgZG9uZSBpbnNpZGUgb2YgYXBpLXJlc29sdmVyIG9uRXJyb3JcbiAgICAgICAgc2VuZEVycm9yKHJlcywgNTAwLCAnSW50ZXJuYWwgU2VydmVyIEVycm9yJyk7XG4gICAgfSBmaW5hbGx5e1xuICAgICAgICAvLyBXZSBkb24ndCBhbGxvdyBhbnkgd2FpdFVudGlsIHdvcmsgaW4gcGFnZXMgQVBJIHJvdXRlcyBjdXJyZW50bHlcbiAgICAgICAgLy8gc28gaWYgY2FsbGJhY2sgaXMgcHJlc2VudCByZXR1cm4gd2l0aCByZXNvbHZlZCBwcm9taXNlIHNpbmNlIG5vXG4gICAgICAgIC8vIHBlbmRpbmcgd29ya1xuICAgICAgICBjdHgud2FpdFVudGlsID09IG51bGwgPyB2b2lkIDAgOiBjdHgud2FpdFVudGlsLmNhbGwoY3R4LCBQcm9taXNlLnJlc29sdmUoKSk7XG4gICAgfVxufVxuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1wYWdlcy1hcGkuanMubWFwXG4iXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api-node)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fdiscord%2Finteractions&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Fdiscord%2Finteractions.ts&middlewareConfigBase64=e30%3D!\n");

/***/ }),

/***/ "(api-node)/./pages/api/discord/interactions.ts":
/*!*******************************************!*\
  !*** ./pages/api/discord/interactions.ts ***!
  \*******************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   \"default\": () => (/* binding */ handler)\n/* harmony export */ });\n/* harmony import */ var tweetnacl__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! tweetnacl */ \"tweetnacl\");\n/* harmony import */ var tweetnacl__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(tweetnacl__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _supabase_supabase_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @supabase/supabase-js */ \"@supabase/supabase-js\");\n/* harmony import */ var _lib_discord_assignRolesFromRegistration__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../lib/discord/assignRolesFromRegistration */ \"(api-node)/./lib/discord/assignRolesFromRegistration.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_1__]);\n_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_1__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\nconst config = {\n    api: {\n        bodyParser: false\n    }\n};\nconst ENABLE_VERIFY_TIMING_LOGS = process.env.VERIFY_TIMING_LOGS !== \"0\";\nconst MAX_TEAMMATE_RESULTS = Number(process.env.MAX_TEAMMATE_RESULTS ?? \"10\");\nconst TEAMMATE_QUERY_LIMIT = Number(process.env.TEAMMATE_QUERY_LIMIT ?? \"200\");\nclass MissingEnvError extends Error {\n    constructor(missingVars){\n        super(`Missing required env vars: ${missingVars.join(\", \")}`);\n        this.name = \"MissingEnvError\";\n        this.missingVars = missingVars;\n    }\n}\nlet runtimeConfigCache = null;\nfunction readEnv(name) {\n    const value = process.env[name];\n    if (!value) {\n        return undefined;\n    }\n    const normalized = value.trim();\n    return normalized.length > 0 ? normalized : undefined;\n}\nfunction resolveEnvValue(spec) {\n    const primaryValue = readEnv(spec.primaryName);\n    if (primaryValue) {\n        return primaryValue;\n    }\n    if (spec.fallbackName) {\n        return readEnv(spec.fallbackName) ?? null;\n    }\n    return null;\n}\nfunction getRuntimeConfig() {\n    if (runtimeConfigCache) {\n        return runtimeConfigCache;\n    }\n    const specs = [\n        {\n            primaryName: \"DISCORD_PUBLIC_KEY\",\n            fallbackName: \"PUBLIC_KEY\"\n        },\n        {\n            primaryName: \"SUPABASE_URL\"\n        },\n        {\n            primaryName: \"SUPABASE_SERVICE_ROLE_KEY\",\n            fallbackName: \"SUPABASE_KEY\"\n        }\n    ];\n    const resolved = {};\n    const missingVars = [];\n    for (const spec of specs){\n        const value = resolveEnvValue(spec);\n        if (value) {\n            resolved[spec.primaryName] = value;\n            continue;\n        }\n        missingVars.push(spec.fallbackName ? `${spec.primaryName} (or legacy fallback ${spec.fallbackName})` : spec.primaryName);\n    }\n    if (missingVars.length > 0) {\n        throw new MissingEnvError(missingVars);\n    }\n    runtimeConfigCache = {\n        discordPublicKeyHex: resolved.DISCORD_PUBLIC_KEY,\n        supabase: (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_1__.createClient)(resolved.SUPABASE_URL, resolved.SUPABASE_SERVICE_ROLE_KEY, {\n            auth: {\n                persistSession: false,\n                autoRefreshToken: false\n            }\n        })\n    };\n    return runtimeConfigCache;\n}\nfunction interactionResponse(content) {\n    return {\n        type: 4,\n        data: {\n            content,\n            flags: 64\n        }\n    };\n}\nasync function readRawBody(req) {\n    const chunks = [];\n    for await (const chunk of req){\n        chunks.push(typeof chunk === \"string\" ? Buffer.from(chunk) : chunk);\n    }\n    return Buffer.concat(chunks);\n}\nfunction verifyDiscordRequest(rawBody, signature, timestamp, publicKeyHex) {\n    try {\n        const message = Buffer.concat([\n            Buffer.from(timestamp, \"utf8\"),\n            rawBody\n        ]);\n        const signatureBytes = Buffer.from(signature, \"hex\");\n        const publicKeyBytes = Buffer.from(publicKeyHex, \"hex\");\n        return tweetnacl__WEBPACK_IMPORTED_MODULE_0___default().sign.detached.verify(message, signatureBytes, publicKeyBytes);\n    } catch  {\n        return false;\n    }\n}\nfunction getDiscordUser(interaction) {\n    return interaction.member?.user ?? interaction.user ?? null;\n}\nfunction getStringOption(interaction, optionName) {\n    const value = interaction.data?.options?.find((option)=>option.name === optionName)?.value;\n    if (!value || typeof value !== \"string\") {\n        return null;\n    }\n    const trimmed = value.trim();\n    return trimmed.length > 0 ? trimmed : null;\n}\nfunction getEmailOption(interaction) {\n    const email = getStringOption(interaction, \"email\");\n    return email ? email.toLowerCase() : null;\n}\nfunction getInterestOption(interaction) {\n    return getStringOption(interaction, \"interest\");\n}\nfunction escapePostgresLike(value) {\n    return value.replace(/[%_\\\\]/g, \"\\\\$&\");\n}\nfunction interactionDeferredResponse() {\n    return {\n        type: 5,\n        data: {\n            flags: 64\n        }\n    };\n}\nfunction normalizeListField(value) {\n    if (Array.isArray(value)) {\n        return value.map((item)=>typeof item === \"string\" ? item.trim() : \"\").filter((item)=>item.length > 0);\n    }\n    if (typeof value !== \"string\") {\n        return [];\n    }\n    const trimmed = value.trim();\n    if (!trimmed) {\n        return [];\n    }\n    if (trimmed.startsWith(\"[\") && trimmed.endsWith(\"]\")) {\n        try {\n            const parsed = JSON.parse(trimmed);\n            if (Array.isArray(parsed)) {\n                return parsed.map((item)=>typeof item === \"string\" ? item.trim() : \"\").filter((item)=>item.length > 0);\n            }\n        } catch  {\n        // Fall back to comma-separated parsing below.\n        }\n    }\n    return trimmed.split(\",\").map((item)=>item.trim()).filter((item)=>item.length > 0);\n}\nfunction normalizeKey(value) {\n    return value.trim().toLowerCase();\n}\nfunction isLookingForTeam(teamMode) {\n    if (!teamMode) {\n        return false;\n    }\n    const normalized = normalizeKey(teamMode).replace(/[_-]+/g, \" \");\n    return normalized === \"free agent\" || normalized === \"looking for a team\" || normalized === \"looking for team\";\n}\nfunction getRegistrationDisplayName(registration) {\n    const first = registration.first_name?.trim() ?? \"\";\n    const last = registration.last_name?.trim() ?? \"\";\n    const joined = `${first} ${last}`.trim();\n    return joined || \"Unknown\";\n}\nfunction truncateText(value, maxLength) {\n    if (value.length <= maxLength) {\n        return value;\n    }\n    return `${value.slice(0, Math.max(0, maxLength - 3))}...`;\n}\nasync function editInteractionResponse(interaction, content) {\n    await (0,_lib_discord_assignRolesFromRegistration__WEBPACK_IMPORTED_MODULE_2__.editOriginalInteractionResponse)({\n        applicationId: interaction.application_id,\n        interactionToken: interaction.token,\n        content\n    });\n}\nconst REGISTRATION_SELECT = \"email, first_name, last_name, discord_user_id, fields_of_study, interests, level_of_study, school, school_other, team_mode, team_name\";\nconst TEAMMATE_SELECT = \"first_name, last_name, school, level_of_study, interests, fields_of_study, discord_user_id, team_mode\";\nasync function findByDiscordUserId(discordUserId) {\n    const supabase = getRuntimeConfig().supabase;\n    const { data, error } = await supabase.from(\"registrations\").select(REGISTRATION_SELECT).eq(\"discord_user_id\", discordUserId).maybeSingle();\n    if (error) {\n        throw error;\n    }\n    return data ?? null;\n}\nasync function findByEmailCaseInsensitive(normalizedEmail) {\n    const supabase = getRuntimeConfig().supabase;\n    const escapedEmail = escapePostgresLike(normalizedEmail);\n    const { data, error } = await supabase.from(\"registrations\").select(REGISTRATION_SELECT).ilike(\"email\", escapedEmail).limit(2);\n    if (error) {\n        throw error;\n    }\n    if (!data || data.length === 0) {\n        return null;\n    }\n    if (data.length > 1) {\n        throw new Error(\"Multiple registrations matched this email; expected a single row.\");\n    }\n    return data[0];\n}\nasync function findTeammateCandidates(discordUserId) {\n    const supabase = getRuntimeConfig().supabase;\n    const { data, error } = await supabase.from(\"registrations\").select(TEAMMATE_SELECT).not(\"discord_user_id\", \"is\", \"null\").neq(\"discord_user_id\", discordUserId).limit(Math.max(1, TEAMMATE_QUERY_LIMIT));\n    if (error) {\n        throw error;\n    }\n    const rows = data ?? [];\n    return rows.filter((row)=>Boolean(row.discord_user_id) && isLookingForTeam(row.team_mode));\n}\nasync function verifyRegistration(discordUser, interaction) {\n    const supabase = getRuntimeConfig().supabase;\n    const providedEmail = getEmailOption(interaction);\n    if (!providedEmail) {\n        const existing = await findByDiscordUserId(discordUser.id);\n        if (!existing) {\n            return {\n                ok: false,\n                message: \"I couldn't automatically verify your Discord account. Please run /verify email:<your registration email>.\"\n            };\n        }\n        return {\n            ok: true,\n            registration: existing\n        };\n    }\n    const registration = await findByEmailCaseInsensitive(providedEmail);\n    if (!registration) {\n        return {\n            ok: false,\n            message: \"❌ Could not verify registration for that email. If you already registered, contact staff. Otherwise register at mcgillaerohacks.com.\"\n        };\n    }\n    if (registration.discord_user_id && registration.discord_user_id !== discordUser.id) {\n        return {\n            ok: false,\n            message: \"❌ That registration is already linked to a different Discord account. Contact staff for help.\"\n        };\n    }\n    const { data: updatedRegistration, error: updateError } = await supabase.from(\"registrations\").update({\n        discord_user_id: discordUser.id,\n        discord_username: discordUser.username ?? null,\n        discord_verified_at: new Date().toISOString()\n    }).eq(\"email\", registration.email).select(REGISTRATION_SELECT).single();\n    if (updateError) {\n        if (updateError.code === \"23505\") {\n            return {\n                ok: false,\n                message: \"❌ This Discord account is already linked to a registration. Contact staff if this is a mistake.\"\n            };\n        }\n        throw updateError;\n    }\n    return {\n        ok: true,\n        registration: updatedRegistration\n    };\n}\nfunction logVerifyTiming(step, durationMs, details) {\n    if (!ENABLE_VERIFY_TIMING_LOGS) {\n        return;\n    }\n    const suffix = details ? ` ${details}` : \"\";\n    console.info(`[verify-timing] ${step}: ${durationMs.toFixed(1)}ms${suffix}`);\n}\nfunction buildVerificationSuccessMessage(registration, roleResult, guildId) {\n    const lines = [\n        `✅ Verified: ${registration.first_name} ${registration.last_name}`\n    ];\n    if (!guildId) {\n        lines.push(\"You're verified, but role assignment only works in a server channel.\");\n        return lines.join(\"\\n\");\n    }\n    lines.push(\"We've assigned roles based on your program, interests, school, and team status.\");\n    if (!roleResult) {\n        return lines.join(\"\\n\");\n    }\n    if (roleResult.assignedRoleNames.length > 0) {\n        lines.push(`Assigned: ${roleResult.assignedRoleNames.join(\", \")}`);\n    } else {\n        lines.push(\"No new roles were needed.\");\n    }\n    if (roleResult.failedRoleNames.length > 0) {\n        lines.push(\"Some roles could not be assigned right now. Please contact staff if this persists.\");\n    }\n    return lines.join(\"\\n\");\n}\nfunction toRoleAssignmentRegistration(registration) {\n    return {\n        fields_of_study: normalizeListField(registration.fields_of_study),\n        interests: normalizeListField(registration.interests),\n        level_of_study: registration.level_of_study,\n        school: registration.school,\n        school_other: registration.school_other,\n        team_mode: registration.team_mode,\n        team_name: registration.team_name\n    };\n}\nfunction buildStatusMessage(registration) {\n    const lines = [\n        \"✅ Your verification status\",\n        `Name: ${getRegistrationDisplayName(registration)}`,\n        `Email: ${registration.email ?? \"N/A\"}`,\n        `School: ${registration.school ?? registration.school_other ?? \"N/A\"}`,\n        `Level: ${registration.level_of_study ?? \"N/A\"}`,\n        `Team mode: ${registration.team_mode ?? \"N/A\"}`\n    ];\n    if (registration.team_name) {\n        lines.push(`Team name: ${registration.team_name}`);\n    }\n    return lines.join(\"\\n\");\n}\nfunction buildTeammatesMessage(matches, interestFilter) {\n    const lines = [\n        \"🔍 Potential teammates\",\n        \"\"\n    ];\n    if (interestFilter) {\n        lines.push(`Filter: ${interestFilter}`, \"\");\n    }\n    let shown = 0;\n    const cappedMatches = matches.slice(0, Math.max(1, MAX_TEAMMATE_RESULTS));\n    for(let index = 0; index < cappedMatches.length; index += 1){\n        const match = cappedMatches[index];\n        if (!match) {\n            continue;\n        }\n        const candidate = match.candidate;\n        const mention = candidate.discord_user_id ? ` <@${candidate.discord_user_id}>` : \"\";\n        const name = getRegistrationDisplayName(candidate);\n        const school = candidate.school ?? \"N/A\";\n        const level = candidate.level_of_study ?? \"N/A\";\n        const matchParts = [];\n        if (match.matchedInterests.length > 0) {\n            matchParts.push(`Interests: ${match.matchedInterests.slice(0, 2).map((value)=>truncateText(value, 30)).join(\", \")}`);\n        }\n        if (match.matchedFields.length > 0) {\n            matchParts.push(`Fields: ${match.matchedFields.slice(0, 2).map((value)=>truncateText(value, 30)).join(\", \")}`);\n        }\n        const block = [\n            `${shown + 1}. ${name}${mention} (score ${match.score})`,\n            `   School: ${truncateText(school, 60)}`,\n            `   Level: ${truncateText(level, 60)}`,\n            matchParts.length > 0 ? `   Match: ${matchParts.join(\" | \")}` : null,\n            null\n        ].filter((line)=>Boolean(line)).join(\"\\n\");\n        const tentative = [\n            ...lines,\n            block\n        ].join(\"\\n\");\n        if (tentative.length > 1850) {\n            break;\n        }\n        lines.push(block);\n        shown += 1;\n    }\n    if (shown < matches.length) {\n        lines.push(`Showing ${shown} of ${matches.length} matches. Refine with interest:<keyword> for a narrower list.`);\n    }\n    lines.push(\"\", \"💡 Reach out in Discord DMs or server channels to form a team.\");\n    return lines.join(\"\\n\");\n}\nasync function processVerifyInteraction(interaction) {\n    const totalStart = performance.now();\n    const discordUser = getDiscordUser(interaction);\n    if (!discordUser?.id) {\n        await editInteractionResponse(interaction, \"Could not read your Discord account information.\");\n        return;\n    }\n    try {\n        const verifyStart = performance.now();\n        const verifyResult = await verifyRegistration(discordUser, interaction);\n        logVerifyTiming(\"verifyRegistration\", performance.now() - verifyStart, `interaction_id=${interaction.id}`);\n        if (!verifyResult.ok) {\n            const editStart = performance.now();\n            await editInteractionResponse(interaction, verifyResult.message);\n            logVerifyTiming(\"editOriginalInteractionResponse\", performance.now() - editStart, \"result=failure_message\");\n            logVerifyTiming(\"processVerifyInteraction.total\", performance.now() - totalStart, \"result=failed_verification\");\n            return;\n        }\n        let roleResult = null;\n        if (interaction.guild_id) {\n            const roleStart = performance.now();\n            roleResult = await (0,_lib_discord_assignRolesFromRegistration__WEBPACK_IMPORTED_MODULE_2__.assignRolesFromRegistration)({\n                guildId: interaction.guild_id,\n                discordUserId: discordUser.id,\n                registration: toRoleAssignmentRegistration(verifyResult.registration)\n            });\n            logVerifyTiming(\"assignRolesFromRegistration\", performance.now() - roleStart, `guild_id=${interaction.guild_id}`);\n        }\n        const editStart = performance.now();\n        await editInteractionResponse(interaction, buildVerificationSuccessMessage(verifyResult.registration, roleResult, interaction.guild_id));\n        logVerifyTiming(\"editOriginalInteractionResponse\", performance.now() - editStart, \"result=success_message\");\n        logVerifyTiming(\"processVerifyInteraction.total\", performance.now() - totalStart, \"result=success\");\n    } catch (error) {\n        console.error(\"verify command error\", error);\n        try {\n            const editStart = performance.now();\n            await editInteractionResponse(interaction, \"An internal error occurred. Please try again later.\");\n            logVerifyTiming(\"editOriginalInteractionResponse\", performance.now() - editStart, \"result=internal_error\");\n        } catch (followupError) {\n            console.error(\"Failed to send error follow-up:\", followupError);\n        }\n        logVerifyTiming(\"processVerifyInteraction.total\", performance.now() - totalStart, \"result=exception\");\n    }\n}\nasync function processStatusInteraction(interaction) {\n    const discordUser = getDiscordUser(interaction);\n    if (!discordUser?.id) {\n        await editInteractionResponse(interaction, \"Could not read your Discord account information.\");\n        return;\n    }\n    try {\n        const registration = await findByDiscordUserId(discordUser.id);\n        if (!registration) {\n            await editInteractionResponse(interaction, \"❌ You are not verified yet. Use /verify email:<your registration email>.\");\n            return;\n        }\n        await editInteractionResponse(interaction, buildStatusMessage(registration));\n    } catch (error) {\n        console.error(\"status command error\", error);\n        await editInteractionResponse(interaction, \"An internal error occurred while checking your status.\");\n    }\n}\nasync function processFindTeammatesInteraction(interaction) {\n    const discordUser = getDiscordUser(interaction);\n    if (!discordUser?.id) {\n        await editInteractionResponse(interaction, \"Could not read your Discord account information.\");\n        return;\n    }\n    try {\n        const userRegistration = await findByDiscordUserId(discordUser.id);\n        if (!userRegistration) {\n            await editInteractionResponse(interaction, \"❌ You need to verify first using /verify email:<your registration email>.\");\n            return;\n        }\n        const interestFilter = getInterestOption(interaction);\n        const normalizedFilter = interestFilter ? normalizeKey(interestFilter) : null;\n        const userInterestKeys = new Set(normalizeListField(userRegistration.interests).map(normalizeKey));\n        const userFieldKeys = new Set(normalizeListField(userRegistration.fields_of_study).map(normalizeKey));\n        const candidates = await findTeammateCandidates(discordUser.id);\n        const matches = [];\n        for (const candidate of candidates){\n            const candidateInterests = normalizeListField(candidate.interests);\n            const candidateFields = normalizeListField(candidate.fields_of_study);\n            if (normalizedFilter) {\n                const candidateText = `${candidateInterests.join(\" \")} ${candidateFields.join(\" \")}`.toLowerCase();\n                if (!candidateText.includes(normalizedFilter)) {\n                    continue;\n                }\n            }\n            const matchedInterests = candidateInterests.filter((value)=>userInterestKeys.has(normalizeKey(value)));\n            const matchedFields = candidateFields.filter((value)=>userFieldKeys.has(normalizeKey(value)));\n            const score = matchedInterests.length * 2 + matchedFields.length * 3;\n            matches.push({\n                score,\n                candidate,\n                matchedInterests,\n                matchedFields\n            });\n        }\n        matches.sort((a, b)=>{\n            if (b.score !== a.score) {\n                return b.score - a.score;\n            }\n            const aName = getRegistrationDisplayName(a.candidate).toLowerCase();\n            const bName = getRegistrationDisplayName(b.candidate).toLowerCase();\n            return aName.localeCompare(bName);\n        });\n        if (matches.length === 0) {\n            if (interestFilter) {\n                await editInteractionResponse(interaction, `😔 No teammates found matching \"${interestFilter}\". Try a broader filter.`);\n            } else {\n                await editInteractionResponse(interaction, \"😔 No one else is currently marked as looking for a team.\");\n            }\n            return;\n        }\n        await editInteractionResponse(interaction, buildTeammatesMessage(matches, interestFilter));\n    } catch (error) {\n        console.error(\"find_teammates command error\", error);\n        await editInteractionResponse(interaction, \"An internal error occurred while finding teammates.\");\n    }\n}\nasync function processHelpInteraction(interaction) {\n    const message = [\n        \"🤖 AeroHacks Bot Commands\",\n        \"\",\n        \"/verify email:<your registration email> - Verify and link your Discord account.\",\n        \"/status - Show your current verification details.\",\n        \"/find_teammates [interest] - Find participants marked as looking for a team.\",\n        \"/help - Show this message.\",\n        \"\",\n        \"If verification fails, contact staff with your registration email.\"\n    ].join(\"\\n\");\n    await editInteractionResponse(interaction, message);\n}\nasync function processCommandInteraction(interaction) {\n    const commandName = interaction.data?.name;\n    if (commandName === \"verify\") {\n        await processVerifyInteraction(interaction);\n        return;\n    }\n    if (commandName === \"status\") {\n        await processStatusInteraction(interaction);\n        return;\n    }\n    if (commandName === \"find_teammates\") {\n        await processFindTeammatesInteraction(interaction);\n        return;\n    }\n    if (commandName === \"help\") {\n        await processHelpInteraction(interaction);\n        return;\n    }\n    await editInteractionResponse(interaction, \"Unsupported command.\");\n}\nasync function handler(req, res) {\n    if (req.method !== \"POST\") {\n        res.status(405).json({\n            error: \"Method Not Allowed\"\n        });\n        return;\n    }\n    let runtimeConfig;\n    try {\n        runtimeConfig = getRuntimeConfig();\n    } catch (error) {\n        if (error instanceof MissingEnvError) {\n            console.error(`[config] Missing required env vars: ${error.missingVars.join(\", \")}`);\n            res.status(500).json({\n                error: \"Server misconfiguration: missing required environment variables.\"\n            });\n            return;\n        }\n        console.error(\"[config] Failed to initialize runtime configuration\", error);\n        res.status(500).json({\n            error: \"Server misconfiguration.\"\n        });\n        return;\n    }\n    const signature = req.headers[\"x-signature-ed25519\"];\n    const timestamp = req.headers[\"x-signature-timestamp\"];\n    if (typeof signature !== \"string\" || typeof timestamp !== \"string\") {\n        res.status(401).send(\"Invalid signature\");\n        return;\n    }\n    const rawBody = await readRawBody(req);\n    if (!verifyDiscordRequest(rawBody, signature, timestamp, runtimeConfig.discordPublicKeyHex)) {\n        res.status(401).send(\"Invalid signature\");\n        return;\n    }\n    let interaction;\n    try {\n        interaction = JSON.parse(rawBody.toString(\"utf8\"));\n    } catch  {\n        res.status(400).json({\n            error: \"Invalid JSON body\"\n        });\n        return;\n    }\n    if (interaction.type === 1) {\n        res.status(200).json({\n            type: 1\n        });\n        return;\n    }\n    if (interaction.type !== 2) {\n        res.status(200).json(interactionResponse(\"Unsupported interaction type.\"));\n        return;\n    }\n    res.status(200).json(interactionDeferredResponse());\n    await processCommandInteraction(interaction);\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaS1ub2RlKS8uL3BhZ2VzL2FwaS9kaXNjb3JkL2ludGVyYWN0aW9ucy50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7QUFDNkI7QUFDNkM7QUFDc0Q7QUFFekgsTUFBTUksU0FBUztJQUNwQkMsS0FBSztRQUNIQyxZQUFZO0lBQ2Q7QUFDRixFQUFFO0FBRUYsTUFBTUMsNEJBQTRCQyxRQUFRQyxHQUFHLENBQUNDLGtCQUFrQixLQUFLO0FBQ3JFLE1BQU1DLHVCQUF1QkMsT0FBT0osUUFBUUMsR0FBRyxDQUFDRSxvQkFBb0IsSUFBSTtBQUN4RSxNQUFNRSx1QkFBdUJELE9BQU9KLFFBQVFDLEdBQUcsQ0FBQ0ksb0JBQW9CLElBQUk7QUFZeEUsTUFBTUMsd0JBQXdCQztJQUc1QixZQUFZQyxXQUFxQixDQUFFO1FBQ2pDLEtBQUssQ0FBQyxDQUFDLDJCQUEyQixFQUFFQSxZQUFZQyxJQUFJLENBQUMsT0FBTztRQUM1RCxJQUFJLENBQUNDLElBQUksR0FBRztRQUNaLElBQUksQ0FBQ0YsV0FBVyxHQUFHQTtJQUNyQjtBQUNGO0FBRUEsSUFBSUcscUJBQTJDO0FBRS9DLFNBQVNDLFFBQVFGLElBQVk7SUFDM0IsTUFBTUcsUUFBUWIsUUFBUUMsR0FBRyxDQUFDUyxLQUFLO0lBQy9CLElBQUksQ0FBQ0csT0FBTztRQUNWLE9BQU9DO0lBQ1Q7SUFDQSxNQUFNQyxhQUFhRixNQUFNRyxJQUFJO0lBQzdCLE9BQU9ELFdBQVdFLE1BQU0sR0FBRyxJQUFJRixhQUFhRDtBQUM5QztBQUVBLFNBQVNJLGdCQUFnQkMsSUFBdUI7SUFDOUMsTUFBTUMsZUFBZVIsUUFBUU8sS0FBS0UsV0FBVztJQUM3QyxJQUFJRCxjQUFjO1FBQ2hCLE9BQU9BO0lBQ1Q7SUFFQSxJQUFJRCxLQUFLRyxZQUFZLEVBQUU7UUFDckIsT0FBT1YsUUFBUU8sS0FBS0csWUFBWSxLQUFLO0lBQ3ZDO0lBRUEsT0FBTztBQUNUO0FBRUEsU0FBU0M7SUFDUCxJQUFJWixvQkFBb0I7UUFDdEIsT0FBT0E7SUFD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UXRDLEtBQUssQ0FBQyx1REFBdURBO1FBQ3JFeUcsSUFBSUUsTUFBTSxDQUFDLEtBQUtDLElBQUksQ0FBQztZQUFFNUcsT0FBTztRQUEyQjtRQUN6RDtJQUNGO0lBRUEsTUFBTTlELFlBQVlSLElBQUlvTCxPQUFPLENBQUMsc0JBQXNCO0lBQ3BELE1BQU0zSyxZQUFZVCxJQUFJb0wsT0FBTyxDQUFDLHdCQUF3QjtJQUV0RCxJQUFJLE9BQU81SyxjQUFjLFlBQVksT0FBT0MsY0FBYyxVQUFVO1FBQ2xFc0ssSUFBSUUsTUFBTSxDQUFDLEtBQUtJLElBQUksQ0FBQztRQUNyQjtJQUNGO0lBRUEsTUFBTTlLLFVBQVUsTUFBTVIsWUFBWUM7SUFDbEMsSUFBSSxDQUFDTSxxQkFBcUJDLFNBQVNDLFdBQVdDLFdBQVcwSyxjQUFjak0sbUJBQW1CLEdBQUc7UUFDM0Y2TCxJQUFJRSxNQUFNLENBQUMsS0FBS0ksSUFBSSxDQUFDO1FBQ3JCO0lBQ0Y7SUFFQSxJQUFJbks7SUFDSixJQUFJO1FBQ0ZBLGNBQWN5QixLQUFLQyxLQUFLLENBQUNyQyxRQUFRK0ssUUFBUSxDQUFDO0lBQzVDLEVBQUUsT0FBTTtRQUNOUCxJQUFJRSxNQUFNLENBQUMsS0FBS0MsSUFBSSxDQUFDO1lBQUU1RyxPQUFPO1FBQW9CO1FBQ2xEO0lBQ0Y7SUFFQSxJQUFJcEQsWUFBWXRCLElBQUksS0FBSyxHQUFHO1FBQzFCbUwsSUFBSUUsTUFBTSxDQUFDLEtBQUtDLElBQUksQ0FBQztZQUFFdEwsTUFBTTtRQUFFO1FBQy9CO0lBQ0Y7SUFFQSxJQUFJc0IsWUFBWXRCLElBQUksS0FBSyxHQUFHO1FBQzFCbUwsSUFBSUUsTUFBTSxDQUFDLEtBQUtDLElBQUksQ0FBQ3hMLG9CQUFvQjtRQUN6QztJQUNGO0lBRUFxTCxJQUFJRSxNQUFNLENBQUMsS0FBS0MsSUFBSSxDQUFDako7SUFDckIsTUFBTTJJLDBCQUEwQjFKO0FBQ2xDIiwic291cmNlcyI6WyIvVXNlcnMvc2NhcmJvY2hhbi9Eb2N1bWVudHMvR2l0SHViL2Flcm9oYWNrc2JvdC9wYWdlcy9hcGkvZGlzY29yZC9pbnRlcmFjdGlvbnMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHR5cGUgeyBOZXh0QXBpUmVxdWVzdCwgTmV4dEFwaVJlc3BvbnNlIH0gZnJvbSBcIm5leHRcIjtcbmltcG9ydCBuYWNsIGZyb20gXCJ0d2VldG5hY2xcIjtcbmltcG9ydCB7IGNyZWF0ZUNsaWVudCwgdHlwZSBTdXBhYmFzZUNsaWVudCB9IGZyb20gXCJAc3VwYWJhc2Uvc3VwYWJhc2UtanNcIjtcbmltcG9ydCB7IGFzc2lnblJvbGVzRnJvbVJlZ2lzdHJhdGlvbiwgZWRpdE9yaWdpbmFsSW50ZXJhY3Rpb25SZXNwb25zZSB9IGZyb20gXCIuLi8uLi8uLi9saWIvZGlzY29yZC9hc3NpZ25Sb2xlc0Zyb21SZWdpc3RyYXRpb25cIjtcblxuZXhwb3J0IGNvbnN0IGNvbmZpZyA9IHtcbiAgYXBpOiB7XG4gICAgYm9keVBhcnNlcjogZmFsc2UsXG4gIH0sXG59O1xuXG5jb25zdCBFTkFCTEVfVkVSSUZZX1RJTUlOR19MT0dTID0gcHJvY2Vzcy5lbnYuVkVSSUZZX1RJTUlOR19MT0dTICE9PSBcIjBcIjtcbmNvbnN0IE1BWF9URUFNTUFURV9SRVNVTFRTID0gTnVtYmVyKHByb2Nlc3MuZW52Lk1BWF9URUFNTUFURV9SRVNVTFRTID8/IFwiMTBcIik7XG5jb25zdCBURUFNTUFURV9RVUVSWV9MSU1JVCA9IE51bWJlcihwcm9jZXNzLmVudi5URUFNTUFURV9RVUVSWV9MSU1JVCA/PyBcIjIwMFwiKTtcblxudHlwZSBSdW50aW1lQ29uZmlnID0ge1xuICBkaXNjb3JkUHVibGljS2V5SGV4OiBzdHJpbmc7XG4gIHN1cGFiYXNlOiBTdXBhYmFzZUNsaWVudDtcbn07XG5cbnR5cGUgRW52UmVzb2x1dGlvblNwZWMgPSB7XG4gIHByaW1hcnlOYW1lOiBzdHJpbmc7XG4gIGZhbGxiYWNrTmFtZT86IHN0cmluZztcbn07XG5cbmNsYXNzIE1pc3NpbmdFbnZFcnJvciBleHRlbmRzIEVycm9yIHtcbiAgbWlzc2luZ1ZhcnM6IHN0cmluZ1tdO1xuXG4gIGNvbnN0cnVjdG9yKG1pc3NpbmdWYXJzOiBzdHJpbmdbXSkge1xuICAgIHN1cGVyKGBNaXNzaW5nIHJlcXVpcmVkIGVudiB2YXJzOiAke21pc3NpbmdWYXJzLmpvaW4oXCIsIFwiKX1gKTtcbiAgICB0aGlzLm5hbWUgPSBcIk1pc3NpbmdFbnZFcnJvclwiO1xuICAgIHRoaXMubWlzc2luZ1ZhcnMgPSBtaXNzaW5nVmFycztcbiAgfVxufVxuXG5sZXQgcnVudGltZUNvbmZpZ0NhY2hlOiBSdW50aW1lQ29uZmlnIHwgbnVsbCA9IG51bGw7XG5cbmZ1bmN0aW9uIHJlYWRFbnYobmFtZTogc3RyaW5nKTogc3RyaW5nIHwgdW5kZWZpbmVkIHtcbiAgY29uc3QgdmFsdWUgPSBwcm9jZXNzLmVudltuYW1lXTtcbiAgaWYgKCF2YWx1ZSkge1xuICAgIHJldHVybiB1bmRlZmluZWQ7XG4gIH1cbiAgY29uc3Qgbm9ybWFsaXplZCA9IHZhbHVlLnRyaW0oKTtcbiAgcmV0dXJuIG5vcm1hbGl6ZWQubGVuZ3RoID4gMCA/IG5vcm1hbGl6ZWQgOiB1bmRlZmluZWQ7XG59XG5cbmZ1bmN0aW9uIHJlc29sdmVFbnZWYWx1ZShzcGVjOiBFbnZSZXNvbHV0aW9uU3BlYyk6IHN0cmluZyB8IG51bGwge1xuICBjb25zdCBwcmltYXJ5VmFsdWUgPSByZWFkRW52KHNwZWMucHJpbWFyeU5hbWUpO1xuICBpZiAocHJpbWFyeVZhbHVlKSB7XG4gICAgcmV0dXJuIHByaW1hcnlWYWx1ZTtcbiAgfVxuXG4gIGlmIChzcGVjLmZhbGxiYWNrTmFtZSkge1xuICAgIHJldHVybiByZWFkRW52KHNwZWMuZmFsbGJhY2tOYW1lKSA/PyBudWxsO1xuICB9XG5cbiAgcmV0dXJuIG51bGw7XG59XG5cbmZ1bmN0aW9uIGdldFJ1bnRpbWVDb25maWcoKTogUnVudGltZUNvbmZpZyB7XG4gIGlmIChydW50aW1lQ29uZmlnQ2FjaGUpIHtcbiAgICByZXR1cm4gcnVudGltZUNvbmZpZ0NhY2hlO1xuICB9XG5cbiAgY29uc3Qgc3BlY3M6IEVudlJlc29sdXRpb25TcGVjW10gPSBbXG4gICAgeyBwcmltYXJ5TmFtZTogXCJESVNDT1JEX1BVQkxJQ19LRVlcIiwgZmFsbGJhY2tOYW1lOiBcIlBVQkxJQ19LRVlcIiB9LFxuICAgIHsgcHJpbWFyeU5hbWU6IFwiU1VQQUJBU0VfVVJMXCIgfSxcbiAgICB7IHByaW1hcnlOYW1lOiBcIlNVUEFCQVNFX1NFUlZJQ0VfUk9MRV9LRVlcIiwgZmFsbGJhY2tOYW1lOiBcIlNVUEFCQVNFX0tFWVwiIH0sXG4gIF07XG5cbiAgY29uc3QgcmVzb2x2ZWQ6IFJlY29yZDxzdHJpbmcsIHN0cmluZz4gPSB7fTtcbiAgY29uc3QgbWlzc2luZ1ZhcnM6IHN0cmluZ1tdID0gW107XG5cbiAgZm9yIChjb25zdCBzcGVjIG9mIHNwZWNzKSB7XG4gICAgY29uc3QgdmFsdWUgPSByZXNvbHZlRW52VmFsdWUoc3BlYyk7XG4gICAgaWYgKHZhbHVlKSB7XG4gICAgICByZXNvbHZlZFtzcGVjLnByaW1hcnlOYW1lXSA9IHZhbHVlO1xuICAgICAgY29udGludWU7XG4gICAgfVxuXG4gICAgbWlzc2luZ1ZhcnMucHVzaChcbiAgICAgIHNwZWMuZmFsbGJhY2tOYW1lXG4gICAgICAgID8gYCR7c3BlYy5wcmltYXJ5TmFtZX0gKG9yIGxlZ2FjeSBmYWxsYmFjayAke3NwZWMuZmFsbGJhY2tOYW1lfSlgXG4gICAgICAgIDogc3BlYy5wcmltYXJ5TmFtZVxuICAgICk7XG4gIH1cblxuICBpZiAobWlzc2luZ1ZhcnMubGVuZ3RoID4gMCkge1xuICAgIHRocm93IG5ldyBNaXNzaW5nRW52RXJyb3IobWlzc2luZ1ZhcnMpO1xuICB9XG5cbiAgcnVudGltZUNvbmZpZ0NhY2hlID0ge1xuICAgIGRpc2NvcmRQdWJsaWNLZXlIZXg6IHJlc29sdmVkLkRJU0NPUkRfUFVCTElDX0tFWSxcbiAgICBzdXBhYmFzZTogY3JlYXRlQ2xpZW50KHJlc29sdmVkLlNVUEFCQVNFX1VSTCwgcmVzb2x2ZWQuU1VQQUJBU0VfU0VSVklDRV9ST0xFX0tFWSwge1xuICAgICAgYXV0aDogeyBwZXJzaXN0U2Vzc2lvbjogZmFsc2UsIGF1dG9SZWZyZXNoVG9rZW46IGZhbHNlIH0sXG4gICAgfSksXG4gIH07XG4gIHJldHVybiBydW50aW1lQ29uZmlnQ2FjaGU7XG59XG5cbnR5cGUgRGlzY29yZFVzZXIgPSB7XG4gIGlkOiBzdHJpbmc7XG4gIHVzZXJuYW1lOiBzdHJpbmc7XG59O1xuXG50eXBlIEludGVyYWN0aW9uT3B0aW9uID0ge1xuICBuYW1lOiBzdHJpbmc7XG4gIHR5cGU6IG51bWJlcjtcbiAgdmFsdWU/OiBzdHJpbmc7XG59O1xuXG50eXBlIEludGVyYWN0aW9uID0ge1xuICBpZDogc3RyaW5nO1xuICB0b2tlbjogc3RyaW5nO1xuICBhcHBsaWNhdGlvbl9pZDogc3RyaW5nO1xuICB0eXBlOiBudW1iZXI7XG4gIGd1aWxkX2lkPzogc3RyaW5nO1xuICBkYXRhPzoge1xuICAgIG5hbWU/OiBzdHJpbmc7XG4gICAgb3B0aW9ucz86IEludGVyYWN0aW9uT3B0aW9uW107XG4gIH07XG4gIG1lbWJlcj86IHtcbiAgICB1c2VyPzogRGlzY29yZFVzZXI7XG4gICAgcm9sZXM/OiBzdHJpbmdbXTtcbiAgfTtcbiAgdXNlcj86IERpc2NvcmRVc2VyO1xufTtcblxudHlwZSBSZWdpc3RyYXRpb25MaXN0RmllbGQgPSBzdHJpbmdbXSB8IHN0cmluZyB8IG51bGw7XG5cbnR5cGUgUmVnaXN0cmF0aW9uID0ge1xuICBlbWFpbDogc3RyaW5nO1xuICBmaXJzdF9uYW1lOiBzdHJpbmc7XG4gIGxhc3RfbmFtZTogc3RyaW5nO1xuICBkaXNjb3JkX3VzZXJfaWQ6IHN0cmluZyB8IG51bGw7XG4gIGZpZWxkc19vZl9zdHVkeTogUmVnaXN0cmF0aW9uTGlzdEZpZWxkO1xuICBpbnRlcmVzdHM6IFJlZ2lzdHJhdGlvbkxpc3RGaWVsZDtcbiAgbGV2ZWxfb2Zfc3R1ZHk6IHN0cmluZyB8IG51bGw7XG4gIHNjaG9vbDogc3RyaW5nIHwgbnVsbDtcbiAgc2Nob29sX290aGVyOiBzdHJpbmcgfCBudWxsO1xuICB0ZWFtX21vZGU6IHN0cmluZyB8IG51bGw7XG4gIHRlYW1fbmFtZTogc3RyaW5nIHwgbnVsbDtcbn07XG5cbnR5cGUgVGVhbW1hdGVDYW5kaWRhdGUgPSB7XG4gIGZpcnN0X25hbWU6IHN0cmluZyB8IG51bGw7XG4gIGxhc3RfbmFtZTogc3RyaW5nIHwgbnVsbDtcbiAgc2Nob29sOiBzdHJpbmcgfCBudWxsO1xuICBsZXZlbF9vZl9zdHVkeTogc3RyaW5nIHwgbnVsbDtcbiAgaW50ZXJlc3RzOiBSZWdpc3RyYXRpb25MaXN0RmllbGQ7XG4gIGZpZWxkc19vZl9zdHVkeTogUmVnaXN0cmF0aW9uTGlzdEZpZWxkO1xuICBkaXNjb3JkX3VzZXJfaWQ6IHN0cmluZyB8IG51bGw7XG4gIHRlYW1fbW9kZTogc3RyaW5nIHwgbnVsbDtcbn07XG5cbnR5cGUgVmVyaWZ5UmVzdWx0ID1cbiAgfCB7IG9rOiB0cnVlOyByZWdpc3RyYXRpb246IFJlZ2lzdHJhdGlvbiB9XG4gIHwgeyBvazogZmFsc2U7IG1lc3NhZ2U6IHN0cmluZyB9O1xuXG5mdW5jdGlvbiBpbnRlcmFjdGlvblJlc3BvbnNlKGNvbnRlbnQ6IHN0cmluZykge1xuICByZXR1cm4ge1xuICAgIHR5cGU6IDQsXG4gICAgZGF0YToge1xuICAgICAgY29udGVudCxcbiAgICAgIGZsYWdzOiA2NCxcbiAgICB9LFxuICB9O1xufVxuXG5hc3luYyBmdW5jdGlvbiByZWFkUmF3Qm9keShyZXE6IE5leHRBcGlSZXF1ZXN0KTogUHJvbWlzZTxCdWZmZXI+IHtcbiAgY29uc3QgY2h1bmtzOiBCdWZmZXJbXSA9IFtdO1xuICBmb3IgYXdhaXQgKGNvbnN0IGNodW5rIG9mIHJlcSkge1xuICAgIGNodW5rcy5wdXNoKHR5cGVvZiBjaHVuayA9PT0gXCJzdHJpbmdcIiA/IEJ1ZmZlci5mcm9tKGNodW5rKSA6IGNodW5rKTtcbiAgfVxuICByZXR1cm4gQnVmZmVyLmNvbmNhdChjaHVua3MpO1xufVxuXG5mdW5jdGlvbiB2ZXJpZnlEaXNjb3JkUmVxdWVzdChyYXdCb2R5OiBCdWZmZXIsIHNpZ25hdHVyZTogc3RyaW5nLCB0aW1lc3RhbXA6IHN0cmluZywgcHVibGljS2V5SGV4OiBzdHJpbmcpOiBib29sZWFuIHtcbiAgdHJ5IHtcbiAgICBjb25zdCBtZXNzYWdlID0gQnVmZmVyLmNvbmNhdChbQnVmZmVyLmZyb20odGltZXN0YW1wLCBcInV0ZjhcIiksIHJhd0JvZHldKTtcbiAgICBjb25zdCBzaWduYXR1cmVCeXRlcyA9IEJ1ZmZlci5mcm9tKHNpZ25hdHVyZSwgXCJoZXhcIik7XG4gICAgY29uc3QgcHVibGljS2V5Qnl0ZXMgPSBCdWZmZXIuZnJvbShwdWJsaWNLZXlIZXgsIFwiaGV4XCIpO1xuICAgIHJldHVybiBuYWNsLnNpZ24uZGV0YWNoZWQudmVyaWZ5KG1lc3NhZ2UsIHNpZ25hdHVyZUJ5dGVzLCBwdWJsaWNLZXlCeXRlcyk7XG4gIH0gY2F0Y2gge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxufVxuXG5mdW5jdGlvbiBnZXREaXNjb3JkVXNlcihpbnRlcmFjdGlvbjogSW50ZXJhY3Rpb24pOiBEaXNjb3JkVXNlciB8IG51bGwge1xuICByZXR1cm4gaW50ZXJhY3Rpb24ubWVtYmVyPy51c2VyID8/IGludGVyYWN0aW9uLnVzZXIgPz8gbnVsbDtcbn1cblxuZnVuY3Rpb24gZ2V0U3RyaW5nT3B0aW9uKGludGVyYWN0aW9uOiBJbnRlcmFjdGlvbiwgb3B0aW9uTmFtZTogc3RyaW5nKTogc3RyaW5nIHwgbnVsbCB7XG4gIGNvbnN0IHZhbHVlID0gaW50ZXJhY3Rpb24uZGF0YT8ub3B0aW9ucz8uZmluZCgob3B0aW9uKSA9PiBvcHRpb24ubmFtZSA9PT0gb3B0aW9uTmFtZSk/LnZhbHVlO1xuICBpZiAoIXZhbHVlIHx8IHR5cGVvZiB2YWx1ZSAhPT0gXCJzdHJpbmdcIikge1xuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgY29uc3QgdHJpbW1lZCA9IHZhbHVlLnRyaW0oKTtcbiAgcmV0dXJuIHRyaW1tZWQubGVuZ3RoID4gMCA/IHRyaW1tZWQgOiBudWxsO1xufVxuXG5mdW5jdGlvbiBnZXRFbWFpbE9wdGlvbihpbnRlcmFjdGlvbjogSW50ZXJhY3Rpb24pOiBzdHJpbmcgfCBudWxsIHtcbiAgY29uc3QgZW1haWwgPSBnZXRTdHJpbmdPcHRpb24oaW50ZXJhY3Rpb24sIFwiZW1haWxcIik7XG4gIHJldHVybiBlbWFpbCA/IGVtYWlsLnRvTG93ZXJDYXNlKCkgOiBudWxsO1xufVxuXG5mdW5jdGlvbiBnZXRJbnRlcmVzdE9wdGlvbihpbnRlcmFjdGlvbjogSW50ZXJhY3Rpb24pOiBzdHJpbmcgfCBudWxsIHtcbiAgcmV0dXJuIGdldFN0cmluZ09wdGlvbihpbnRlcmFjdGlvbiwgXCJpbnRlcmVzdFwiKTtcbn1cblxuZnVuY3Rpb24gZXNjYXBlUG9zdGdyZXNMaWtlKHZhbHVlOiBzdHJpbmcpOiBzdHJpbmcge1xuICByZXR1cm4gdmFsdWUucmVwbGFjZSgvWyVfXFxcXF0vZywgXCJcXFxcJCZcIik7XG59XG5cbmZ1bmN0aW9uIGludGVyYWN0aW9uRGVmZXJyZWRSZXNwb25zZSgpIHtcbiAgcmV0dXJuIHtcbiAgICB0eXBlOiA1LFxuICAgIGRhdGE6IHtcbiAgICAgIGZsYWdzOiA2NCxcbiAgICB9LFxuICB9O1xufVxuXG5mdW5jdGlvbiBub3JtYWxpemVMaXN0RmllbGQodmFsdWU6IFJlZ2lzdHJhdGlvbkxpc3RGaWVsZCk6IHN0cmluZ1tdIHtcbiAgaWYgKEFycmF5LmlzQXJyYXkodmFsdWUpKSB7XG4gICAgcmV0dXJuIHZhbHVlXG4gICAgICAubWFwKChpdGVtKSA9PiAodHlwZW9mIGl0ZW0gPT09IFwic3RyaW5nXCIgPyBpdGVtLnRyaW0oKSA6IFwiXCIpKVxuICAgICAgLmZpbHRlcigoaXRlbSkgPT4gaXRlbS5sZW5ndGggPiAwKTtcbiAgfVxuXG4gIGlmICh0eXBlb2YgdmFsdWUgIT09IFwic3RyaW5nXCIpIHtcbiAgICByZXR1cm4gW107XG4gIH1cblxuICBjb25zdCB0cmltbWVkID0gdmFsdWUudHJpbSgpO1xuICBpZiAoIXRyaW1tZWQpIHtcbiAgICByZXR1cm4gW107XG4gIH1cblxuICBpZiAodHJpbW1lZC5zdGFydHNXaXRoKFwiW1wiKSAmJiB0cmltbWVkLmVuZHNXaXRoKFwiXVwiKSkge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBwYXJzZWQgPSBKU09OLnBhcnNlKHRyaW1tZWQpO1xuICAgICAgaWYgKEFycmF5LmlzQXJyYXkocGFyc2VkKSkge1xuICAgICAgICByZXR1cm4gcGFyc2VkXG4gICAgICAgICAgLm1hcCgoaXRlbSkgPT4gKHR5cGVvZiBpdGVtID09PSBcInN0cmluZ1wiID8gaXRlbS50cmltKCkgOiBcIlwiKSlcbiAgICAgICAgICAuZmlsdGVyKChpdGVtKSA9PiBpdGVtLmxlbmd0aCA+IDApO1xuICAgICAgfVxuICAgIH0gY2F0Y2gge1xuICAgICAgLy8gRmFsbCBiYWNrIHRvIGNvbW1hLXNlcGFyYXRlZCBwYXJzaW5nIGJlbG93LlxuICAgIH1cbiAgfVxuXG4gIHJldHVybiB0cmltbWVkXG4gICAgLnNwbGl0KFwiLFwiKVxuICAgIC5tYXAoKGl0ZW0pID0+IGl0ZW0udHJpbSgpKVxuICAgIC5maWx0ZXIoKGl0ZW0pID0+IGl0ZW0ubGVuZ3RoID4gMCk7XG59XG5cbmZ1bmN0aW9uIG5vcm1hbGl6ZUtleSh2YWx1ZTogc3RyaW5nKTogc3RyaW5nIHtcbiAgcmV0dXJuIHZhbHVlLnRyaW0oKS50b0xvd2VyQ2FzZSgpO1xufVxuXG5mdW5jdGlvbiBpc0xvb2tpbmdGb3JUZWFtKHRlYW1Nb2RlOiBzdHJpbmcgfCBudWxsIHwgdW5kZWZpbmVkKTogYm9vbGVhbiB7XG4gIGlmICghdGVhbU1vZGUpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICBjb25zdCBub3JtYWxpemVkID0gbm9ybWFsaXplS2V5KHRlYW1Nb2RlKS5yZXBsYWNlKC9bXy1dKy9nLCBcIiBcIik7XG4gIHJldHVybiAoXG4gICAgbm9ybWFsaXplZCA9PT0gXCJmcmVlIGFnZW50XCIgfHxcbiAgICBub3JtYWxpemVkID09PSBcImxvb2tpbmcgZm9yIGEgdGVhbVwiIHx8XG4gICAgbm9ybWFsaXplZCA9PT0gXCJsb29raW5nIGZvciB0ZWFtXCJcbiAgKTtcbn1cblxuZnVuY3Rpb24gZ2V0UmVnaXN0cmF0aW9uRGlzcGxheU5hbWUocmVnaXN0cmF0aW9uOiB7IGZpcnN0X25hbWU6IHN0cmluZyB8IG51bGw7IGxhc3RfbmFtZTogc3RyaW5nIHwgbnVsbCB9KTogc3RyaW5nIHtcbiAgY29uc3QgZmlyc3QgPSByZWdpc3RyYXRpb24uZmlyc3RfbmFtZT8udHJpbSgpID8/IFwiXCI7XG4gIGNvbnN0IGxhc3QgPSByZWdpc3RyYXRpb24ubGFzdF9uYW1lPy50cmltKCkgPz8gXCJcIjtcbiAgY29uc3Qgam9pbmVkID0gYCR7Zmlyc3R9ICR7bGFzdH1gLnRyaW0oKTtcbiAgcmV0dXJuIGpvaW5lZCB8fCBcIlVua25vd25cIjtcbn1cblxuZnVuY3Rpb24gdHJ1bmNhdGVUZXh0KHZhbHVlOiBzdHJpbmcsIG1heExlbmd0aDogbnVtYmVyKTogc3RyaW5nIHtcbiAgaWYgKHZhbHVlLmxlbmd0aCA8PSBtYXhMZW5ndGgpIHtcbiAgICByZXR1cm4gdmFsdWU7XG4gIH1cbiAgcmV0dXJuIGAke3ZhbHVlLnNsaWNlKDAsIE1hdGgubWF4KDAsIG1heExlbmd0aCAtIDMpKX0uLi5gO1xufVxuXG5hc3luYyBmdW5jdGlvbiBlZGl0SW50ZXJhY3Rpb25SZXNwb25zZShpbnRlcmFjdGlvbjogSW50ZXJhY3Rpb24sIGNvbnRlbnQ6IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xuICBhd2FpdCBlZGl0T3JpZ2luYWxJbnRlcmFjdGlvblJlc3BvbnNlKHtcbiAgICBhcHBsaWNhdGlvbklkOiBpbnRlcmFjdGlvbi5hcHBsaWNhdGlvbl9pZCxcbiAgICBpbnRlcmFjdGlvblRva2VuOiBpbnRlcmFjdGlvbi50b2tlbixcbiAgICBjb250ZW50LFxuICB9KTtcbn1cblxuY29uc3QgUkVHSVNUUkFUSU9OX1NFTEVDVCA9XG4gIFwiZW1haWwsIGZpcnN0X25hbWUsIGxhc3RfbmFtZSwgZGlzY29yZF91c2VyX2lkLCBmaWVsZHNfb2Zfc3R1ZHksIGludGVyZXN0cywgbGV2ZWxfb2Zfc3R1ZHksIHNjaG9vbCwgc2Nob29sX290aGVyLCB0ZWFtX21vZGUsIHRlYW1fbmFtZVwiO1xuY29uc3QgVEVBTU1BVEVfU0VMRUNUID1cbiAgXCJmaXJzdF9uYW1lLCBsYXN0X25hbWUsIHNjaG9vbCwgbGV2ZWxfb2Zfc3R1ZHksIGludGVyZXN0cywgZmllbGRzX29mX3N0dWR5LCBkaXNjb3JkX3VzZXJfaWQsIHRlYW1fbW9kZVwiO1xuXG5hc3luYyBmdW5jdGlvbiBmaW5kQnlEaXNjb3JkVXNlcklkKGRpc2NvcmRVc2VySWQ6IHN0cmluZyk6IFByb21pc2U8UmVnaXN0cmF0aW9uIHwgbnVsbD4ge1xuICBjb25zdCBzdXBhYmFzZSA9IGdldFJ1bnRpbWVDb25maWcoKS5zdXBhYmFzZTtcbiAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAuZnJvbShcInJlZ2lzdHJhdGlvbnNcIilcbiAgICAuc2VsZWN0KFJFR0lTVFJBVElPTl9TRUxFQ1QpXG4gICAgLmVxKFwiZGlzY29yZF91c2VyX2lkXCIsIGRpc2NvcmRVc2VySWQpXG4gICAgLm1heWJlU2luZ2xlKCk7XG5cbiAgaWYgKGVycm9yKSB7XG4gICAgdGhyb3cgZXJyb3I7XG4gIH1cblxuICByZXR1cm4gKGRhdGEgYXMgUmVnaXN0cmF0aW9uIHwgbnVsbCkgPz8gbnVsbDtcbn1cblxuYXN5bmMgZnVuY3Rpb24gZmluZEJ5RW1haWxDYXNlSW5zZW5zaXRpdmUobm9ybWFsaXplZEVtYWlsOiBzdHJpbmcpOiBQcm9taXNlPFJlZ2lzdHJhdGlvbiB8IG51bGw+IHtcbiAgY29uc3Qgc3VwYWJhc2UgPSBnZXRSdW50aW1lQ29uZmlnKCkuc3VwYWJhc2U7XG4gIGNvbnN0IGVzY2FwZWRFbWFpbCA9IGVzY2FwZVBvc3RncmVzTGlrZShub3JtYWxpemVkRW1haWwpO1xuICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgIC5mcm9tKFwicmVnaXN0cmF0aW9uc1wiKVxuICAgIC5zZWxlY3QoUkVHSVNUUkFUSU9OX1NFTEVDVClcbiAgICAuaWxpa2UoXCJlbWFpbFwiLCBlc2NhcGVkRW1haWwpXG4gICAgLmxpbWl0KDIpO1xuXG4gIGlmIChlcnJvcikge1xuICAgIHRocm93IGVycm9yO1xuICB9XG5cbiAgaWYgKCFkYXRhIHx8IGRhdGEubGVuZ3RoID09PSAwKSB7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICBpZiAoZGF0YS5sZW5ndGggPiAxKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFwiTXVsdGlwbGUgcmVnaXN0cmF0aW9ucyBtYXRjaGVkIHRoaXMgZW1haWw7IGV4cGVjdGVkIGEgc2luZ2xlIHJvdy5cIik7XG4gIH1cblxuICByZXR1cm4gZGF0YVswXSBhcyBSZWdpc3RyYXRpb247XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGZpbmRUZWFtbWF0ZUNhbmRpZGF0ZXMoZGlzY29yZFVzZXJJZDogc3RyaW5nKTogUHJvbWlzZTxUZWFtbWF0ZUNhbmRpZGF0ZVtdPiB7XG4gIGNvbnN0IHN1cGFiYXNlID0gZ2V0UnVudGltZUNvbmZpZygpLnN1cGFiYXNlO1xuICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgIC5mcm9tKFwicmVnaXN0cmF0aW9uc1wiKVxuICAgIC5zZWxlY3QoVEVBTU1BVEVfU0VMRUNUKVxuICAgIC5ub3QoXCJkaXNjb3JkX3VzZXJfaWRcIiwgXCJpc1wiLCBcIm51bGxcIilcbiAgICAubmVxKFwiZGlzY29yZF91c2VyX2lkXCIsIGRpc2NvcmRVc2VySWQpXG4gICAgLmxpbWl0KE1hdGgubWF4KDEsIFRFQU1NQVRFX1FVRVJZX0xJTUlUKSk7XG5cbiAgaWYgKGVycm9yKSB7XG4gICAgdGhyb3cgZXJyb3I7XG4gIH1cblxuICBjb25zdCByb3dzID0gKGRhdGEgYXMgVGVhbW1hdGVDYW5kaWRhdGVbXSB8IG51bGwpID8/IFtdO1xuICByZXR1cm4gcm93cy5maWx0ZXIoKHJvdykgPT4gQm9vbGVhbihyb3cuZGlzY29yZF91c2VyX2lkKSAmJiBpc0xvb2tpbmdGb3JUZWFtKHJvdy50ZWFtX21vZGUpKTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gdmVyaWZ5UmVnaXN0cmF0aW9uKGRpc2NvcmRVc2VyOiBEaXNjb3JkVXNlciwgaW50ZXJhY3Rpb246IEludGVyYWN0aW9uKTogUHJvbWlzZTxWZXJpZnlSZXN1bHQ+IHtcbiAgY29uc3Qgc3VwYWJhc2UgPSBnZXRSdW50aW1lQ29uZmlnKCkuc3VwYWJhc2U7XG4gIGNvbnN0IHByb3ZpZGVkRW1haWwgPSBnZXRFbWFpbE9wdGlvbihpbnRlcmFjdGlvbik7XG5cbiAgaWYgKCFwcm92aWRlZEVtYWlsKSB7XG4gICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBmaW5kQnlEaXNjb3JkVXNlcklkKGRpc2NvcmRVc2VyLmlkKTtcbiAgICBpZiAoIWV4aXN0aW5nKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBvazogZmFsc2UsXG4gICAgICAgIG1lc3NhZ2U6XG4gICAgICAgICAgXCJJIGNvdWxkbid0IGF1dG9tYXRpY2FsbHkgdmVyaWZ5IHlvdXIgRGlzY29yZCBhY2NvdW50LiBQbGVhc2UgcnVuIC92ZXJpZnkgZW1haWw6PHlvdXIgcmVnaXN0cmF0aW9uIGVtYWlsPi5cIixcbiAgICAgIH07XG4gICAgfVxuXG4gICAgcmV0dXJuIHsgb2s6IHRydWUsIHJlZ2lzdHJhdGlvbjogZXhpc3RpbmcgfTtcbiAgfVxuXG4gIGNvbnN0IHJlZ2lzdHJhdGlvbiA9IGF3YWl0IGZpbmRCeUVtYWlsQ2FzZUluc2Vuc2l0aXZlKHByb3ZpZGVkRW1haWwpO1xuICBpZiAoIXJlZ2lzdHJhdGlvbikge1xuICAgIHJldHVybiB7XG4gICAgICBvazogZmFsc2UsXG4gICAgICBtZXNzYWdlOlxuICAgICAgICBcIuKdjCBDb3VsZCBub3QgdmVyaWZ5IHJlZ2lzdHJhdGlvbiBmb3IgdGhhdCBlbWFpbC4gSWYgeW91IGFscmVhZHkgcmVnaXN0ZXJlZCwgY29udGFjdCBzdGFmZi4gT3RoZXJ3aXNlIHJlZ2lzdGVyIGF0IG1jZ2lsbGFlcm9oYWNrcy5jb20uXCIsXG4gICAgfTtcbiAgfVxuXG4gIGlmIChyZWdpc3RyYXRpb24uZGlzY29yZF91c2VyX2lkICYmIHJlZ2lzdHJhdGlvbi5kaXNjb3JkX3VzZXJfaWQgIT09IGRpc2NvcmRVc2VyLmlkKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIG9rOiBmYWxzZSxcbiAgICAgIG1lc3NhZ2U6IFwi4p2MIFRoYXQgcmVnaXN0cmF0aW9uIGlzIGFscmVhZHkgbGlua2VkIHRvIGEgZGlmZmVyZW50IERpc2NvcmQgYWNjb3VudC4gQ29udGFjdCBzdGFmZiBmb3IgaGVscC5cIixcbiAgICB9O1xuICB9XG5cbiAgY29uc3QgeyBkYXRhOiB1cGRhdGVkUmVnaXN0cmF0aW9uLCBlcnJvcjogdXBkYXRlRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgLmZyb20oXCJyZWdpc3RyYXRpb25zXCIpXG4gICAgLnVwZGF0ZSh7XG4gICAgICBkaXNjb3JkX3VzZXJfaWQ6IGRpc2NvcmRVc2VyLmlkLFxuICAgICAgZGlzY29yZF91c2VybmFtZTogZGlzY29yZFVzZXIudXNlcm5hbWUgPz8gbnVsbCxcbiAgICAgIGRpc2NvcmRfdmVyaWZpZWRfYXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICB9KVxuICAgIC5lcShcImVtYWlsXCIsIHJlZ2lzdHJhdGlvbi5lbWFpbClcbiAgICAuc2VsZWN0KFJFR0lTVFJBVElPTl9TRUxFQ1QpXG4gICAgLnNpbmdsZSgpO1xuXG4gIGlmICh1cGRhdGVFcnJvcikge1xuICAgIGlmICgodXBkYXRlRXJyb3IgYXMgeyBjb2RlPzogc3RyaW5nIH0pLmNvZGUgPT09IFwiMjM1MDVcIikge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgb2s6IGZhbHNlLFxuICAgICAgICBtZXNzYWdlOiBcIuKdjCBUaGlzIERpc2NvcmQgYWNjb3VudCBpcyBhbHJlYWR5IGxpbmtlZCB0byBhIHJlZ2lzdHJhdGlvbi4gQ29udGFjdCBzdGFmZiBpZiB0aGlzIGlzIGEgbWlzdGFrZS5cIixcbiAgICAgIH07XG4gICAgfVxuXG4gICAgdGhyb3cgdXBkYXRlRXJyb3I7XG4gIH1cblxuICByZXR1cm4geyBvazogdHJ1ZSwgcmVnaXN0cmF0aW9uOiB1cGRhdGVkUmVnaXN0cmF0aW9uIGFzIFJlZ2lzdHJhdGlvbiB9O1xufVxuXG5mdW5jdGlvbiBsb2dWZXJpZnlUaW1pbmcoc3RlcDogc3RyaW5nLCBkdXJhdGlvbk1zOiBudW1iZXIsIGRldGFpbHM/OiBzdHJpbmcpOiB2b2lkIHtcbiAgaWYgKCFFTkFCTEVfVkVSSUZZX1RJTUlOR19MT0dTKSB7XG4gICAgcmV0dXJuO1xuICB9XG4gIGNvbnN0IHN1ZmZpeCA9IGRldGFpbHMgPyBgICR7ZGV0YWlsc31gIDogXCJcIjtcbiAgY29uc29sZS5pbmZvKGBbdmVyaWZ5LXRpbWluZ10gJHtzdGVwfTogJHtkdXJhdGlvbk1zLnRvRml4ZWQoMSl9bXMke3N1ZmZpeH1gKTtcbn1cblxuZnVuY3Rpb24gYnVpbGRWZXJpZmljYXRpb25TdWNjZXNzTWVzc2FnZShcbiAgcmVnaXN0cmF0aW9uOiBSZWdpc3RyYXRpb24sXG4gIHJvbGVSZXN1bHQ6IEF3YWl0ZWQ8UmV0dXJuVHlwZTx0eXBlb2YgYXNzaWduUm9sZXNGcm9tUmVnaXN0cmF0aW9uPj4gfCBudWxsLFxuICBndWlsZElkOiBzdHJpbmcgfCB1bmRlZmluZWRcbik6IHN0cmluZyB7XG4gIGNvbnN0IGxpbmVzID0gW2DinIUgVmVyaWZpZWQ6ICR7cmVnaXN0cmF0aW9uLmZpcnN0X25hbWV9ICR7cmVnaXN0cmF0aW9uLmxhc3RfbmFtZX1gXTtcblxuICBpZiAoIWd1aWxkSWQpIHtcbiAgICBsaW5lcy5wdXNoKFwiWW91J3JlIHZlcmlmaWVkLCBidXQgcm9sZSBhc3NpZ25tZW50IG9ubHkgd29ya3MgaW4gYSBzZXJ2ZXIgY2hhbm5lbC5cIik7XG4gICAgcmV0dXJuIGxpbmVzLmpvaW4oXCJcXG5cIik7XG4gIH1cblxuICBsaW5lcy5wdXNoKFwiV2UndmUgYXNzaWduZWQgcm9sZXMgYmFzZWQgb24geW91ciBwcm9ncmFtLCBpbnRlcmVzdHMsIHNjaG9vbCwgYW5kIHRlYW0gc3RhdHVzLlwiKTtcblxuICBpZiAoIXJvbGVSZXN1bHQpIHtcbiAgICByZXR1cm4gbGluZXMuam9pbihcIlxcblwiKTtcbiAgfVxuXG4gIGlmIChyb2xlUmVzdWx0LmFzc2lnbmVkUm9sZU5hbWVzLmxlbmd0aCA+IDApIHtcbiAgICBsaW5lcy5wdXNoKGBBc3NpZ25lZDogJHtyb2xlUmVzdWx0LmFzc2lnbmVkUm9sZU5hbWVzLmpvaW4oXCIsIFwiKX1gKTtcbiAgfSBlbHNlIHtcbiAgICBsaW5lcy5wdXNoKFwiTm8gbmV3IHJvbGVzIHdlcmUgbmVlZGVkLlwiKTtcbiAgfVxuXG4gIGlmIChyb2xlUmVzdWx0LmZhaWxlZFJvbGVOYW1lcy5sZW5ndGggPiAwKSB7XG4gICAgbGluZXMucHVzaChcIlNvbWUgcm9sZXMgY291bGQgbm90IGJlIGFzc2lnbmVkIHJpZ2h0IG5vdy4gUGxlYXNlIGNvbnRhY3Qgc3RhZmYgaWYgdGhpcyBwZXJzaXN0cy5cIik7XG4gIH1cblxuICByZXR1cm4gbGluZXMuam9pbihcIlxcblwiKTtcbn1cblxuZnVuY3Rpb24gdG9Sb2xlQXNzaWdubWVudFJlZ2lzdHJhdGlvbihyZWdpc3RyYXRpb246IFJlZ2lzdHJhdGlvbikge1xuICByZXR1cm4ge1xuICAgIGZpZWxkc19vZl9zdHVkeTogbm9ybWFsaXplTGlzdEZpZWxkKHJlZ2lzdHJhdGlvbi5maWVsZHNfb2Zfc3R1ZHkpLFxuICAgIGludGVyZXN0czogbm9ybWFsaXplTGlzdEZpZWxkKHJlZ2lzdHJhdGlvbi5pbnRlcmVzdHMpLFxuICAgIGxldmVsX29mX3N0dWR5OiByZWdpc3RyYXRpb24ubGV2ZWxfb2Zfc3R1ZHksXG4gICAgc2Nob29sOiByZWdpc3RyYXRpb24uc2Nob29sLFxuICAgIHNjaG9vbF9vdGhlcjogcmVnaXN0cmF0aW9uLnNjaG9vbF9vdGhlcixcbiAgICB0ZWFtX21vZGU6IHJlZ2lzdHJhdGlvbi50ZWFtX21vZGUsXG4gICAgdGVhbV9uYW1lOiByZWdpc3RyYXRpb24udGVhbV9uYW1lLFxuICB9O1xufVxuXG5mdW5jdGlvbiBidWlsZFN0YXR1c01lc3NhZ2UocmVnaXN0cmF0aW9uOiBSZWdpc3RyYXRpb24pOiBzdHJpbmcge1xuICBjb25zdCBsaW5lcyA9IFtcbiAgICBcIuKchSBZb3VyIHZlcmlmaWNhdGlvbiBzdGF0dXNcIixcbiAgICBgTmFtZTogJHtnZXRSZWdpc3RyYXRpb25EaXNwbGF5TmFtZShyZWdpc3RyYXRpb24pfWAsXG4gICAgYEVtYWlsOiAke3JlZ2lzdHJhdGlvbi5lbWFpbCA/PyBcIk4vQVwifWAsXG4gICAgYFNjaG9vbDogJHtyZWdpc3RyYXRpb24uc2Nob29sID8/IHJlZ2lzdHJhdGlvbi5zY2hvb2xfb3RoZXIgPz8gXCJOL0FcIn1gLFxuICAgIGBMZXZlbDogJHtyZWdpc3RyYXRpb24ubGV2ZWxfb2Zfc3R1ZHkgPz8gXCJOL0FcIn1gLFxuICAgIGBUZWFtIG1vZGU6ICR7cmVnaXN0cmF0aW9uLnRlYW1fbW9kZSA/PyBcIk4vQVwifWAsXG4gIF07XG5cbiAgaWYgKHJlZ2lzdHJhdGlvbi50ZWFtX25hbWUpIHtcbiAgICBsaW5lcy5wdXNoKGBUZWFtIG5hbWU6ICR7cmVnaXN0cmF0aW9uLnRlYW1fbmFtZX1gKTtcbiAgfVxuXG4gIHJldHVybiBsaW5lcy5qb2luKFwiXFxuXCIpO1xufVxuXG50eXBlIFRlYW1tYXRlTWF0Y2ggPSB7XG4gIHNjb3JlOiBudW1iZXI7XG4gIGNhbmRpZGF0ZTogVGVhbW1hdGVDYW5kaWRhdGU7XG4gIG1hdGNoZWRJbnRlcmVzdHM6IHN0cmluZ1tdO1xuICBtYXRjaGVkRmllbGRzOiBzdHJpbmdbXTtcbn07XG5cbmZ1bmN0aW9uIGJ1aWxkVGVhbW1hdGVzTWVzc2FnZShtYXRjaGVzOiBUZWFtbWF0ZU1hdGNoW10sIGludGVyZXN0RmlsdGVyOiBzdHJpbmcgfCBudWxsKTogc3RyaW5nIHtcbiAgY29uc3QgbGluZXM6IHN0cmluZ1tdID0gW1wi8J+UjSBQb3RlbnRpYWwgdGVhbW1hdGVzXCIsIFwiXCJdO1xuXG4gIGlmIChpbnRlcmVzdEZpbHRlcikge1xuICAgIGxpbmVzLnB1c2goYEZpbHRlcjogJHtpbnRlcmVzdEZpbHRlcn1gLCBcIlwiKTtcbiAgfVxuXG4gIGxldCBzaG93biA9IDA7XG4gIGNvbnN0IGNhcHBlZE1hdGNoZXMgPSBtYXRjaGVzLnNsaWNlKDAsIE1hdGgubWF4KDEsIE1BWF9URUFNTUFURV9SRVNVTFRTKSk7XG5cbiAgZm9yIChsZXQgaW5kZXggPSAwOyBpbmRleCA8IGNhcHBlZE1hdGNoZXMubGVuZ3RoOyBpbmRleCArPSAxKSB7XG4gICAgY29uc3QgbWF0Y2ggPSBjYXBwZWRNYXRjaGVzW2luZGV4XTtcbiAgICBpZiAoIW1hdGNoKSB7XG4gICAgICBjb250aW51ZTtcbiAgICB9XG5cbiAgICBjb25zdCBjYW5kaWRhdGUgPSBtYXRjaC5jYW5kaWRhdGU7XG4gICAgY29uc3QgbWVudGlvbiA9IGNhbmRpZGF0ZS5kaXNjb3JkX3VzZXJfaWQgPyBgIDxAJHtjYW5kaWRhdGUuZGlzY29yZF91c2VyX2lkfT5gIDogXCJcIjtcbiAgICBjb25zdCBuYW1lID0gZ2V0UmVnaXN0cmF0aW9uRGlzcGxheU5hbWUoY2FuZGlkYXRlKTtcbiAgICBjb25zdCBzY2hvb2wgPSBjYW5kaWRhdGUuc2Nob29sID8/IFwiTi9BXCI7XG4gICAgY29uc3QgbGV2ZWwgPSBjYW5kaWRhdGUubGV2ZWxfb2Zfc3R1ZHkgPz8gXCJOL0FcIjtcblxuICAgIGNvbnN0IG1hdGNoUGFydHM6IHN0cmluZ1tdID0gW107XG4gICAgaWYgKG1hdGNoLm1hdGNoZWRJbnRlcmVzdHMubGVuZ3RoID4gMCkge1xuICAgICAgbWF0Y2hQYXJ0cy5wdXNoKFxuICAgICAgICBgSW50ZXJlc3RzOiAke21hdGNoLm1hdGNoZWRJbnRlcmVzdHNcbiAgICAgICAgICAuc2xpY2UoMCwgMilcbiAgICAgICAgICAubWFwKCh2YWx1ZSkgPT4gdHJ1bmNhdGVUZXh0KHZhbHVlLCAzMCkpXG4gICAgICAgICAgLmpvaW4oXCIsIFwiKX1gXG4gICAgICApO1xuICAgIH1cbiAgICBpZiAobWF0Y2gubWF0Y2hlZEZpZWxkcy5sZW5ndGggPiAwKSB7XG4gICAgICBtYXRjaFBhcnRzLnB1c2goXG4gICAgICAgIGBGaWVsZHM6ICR7bWF0Y2gubWF0Y2hlZEZpZWxkc1xuICAgICAgICAgIC5zbGljZSgwLCAyKVxuICAgICAgICAgIC5tYXAoKHZhbHVlKSA9PiB0cnVuY2F0ZVRleHQodmFsdWUsIDMwKSlcbiAgICAgICAgICAuam9pbihcIiwgXCIpfWBcbiAgICAgICk7XG4gICAgfVxuXG4gICAgY29uc3QgYmxvY2sgPSBbXG4gICAgICBgJHtzaG93biArIDF9LiAke25hbWV9JHttZW50aW9ufSAoc2NvcmUgJHttYXRjaC5zY29yZX0pYCxcbiAgICAgIGAgICBTY2hvb2w6ICR7dHJ1bmNhdGVUZXh0KHNjaG9vbCwgNjApfWAsXG4gICAgICBgICAgTGV2ZWw6ICR7dHJ1bmNhdGVUZXh0KGxldmVsLCA2MCl9YCxcbiAgICAgIG1hdGNoUGFydHMubGVuZ3RoID4gMCA/IGAgICBNYXRjaDogJHttYXRjaFBhcnRzLmpvaW4oXCIgfCBcIil9YCA6IG51bGwsXG4gICAgICBudWxsLFxuICAgIF1cbiAgICAgIC5maWx0ZXIoKGxpbmUpOiBsaW5lIGlzIHN0cmluZyA9PiBCb29sZWFuKGxpbmUpKVxuICAgICAgLmpvaW4oXCJcXG5cIik7XG5cbiAgICBjb25zdCB0ZW50YXRpdmUgPSBbLi4ubGluZXMsIGJsb2NrXS5qb2luKFwiXFxuXCIpO1xuICAgIGlmICh0ZW50YXRpdmUubGVuZ3RoID4gMTg1MCkge1xuICAgICAgYnJlYWs7XG4gICAgfVxuXG4gICAgbGluZXMucHVzaChibG9jayk7XG4gICAgc2hvd24gKz0gMTtcbiAgfVxuXG4gIGlmIChzaG93biA8IG1hdGNoZXMubGVuZ3RoKSB7XG4gICAgbGluZXMucHVzaChgU2hvd2luZyAke3Nob3dufSBvZiAke21hdGNoZXMubGVuZ3RofSBtYXRjaGVzLiBSZWZpbmUgd2l0aCBpbnRlcmVzdDo8a2V5d29yZD4gZm9yIGEgbmFycm93ZXIgbGlzdC5gKTtcbiAgfVxuXG4gIGxpbmVzLnB1c2goXCJcIiwgXCLwn5KhIFJlYWNoIG91dCBpbiBEaXNjb3JkIERNcyBvciBzZXJ2ZXIgY2hhbm5lbHMgdG8gZm9ybSBhIHRlYW0uXCIpO1xuXG4gIHJldHVybiBsaW5lcy5qb2luKFwiXFxuXCIpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBwcm9jZXNzVmVyaWZ5SW50ZXJhY3Rpb24oaW50ZXJhY3Rpb246IEludGVyYWN0aW9uKTogUHJvbWlzZTx2b2lkPiB7XG4gIGNvbnN0IHRvdGFsU3RhcnQgPSBwZXJmb3JtYW5jZS5ub3coKTtcbiAgY29uc3QgZGlzY29yZFVzZXIgPSBnZXREaXNjb3JkVXNlcihpbnRlcmFjdGlvbik7XG4gIGlmICghZGlzY29yZFVzZXI/LmlkKSB7XG4gICAgYXdhaXQgZWRpdEludGVyYWN0aW9uUmVzcG9uc2UoaW50ZXJhY3Rpb24sIFwiQ291bGQgbm90IHJlYWQgeW91ciBEaXNjb3JkIGFjY291bnQgaW5mb3JtYXRpb24uXCIpO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIHRyeSB7XG4gICAgY29uc3QgdmVyaWZ5U3RhcnQgPSBwZXJmb3JtYW5jZS5ub3coKTtcbiAgICBjb25zdCB2ZXJpZnlSZXN1bHQgPSBhd2FpdCB2ZXJpZnlSZWdpc3RyYXRpb24oZGlzY29yZFVzZXIsIGludGVyYWN0aW9uKTtcbiAgICBsb2dWZXJpZnlUaW1pbmcoXCJ2ZXJpZnlSZWdpc3RyYXRpb25cIiwgcGVyZm9ybWFuY2Uubm93KCkgLSB2ZXJpZnlTdGFydCwgYGludGVyYWN0aW9uX2lkPSR7aW50ZXJhY3Rpb24uaWR9YCk7XG5cbiAgICBpZiAoIXZlcmlmeVJlc3VsdC5vaykge1xuICAgICAgY29uc3QgZWRpdFN0YXJ0ID0gcGVyZm9ybWFuY2Uubm93KCk7XG4gICAgICBhd2FpdCBlZGl0SW50ZXJhY3Rpb25SZXNwb25zZShpbnRlcmFjdGlvbiwgdmVyaWZ5UmVzdWx0Lm1lc3NhZ2UpO1xuICAgICAgbG9nVmVyaWZ5VGltaW5nKFwiZWRpdE9yaWdpbmFsSW50ZXJhY3Rpb25SZXNwb25zZVwiLCBwZXJmb3JtYW5jZS5ub3coKSAtIGVkaXRTdGFydCwgXCJyZXN1bHQ9ZmFpbHVyZV9tZXNzYWdlXCIpO1xuICAgICAgbG9nVmVyaWZ5VGltaW5nKFwicHJvY2Vzc1ZlcmlmeUludGVyYWN0aW9uLnRvdGFsXCIsIHBlcmZvcm1hbmNlLm5vdygpIC0gdG90YWxTdGFydCwgXCJyZXN1bHQ9ZmFpbGVkX3ZlcmlmaWNhdGlvblwiKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBsZXQgcm9sZVJlc3VsdDogQXdhaXRlZDxSZXR1cm5UeXBlPHR5cGVvZiBhc3NpZ25Sb2xlc0Zyb21SZWdpc3RyYXRpb24+PiB8IG51bGwgPSBudWxsO1xuICAgIGlmIChpbnRlcmFjdGlvbi5ndWlsZF9pZCkge1xuICAgICAgY29uc3Qgcm9sZVN0YXJ0ID0gcGVyZm9ybWFuY2Uubm93KCk7XG4gICAgICByb2xlUmVzdWx0ID0gYXdhaXQgYXNzaWduUm9sZXNGcm9tUmVnaXN0cmF0aW9uKHtcbiAgICAgICAgZ3VpbGRJZDogaW50ZXJhY3Rpb24uZ3VpbGRfaWQsXG4gICAgICAgIGRpc2NvcmRVc2VySWQ6IGRpc2NvcmRVc2VyLmlkLFxuICAgICAgICByZWdpc3RyYXRpb246IHRvUm9sZUFzc2lnbm1lbnRSZWdpc3RyYXRpb24odmVyaWZ5UmVzdWx0LnJlZ2lzdHJhdGlvbiksXG4gICAgICB9KTtcbiAgICAgIGxvZ1ZlcmlmeVRpbWluZyhcImFzc2lnblJvbGVzRnJvbVJlZ2lzdHJhdGlvblwiLCBwZXJmb3JtYW5jZS5ub3coKSAtIHJvbGVTdGFydCwgYGd1aWxkX2lkPSR7aW50ZXJhY3Rpb24uZ3VpbGRfaWR9YCk7XG4gICAgfVxuXG4gICAgY29uc3QgZWRpdFN0YXJ0ID0gcGVyZm9ybWFuY2Uubm93KCk7XG4gICAgYXdhaXQgZWRpdEludGVyYWN0aW9uUmVzcG9uc2UoXG4gICAgICBpbnRlcmFjdGlvbixcbiAgICAgIGJ1aWxkVmVyaWZpY2F0aW9uU3VjY2Vzc01lc3NhZ2UodmVyaWZ5UmVzdWx0LnJlZ2lzdHJhdGlvbiwgcm9sZVJlc3VsdCwgaW50ZXJhY3Rpb24uZ3VpbGRfaWQpXG4gICAgKTtcbiAgICBsb2dWZXJpZnlUaW1pbmcoXCJlZGl0T3JpZ2luYWxJbnRlcmFjdGlvblJlc3BvbnNlXCIsIHBlcmZvcm1hbmNlLm5vdygpIC0gZWRpdFN0YXJ0LCBcInJlc3VsdD1zdWNjZXNzX21lc3NhZ2VcIik7XG4gICAgbG9nVmVyaWZ5VGltaW5nKFwicHJvY2Vzc1ZlcmlmeUludGVyYWN0aW9uLnRvdGFsXCIsIHBlcmZvcm1hbmNlLm5vdygpIC0gdG90YWxTdGFydCwgXCJyZXN1bHQ9c3VjY2Vzc1wiKTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKFwidmVyaWZ5IGNvbW1hbmQgZXJyb3JcIiwgZXJyb3IpO1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBlZGl0U3RhcnQgPSBwZXJmb3JtYW5jZS5ub3coKTtcbiAgICAgIGF3YWl0IGVkaXRJbnRlcmFjdGlvblJlc3BvbnNlKGludGVyYWN0aW9uLCBcIkFuIGludGVybmFsIGVycm9yIG9jY3VycmVkLiBQbGVhc2UgdHJ5IGFnYWluIGxhdGVyLlwiKTtcbiAgICAgIGxvZ1ZlcmlmeVRpbWluZyhcImVkaXRPcmlnaW5hbEludGVyYWN0aW9uUmVzcG9uc2VcIiwgcGVyZm9ybWFuY2Uubm93KCkgLSBlZGl0U3RhcnQsIFwicmVzdWx0PWludGVybmFsX2Vycm9yXCIpO1xuICAgIH0gY2F0Y2ggKGZvbGxvd3VwRXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gc2VuZCBlcnJvciBmb2xsb3ctdXA6XCIsIGZvbGxvd3VwRXJyb3IpO1xuICAgIH1cbiAgICBsb2dWZXJpZnlUaW1pbmcoXCJwcm9jZXNzVmVyaWZ5SW50ZXJhY3Rpb24udG90YWxcIiwgcGVyZm9ybWFuY2Uubm93KCkgLSB0b3RhbFN0YXJ0LCBcInJlc3VsdD1leGNlcHRpb25cIik7XG4gIH1cbn1cblxuYXN5bmMgZnVuY3Rpb24gcHJvY2Vzc1N0YXR1c0ludGVyYWN0aW9uKGludGVyYWN0aW9uOiBJbnRlcmFjdGlvbik6IFByb21pc2U8dm9pZD4ge1xuICBjb25zdCBkaXNjb3JkVXNlciA9IGdldERpc2NvcmRVc2VyKGludGVyYWN0aW9uKTtcbiAgaWYgKCFkaXNjb3JkVXNlcj8uaWQpIHtcbiAgICBhd2FpdCBlZGl0SW50ZXJhY3Rpb25SZXNwb25zZShpbnRlcmFjdGlvbiwgXCJDb3VsZCBub3QgcmVhZCB5b3VyIERpc2NvcmQgYWNjb3VudCBpbmZvcm1hdGlvbi5cIik7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgdHJ5IHtcbiAgICBjb25zdCByZWdpc3RyYXRpb24gPSBhd2FpdCBmaW5kQnlEaXNjb3JkVXNlcklkKGRpc2NvcmRVc2VyLmlkKTtcbiAgICBpZiAoIXJlZ2lzdHJhdGlvbikge1xuICAgICAgYXdhaXQgZWRpdEludGVyYWN0aW9uUmVzcG9uc2UoaW50ZXJhY3Rpb24sIFwi4p2MIFlvdSBhcmUgbm90IHZlcmlmaWVkIHlldC4gVXNlIC92ZXJpZnkgZW1haWw6PHlvdXIgcmVnaXN0cmF0aW9uIGVtYWlsPi5cIik7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgYXdhaXQgZWRpdEludGVyYWN0aW9uUmVzcG9uc2UoaW50ZXJhY3Rpb24sIGJ1aWxkU3RhdHVzTWVzc2FnZShyZWdpc3RyYXRpb24pKTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKFwic3RhdHVzIGNvbW1hbmQgZXJyb3JcIiwgZXJyb3IpO1xuICAgIGF3YWl0IGVkaXRJbnRlcmFjdGlvblJlc3BvbnNlKGludGVyYWN0aW9uLCBcIkFuIGludGVybmFsIGVycm9yIG9jY3VycmVkIHdoaWxlIGNoZWNraW5nIHlvdXIgc3RhdHVzLlwiKTtcbiAgfVxufVxuXG5hc3luYyBmdW5jdGlvbiBwcm9jZXNzRmluZFRlYW1tYXRlc0ludGVyYWN0aW9uKGludGVyYWN0aW9uOiBJbnRlcmFjdGlvbik6IFByb21pc2U8dm9pZD4ge1xuICBjb25zdCBkaXNjb3JkVXNlciA9IGdldERpc2NvcmRVc2VyKGludGVyYWN0aW9uKTtcbiAgaWYgKCFkaXNjb3JkVXNlcj8uaWQpIHtcbiAgICBhd2FpdCBlZGl0SW50ZXJhY3Rpb25SZXNwb25zZShpbnRlcmFjdGlvbiwgXCJDb3VsZCBub3QgcmVhZCB5b3VyIERpc2NvcmQgYWNjb3VudCBpbmZvcm1hdGlvbi5cIik7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgdHJ5IHtcbiAgICBjb25zdCB1c2VyUmVnaXN0cmF0aW9uID0gYXdhaXQgZmluZEJ5RGlzY29yZFVzZXJJZChkaXNjb3JkVXNlci5pZCk7XG4gICAgaWYgKCF1c2VyUmVnaXN0cmF0aW9uKSB7XG4gICAgICBhd2FpdCBlZGl0SW50ZXJhY3Rpb25SZXNwb25zZShpbnRlcmFjdGlvbiwgXCLinYwgWW91IG5lZWQgdG8gdmVyaWZ5IGZpcnN0IHVzaW5nIC92ZXJpZnkgZW1haWw6PHlvdXIgcmVnaXN0cmF0aW9uIGVtYWlsPi5cIik7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgY29uc3QgaW50ZXJlc3RGaWx0ZXIgPSBnZXRJbnRlcmVzdE9wdGlvbihpbnRlcmFjdGlvbik7XG4gICAgY29uc3Qgbm9ybWFsaXplZEZpbHRlciA9IGludGVyZXN0RmlsdGVyID8gbm9ybWFsaXplS2V5KGludGVyZXN0RmlsdGVyKSA6IG51bGw7XG5cbiAgICBjb25zdCB1c2VySW50ZXJlc3RLZXlzID0gbmV3IFNldChub3JtYWxpemVMaXN0RmllbGQodXNlclJlZ2lzdHJhdGlvbi5pbnRlcmVzdHMpLm1hcChub3JtYWxpemVLZXkpKTtcbiAgICBjb25zdCB1c2VyRmllbGRLZXlzID0gbmV3IFNldChub3JtYWxpemVMaXN0RmllbGQodXNlclJlZ2lzdHJhdGlvbi5maWVsZHNfb2Zfc3R1ZHkpLm1hcChub3JtYWxpemVLZXkpKTtcblxuICAgIGNvbnN0IGNhbmRpZGF0ZXMgPSBhd2FpdCBmaW5kVGVhbW1hdGVDYW5kaWRhdGVzKGRpc2NvcmRVc2VyLmlkKTtcbiAgICBjb25zdCBtYXRjaGVzOiBUZWFtbWF0ZU1hdGNoW10gPSBbXTtcblxuICAgIGZvciAoY29uc3QgY2FuZGlkYXRlIG9mIGNhbmRpZGF0ZXMpIHtcbiAgICAgIGNvbnN0IGNhbmRpZGF0ZUludGVyZXN0cyA9IG5vcm1hbGl6ZUxpc3RGaWVsZChjYW5kaWRhdGUuaW50ZXJlc3RzKTtcbiAgICAgIGNvbnN0IGNhbmRpZGF0ZUZpZWxkcyA9IG5vcm1hbGl6ZUxpc3RGaWVsZChjYW5kaWRhdGUuZmllbGRzX29mX3N0dWR5KTtcblxuICAgICAgaWYgKG5vcm1hbGl6ZWRGaWx0ZXIpIHtcbiAgICAgICAgY29uc3QgY2FuZGlkYXRlVGV4dCA9IGAke2NhbmRpZGF0ZUludGVyZXN0cy5qb2luKFwiIFwiKX0gJHtjYW5kaWRhdGVGaWVsZHMuam9pbihcIiBcIil9YC50b0xvd2VyQ2FzZSgpO1xuICAgICAgICBpZiAoIWNhbmRpZGF0ZVRleHQuaW5jbHVkZXMobm9ybWFsaXplZEZpbHRlcikpIHtcbiAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBjb25zdCBtYXRjaGVkSW50ZXJlc3RzID0gY2FuZGlkYXRlSW50ZXJlc3RzLmZpbHRlcigodmFsdWUpID0+IHVzZXJJbnRlcmVzdEtleXMuaGFzKG5vcm1hbGl6ZUtleSh2YWx1ZSkpKTtcbiAgICAgIGNvbnN0IG1hdGNoZWRGaWVsZHMgPSBjYW5kaWRhdGVGaWVsZHMuZmlsdGVyKCh2YWx1ZSkgPT4gdXNlckZpZWxkS2V5cy5oYXMobm9ybWFsaXplS2V5KHZhbHVlKSkpO1xuXG4gICAgICBjb25zdCBzY29yZSA9IG1hdGNoZWRJbnRlcmVzdHMubGVuZ3RoICogMiArIG1hdGNoZWRGaWVsZHMubGVuZ3RoICogMztcbiAgICAgIG1hdGNoZXMucHVzaCh7XG4gICAgICAgIHNjb3JlLFxuICAgICAgICBjYW5kaWRhdGUsXG4gICAgICAgIG1hdGNoZWRJbnRlcmVzdHMsXG4gICAgICAgIG1hdGNoZWRGaWVsZHMsXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICBtYXRjaGVzLnNvcnQoKGEsIGIpID0+IHtcbiAgICAgIGlmIChiLnNjb3JlICE9PSBhLnNjb3JlKSB7XG4gICAgICAgIHJldHVybiBiLnNjb3JlIC0gYS5zY29yZTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IGFOYW1lID0gZ2V0UmVnaXN0cmF0aW9uRGlzcGxheU5hbWUoYS5jYW5kaWRhdGUpLnRvTG93ZXJDYXNlKCk7XG4gICAgICBjb25zdCBiTmFtZSA9IGdldFJlZ2lzdHJhdGlvbkRpc3BsYXlOYW1lKGIuY2FuZGlkYXRlKS50b0xvd2VyQ2FzZSgpO1xuICAgICAgcmV0dXJuIGFOYW1lLmxvY2FsZUNvbXBhcmUoYk5hbWUpO1xuICAgIH0pO1xuXG4gICAgaWYgKG1hdGNoZXMubGVuZ3RoID09PSAwKSB7XG4gICAgICBpZiAoaW50ZXJlc3RGaWx0ZXIpIHtcbiAgICAgICAgYXdhaXQgZWRpdEludGVyYWN0aW9uUmVzcG9uc2UoaW50ZXJhY3Rpb24sIGDwn5iUIE5vIHRlYW1tYXRlcyBmb3VuZCBtYXRjaGluZyBcIiR7aW50ZXJlc3RGaWx0ZXJ9XCIuIFRyeSBhIGJyb2FkZXIgZmlsdGVyLmApO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgYXdhaXQgZWRpdEludGVyYWN0aW9uUmVzcG9uc2UoaW50ZXJhY3Rpb24sIFwi8J+YlCBObyBvbmUgZWxzZSBpcyBjdXJyZW50bHkgbWFya2VkIGFzIGxvb2tpbmcgZm9yIGEgdGVhbS5cIik7XG4gICAgICB9XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgYXdhaXQgZWRpdEludGVyYWN0aW9uUmVzcG9uc2UoaW50ZXJhY3Rpb24sIGJ1aWxkVGVhbW1hdGVzTWVzc2FnZShtYXRjaGVzLCBpbnRlcmVzdEZpbHRlcikpO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoXCJmaW5kX3RlYW1tYXRlcyBjb21tYW5kIGVycm9yXCIsIGVycm9yKTtcbiAgICBhd2FpdCBlZGl0SW50ZXJhY3Rpb25SZXNwb25zZShpbnRlcmFjdGlvbiwgXCJBbiBpbnRlcm5hbCBlcnJvciBvY2N1cnJlZCB3aGlsZSBmaW5kaW5nIHRlYW1tYXRlcy5cIik7XG4gIH1cbn1cblxuYXN5bmMgZnVuY3Rpb24gcHJvY2Vzc0hlbHBJbnRlcmFjdGlvbihpbnRlcmFjdGlvbjogSW50ZXJhY3Rpb24pOiBQcm9taXNlPHZvaWQ+IHtcbiAgY29uc3QgbWVzc2FnZSA9IFtcbiAgICBcIvCfpJYgQWVyb0hhY2tzIEJvdCBDb21tYW5kc1wiLFxuICAgIFwiXCIsXG4gICAgXCIvdmVyaWZ5IGVtYWlsOjx5b3VyIHJlZ2lzdHJhdGlvbiBlbWFpbD4gLSBWZXJpZnkgYW5kIGxpbmsgeW91ciBEaXNjb3JkIGFjY291bnQuXCIsXG4gICAgXCIvc3RhdHVzIC0gU2hvdyB5b3VyIGN1cnJlbnQgdmVyaWZpY2F0aW9uIGRldGFpbHMuXCIsXG4gICAgXCIvZmluZF90ZWFtbWF0ZXMgW2ludGVyZXN0XSAtIEZpbmQgcGFydGljaXBhbnRzIG1hcmtlZCBhcyBsb29raW5nIGZvciBhIHRlYW0uXCIsXG4gICAgXCIvaGVscCAtIFNob3cgdGhpcyBtZXNzYWdlLlwiLFxuICAgIFwiXCIsXG4gICAgXCJJZiB2ZXJpZmljYXRpb24gZmFpbHMsIGNvbnRhY3Qgc3RhZmYgd2l0aCB5b3VyIHJlZ2lzdHJhdGlvbiBlbWFpbC5cIixcbiAgXS5qb2luKFwiXFxuXCIpO1xuXG4gIGF3YWl0IGVkaXRJbnRlcmFjdGlvblJlc3BvbnNlKGludGVyYWN0aW9uLCBtZXNzYWdlKTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gcHJvY2Vzc0NvbW1hbmRJbnRlcmFjdGlvbihpbnRlcmFjdGlvbjogSW50ZXJhY3Rpb24pOiBQcm9taXNlPHZvaWQ+IHtcbiAgY29uc3QgY29tbWFuZE5hbWUgPSBpbnRlcmFjdGlvbi5kYXRhPy5uYW1lO1xuXG4gIGlmIChjb21tYW5kTmFtZSA9PT0gXCJ2ZXJpZnlcIikge1xuICAgIGF3YWl0IHByb2Nlc3NWZXJpZnlJbnRlcmFjdGlvbihpbnRlcmFjdGlvbik7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgaWYgKGNvbW1hbmROYW1lID09PSBcInN0YXR1c1wiKSB7XG4gICAgYXdhaXQgcHJvY2Vzc1N0YXR1c0ludGVyYWN0aW9uKGludGVyYWN0aW9uKTtcbiAgICByZXR1cm47XG4gIH1cblxuICBpZiAoY29tbWFuZE5hbWUgPT09IFwiZmluZF90ZWFtbWF0ZXNcIikge1xuICAgIGF3YWl0IHByb2Nlc3NGaW5kVGVhbW1hdGVzSW50ZXJhY3Rpb24oaW50ZXJhY3Rpb24pO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGlmIChjb21tYW5kTmFtZSA9PT0gXCJoZWxwXCIpIHtcbiAgICBhd2FpdCBwcm9jZXNzSGVscEludGVyYWN0aW9uKGludGVyYWN0aW9uKTtcbiAgICByZXR1cm47XG4gIH1cblxuICBhd2FpdCBlZGl0SW50ZXJhY3Rpb25SZXNwb25zZShpbnRlcmFjdGlvbiwgXCJVbnN1cHBvcnRlZCBjb21tYW5kLlwiKTtcbn1cblxuZXhwb3J0IGRlZmF1bHQgYXN5bmMgZnVuY3Rpb24gaGFuZGxlcihyZXE6IE5leHRBcGlSZXF1ZXN0LCByZXM6IE5leHRBcGlSZXNwb25zZSk6IFByb21pc2U8dm9pZD4ge1xuICBpZiAocmVxLm1ldGhvZCAhPT0gXCJQT1NUXCIpIHtcbiAgICByZXMuc3RhdHVzKDQwNSkuanNvbih7IGVycm9yOiBcIk1ldGhvZCBOb3QgQWxsb3dlZFwiIH0pO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGxldCBydW50aW1lQ29uZmlnOiBSdW50aW1lQ29uZmlnO1xuICB0cnkge1xuICAgIHJ1bnRpbWVDb25maWcgPSBnZXRSdW50aW1lQ29uZmlnKCk7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgaWYgKGVycm9yIGluc3RhbmNlb2YgTWlzc2luZ0VudkVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKGBbY29uZmlnXSBNaXNzaW5nIHJlcXVpcmVkIGVudiB2YXJzOiAke2Vycm9yLm1pc3NpbmdWYXJzLmpvaW4oXCIsIFwiKX1gKTtcbiAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgICAgZXJyb3I6IFwiU2VydmVyIG1pc2NvbmZpZ3VyYXRpb246IG1pc3NpbmcgcmVxdWlyZWQgZW52aXJvbm1lbnQgdmFyaWFibGVzLlwiLFxuICAgICAgfSk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnNvbGUuZXJyb3IoXCJbY29uZmlnXSBGYWlsZWQgdG8gaW5pdGlhbGl6ZSBydW50aW1lIGNvbmZpZ3VyYXRpb25cIiwgZXJyb3IpO1xuICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgZXJyb3I6IFwiU2VydmVyIG1pc2NvbmZpZ3VyYXRpb24uXCIgfSk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgY29uc3Qgc2lnbmF0dXJlID0gcmVxLmhlYWRlcnNbXCJ4LXNpZ25hdHVyZS1lZDI1NTE5XCJdO1xuICBjb25zdCB0aW1lc3RhbXAgPSByZXEuaGVhZGVyc1tcIngtc2lnbmF0dXJlLXRpbWVzdGFtcFwiXTtcblxuICBpZiAodHlwZW9mIHNpZ25hdHVyZSAhPT0gXCJzdHJpbmdcIiB8fCB0eXBlb2YgdGltZXN0YW1wICE9PSBcInN0cmluZ1wiKSB7XG4gICAgcmVzLnN0YXR1cyg0MDEpLnNlbmQoXCJJbnZhbGlkIHNpZ25hdHVyZVwiKTtcbiAgICByZXR1cm47XG4gIH1cblxuICBjb25zdCByYXdCb2R5ID0gYXdhaXQgcmVhZFJhd0JvZHkocmVxKTtcbiAgaWYgKCF2ZXJpZnlEaXNjb3JkUmVxdWVzdChyYXdCb2R5LCBzaWduYXR1cmUsIHRpbWVzdGFtcCwgcnVudGltZUNvbmZpZy5kaXNjb3JkUHVibGljS2V5SGV4KSkge1xuICAgIHJlcy5zdGF0dXMoNDAxKS5zZW5kKFwiSW52YWxpZCBzaWduYXR1cmVcIik7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgbGV0IGludGVyYWN0aW9uOiBJbnRlcmFjdGlvbjtcbiAgdHJ5IHtcbiAgICBpbnRlcmFjdGlvbiA9IEpTT04ucGFyc2UocmF3Qm9keS50b1N0cmluZyhcInV0ZjhcIikpIGFzIEludGVyYWN0aW9uO1xuICB9IGNhdGNoIHtcbiAgICByZXMuc3RhdHVzKDQwMCkuanNvbih7IGVycm9yOiBcIkludmFsaWQgSlNPTiBib2R5XCIgfSk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgaWYgKGludGVyYWN0aW9uLnR5cGUgPT09IDEpIHtcbiAgICByZXMuc3RhdHVzKDIwMCkuanNvbih7IHR5cGU6IDEgfSk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgaWYgKGludGVyYWN0aW9uLnR5cGUgIT09IDIpIHtcbiAgICByZXMuc3RhdHVzKDIwMCkuanNvbihpbnRlcmFjdGlvblJlc3BvbnNlKFwiVW5zdXBwb3J0ZWQgaW50ZXJhY3Rpb24gdHlwZS5cIikpO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIHJlcy5zdGF0dXMoMjAwKS5qc29uKGludGVyYWN0aW9uRGVmZXJyZWRSZXNwb25zZSgpKTtcbiAgYXdhaXQgcHJvY2Vzc0NvbW1hbmRJbnRlcmFjdGlvbihpbnRlcmFjdGlvbik7XG59XG4iXSwibmFtZXMiOlsibmFjbCIsImNyZWF0ZUNsaWVudCIsImFzc2lnblJvbGVzRnJvbVJlZ2lzdHJhdGlvbiIsImVkaXRPcmlnaW5hbEludGVyYWN0aW9uUmVzcG9uc2UiLCJjb25maWciLCJhcGkiLCJib2R5UGFyc2VyIiwiRU5BQkxFX1ZFUklGWV9USU1JTkdfTE9HUyIsInByb2Nlc3MiLCJlbnYiLCJWRVJJRllfVElNSU5HX0xPR1MiLCJNQVhfVEVBTU1BVEVfUkVTVUxUUyIsIk51bWJlciIsIlRFQU1NQVRFX1FVRVJZX0xJTUlUIiwiTWlzc2luZ0VudkVycm9yIiwiRXJyb3IiLCJtaXNzaW5nVmFycyIsImpvaW4iLCJuYW1lIiwicnVudGltZUNvbmZpZ0NhY2hlIiwicmVhZEVudiIsInZhbHVlIiwidW5kZWZpbmVkIiwibm9ybWFsaXplZCIsInRyaW0iLCJsZW5ndGgiLCJyZXNvbHZlRW52VmFsdWUiLCJzcGVjIiwicHJpbWFyeVZhbHVlIiwicHJpbWFyeU5hbWUiLCJmYWxsYmFja05hbWUiLCJnZXRSdW50aW1lQ29uZmlnIiwic3BlY3MiLCJyZXNvbHZlZCIsInB1c2giLCJkaXNjb3JkUHVibGljS2V5SGV4IiwiRElTQ09SRF9QVUJMSUNfS0VZIiwic3VwYWJhc2UiLCJTVVBBQkFTRV9VUkwiLCJTVVBBQkFTRV9TRVJWSUNFX1JPTEVfS0VZIiwiYXV0aCIsInBlcnNpc3RTZXNzaW9uIiwiYXV0b1JlZnJlc2hUb2tlbiIsImludGVyYWN0aW9uUmVzcG9uc2UiLCJjb250ZW50IiwidHlwZSIsImRhdGEiLCJmbGFncyIsInJlYWRSYXdCb2R5IiwicmVxIiwiY2h1bmtzIiwiY2h1bmsiLCJCdWZmZXIiLCJmcm9tIiwiY29uY2F0IiwidmVyaWZ5RGlzY29yZFJlcXVlc3QiLCJyYXdCb2R5Iiwic2lnbmF0dXJlIiwidGltZXN0YW1wIiwicHVibGljS2V5SGV4IiwibWVzc2FnZSIsInNpZ25hdHVyZUJ5dGVzIiwicHVibGljS2V5Qnl0ZXMiLCJzaWduIiwiZGV0YWNoZWQiLCJ2ZXJpZnkiLCJnZXREaXNjb3JkVXNlciIsImludGVyYWN0aW9uIiwibWVtYmVyIiwidXNlciIsImdldFN0cmluZ09wdGlvbiIsIm9wdGlvbk5hbWUiLCJvcHRpb25zIiwiZmluZCIsIm9wdGlvbiIsInRyaW1tZWQiLCJnZXRFbWFpbE9wdGlvbiIsImVtYWlsIiwidG9Mb3dlckNhc2UiLCJnZXRJbnRlcmVzdE9wdGlvbiIsImVzY2FwZVBvc3RncmVzTGlrZSIsInJlcGxhY2UiLCJpbnRlcmFjdGlvbkRlZmVycmVkUmVzcG9uc2UiLCJub3JtYWxpemVMaXN0RmllbGQiLCJBcnJheSIsImlzQXJyYXkiLCJtYXAiLCJpdGVtIiwiZmlsdGVyIiwic3RhcnRzV2l0aCIsImVuZHNXaXRoIiwicGFyc2VkIiwiSlNPTiIsInBhcnNlIiwic3BsaXQiLCJub3JtYWxpemVLZXkiLCJpc0xvb2tpbmdGb3JUZWFtIiwidGVhbU1vZGUiLCJnZXRSZWdpc3RyYXRpb25EaXNwbGF5TmFtZSIsInJlZ2lzdHJhdGlvbiIsImZpcnN0IiwiZmlyc3RfbmFtZSIsImxhc3QiLCJsYXN0X25hbWUiLCJqb2luZWQiLCJ0cnVuY2F0ZVRleHQiLCJtYXhMZW5ndGgiLCJzbGljZSIsIk1hdGgiLCJtYXgiLCJlZGl0SW50ZXJhY3Rpb25SZXNwb25zZSIsImFwcGxpY2F0aW9uSWQiLCJhcHBsaWNhdGlvbl9pZCIsImludGVyYWN0aW9uVG9rZW4iLCJ0b2tlbiIsIlJFR0lTVFJBVElPTl9TRUxFQ1QiLCJURUFNTUFURV9TRUxFQ1QiLCJmaW5kQnlEaXNjb3JkVXNlcklkIiwiZGlzY29yZFVzZXJJZCIsImVycm9yIiwic2VsZWN0IiwiZXEiLCJtYXliZVNpbmdsZSIsImZpbmRCeUVtYWlsQ2FzZUluc2Vuc2l0aXZlIiwibm9ybWFsaXplZEVtYWlsIiwiZXNjYXBlZEVtYWlsIiwiaWxpa2UiLCJsaW1pdCIsImZpbmRUZWFtbWF0ZUNhbmRpZGF0ZXMiLCJub3QiLCJuZXEiLCJyb3dzIiwicm93IiwiQm9vbGVhbiIsImRpc2NvcmRfdXNlcl9pZCIsInRlYW1fbW9kZSIsInZlcmlmeVJlZ2lzdHJhdGlvbiIsImRpc2NvcmRVc2VyIiwicHJvdmlkZWRFbWFpbCIsImV4aXN0aW5nIiwiaWQiLCJvayIsInVwZGF0ZWRSZWdpc3RyYXRpb24iLCJ1cGRhdGVFcnJvciIsInVwZGF0ZSIsImRpc2NvcmRfdXNlcm5hbWUiLCJ1c2VybmFtZSIsImRpc2NvcmRfdmVyaWZpZWRfYXQiLCJEYXRlIiwidG9JU09TdHJpbmciLCJzaW5nbGUiLCJjb2RlIiwibG9nVmVyaWZ5VGltaW5nIiwic3RlcCIsImR1cmF0aW9uTXMiLCJkZXRhaWxzIiwic3VmZml4IiwiY29uc29sZSIsImluZm8iLCJ0b0ZpeGVkIiwiYnVpbGRWZXJpZmljYXRpb25TdWNjZXNzTWVzc2FnZSIsInJvbGVSZXN1bHQiLCJndWlsZElkIiwibGluZXMiLCJhc3NpZ25lZFJvbGVOYW1lcyIsImZhaWxlZFJvbGVOYW1lcyIsInRvUm9sZUFzc2lnbm1lbnRSZWdpc3RyYXRpb24iLCJmaWVsZHNfb2Zfc3R1ZHkiLCJpbnRlcmVzdHMiLCJsZXZlbF9vZl9zdHVkeSIsInNjaG9vbCIsInNjaG9vbF9vdGhlciIsInRlYW1fbmFtZSIsImJ1aWxkU3RhdHVzTWVzc2FnZSIsImJ1aWxkVGVhbW1hdGVzTWVzc2FnZSIsIm1hdGNoZXMiLCJpbnRlcmVzdEZpbHRlciIsInNob3duIiwiY2FwcGVkTWF0Y2hlcyIsImluZGV4IiwibWF0Y2giLCJjYW5kaWRhdGUiLCJtZW50aW9uIiwibGV2ZWwiLCJtYXRjaFBhcnRzIiwibWF0Y2hlZEludGVyZXN0cyIsIm1hdGNoZWRGaWVsZHMiLCJibG9jayIsInNjb3JlIiwibGluZSIsInRlbnRhdGl2ZSIsInByb2Nlc3NWZXJpZnlJbnRlcmFjdGlvbiIsInRvdGFsU3RhcnQiLCJwZXJmb3JtYW5jZSIsIm5vdyIsInZlcmlmeVN0YXJ0IiwidmVyaWZ5UmVzdWx0IiwiZWRpdFN0YXJ0IiwiZ3VpbGRfaWQiLCJyb2xlU3RhcnQiLCJmb2xsb3d1cEVycm9yIiwicHJvY2Vzc1N0YXR1c0ludGVyYWN0aW9uIiwicHJvY2Vzc0ZpbmRUZWFtbWF0ZXNJbnRlcmFjdGlvbiIsInVzZXJSZWdpc3RyYXRpb24iLCJub3JtYWxpemVkRmlsdGVyIiwidXNlckludGVyZXN0S2V5cyIsIlNldCIsInVzZXJGaWVsZEtleXMiLCJjYW5kaWRhdGVzIiwiY2FuZGlkYXRlSW50ZXJlc3RzIiwiY2FuZGlkYXRlRmllbGRzIiwiY2FuZGlkYXRlVGV4dCIsImluY2x1ZGVzIiwiaGFzIiwic29ydCIsImEiLCJiIiwiYU5hbWUiLCJiTmFtZSIsImxvY2FsZUNvbXBhcmUiLCJwcm9jZXNzSGVscEludGVyYWN0aW9uIiwicHJvY2Vzc0NvbW1hbmRJbnRlcmFjdGlvbiIsImNvbW1hbmROYW1lIiwiaGFuZGxlciIsInJlcyIsIm1ldGhvZCIsInN0YXR1cyIsImpzb24iLCJydW50aW1lQ29uZmlnIiwiaGVhZGVycyIsInNlbmQiLCJ0b1N0cmluZyJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api-node)/./pages/api/discord/interactions.ts\n");

/***/ }),

/***/ "@supabase/supabase-js":
/*!****************************************!*\
  !*** external "@supabase/supabase-js" ***!
  \****************************************/
/***/ ((module) => {

module.exports = import("@supabase/supabase-js");;

/***/ }),

/***/ "next/dist/compiled/next-server/pages-api.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/pages-api.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/pages-api.runtime.dev.js");

/***/ }),

/***/ "tweetnacl":
/*!****************************!*\
  !*** external "tweetnacl" ***!
  \****************************/
/***/ ((module) => {

module.exports = require("tweetnacl");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-api-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next"], () => (__webpack_exec__("(api-node)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fdiscord%2Finteractions&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Fdiscord%2Finteractions.ts&middlewareConfigBase64=e30%3D!")));
module.exports = __webpack_exports__;

})();